(function(){var q,aT,az,bl,an,a4,S,X,W,aG,ao,a0,aS,aJ,h,o,aw,p,af,a2,z,y,aH,bg,aX,N,ay,bh,bj,g,n,aM,L,bi,a5,I,ax,ae,bc,aj,u,br,aq,D,aB,R,aI,au,ac,v,aA,a8,am,J,a1,aD,P,j,al,w,a3,bq,a7,aK,E,F,aL,ad,e,m,K,a6,aV,aF,d,r,bp,ak,ap,at,bf,G,aW,Q,ag,bn,x,M,A,bm,U,bd,ai,aP,a9,T,Z,s,bo,aN,bb,ba,aC,O,H,t,B,i,Y,aQ,aE,ar,aZ,aR,aO,V,aY,be,b,k,aa,C,f,ah,a,ab,l,bk,av,aU,c;aN=Math.random;Y=Math.round;am=Math.floor;V=Math.sqrt;aZ=Math.sin;I=Math.cos;b=Math.tan;N=Math.asin;a2=Math.acos;ay=Math.atan;a9=Math.pow;af=Math.abs;aJ=Math.PI;S=Math.LN10;e=Math.log;a9=Math.pow;m=function(bs){return e(bs)/S};ar=function(bu,bt){var bs;bs=a9(10,m(bu)-am(m(bu)));return""+(Y(bs*(bt-1)))};L=function(bu){var bt,bs;if((bu==null)||typeof bu!=="object"){return bu}bs=new bu.constructor();for(bt in bu){bs[bt]=L(bu[bt])}return bs};bb=function(bt){var bs;bs=am(aN()*bt.length);return bt[bs]};d=function(bt,bs){return[bt*bs[0],bt*bs[1],bt*bs[2]]};p=function(bt,bs){return[bt[0]*bs[0],bt[1]*bs[1],bt[2]*bs[2]]};z=function(bt,bs){return[bt[0]+bs[0],bt[1]+bs[1],bt[2]+bs[2]]};be=function(bt,bs){return[bt[0]-bs[0],bt[1]-bs[1],bt[2]-bs[2]]};D=function(bt,bs){return bt[0]*bs[0]+bt[1]*bs[1]+bt[2]*bs[2]};ax=function(bt,bs){return[bt[1]*bs[2]-bt[2]*bs[1],bt[2]*bs[0]-bt[0]*bs[2],bt[0]*bs[1]-bt[1]*bs[0]]};K=function(bs){return V(D(bs,bs))};a6=function(bs){return D(bs,bs)};bk=function(bs){return d(1/V(a6(bs)),bs)};aV=function(bt,bs){return d(1/2,z(bt,bs))};l=function(bu,bt,bs){return[(1-bs)*bu[0]+bs*bt[0],(1-bs)*bu[1]+bs*bt[1],(1-bs)*bu[2]+bs*bt[2]]};at=function(bt,bs){return l(bt,bs,1/3)};aC=function(bs){return d(1/a6(bs),bs)};k=function(bu,bt){var bs;bs=be(bt,bu);return be(bu,d(D(bs,bu)/a6(bs),bs))};au=function(bt,bs){return V(a6(k(bt,bs)))};aW=function(bw,bv,bu){var bt,bs;bt=be(bv,bw);bs=be(bu,bv);return ax(bt,bs)};F=function(by,bx,bv){var bt,bz,bw,bu,bs,bC,bB,bA,bD;for(bt=0,bz=by.length;bt<bz;bt++){bC=by[bt];for(bs=0,bw=bx.length;bs<bw;bs++){bB=bx[bs];if(bC===bB){for(bD=0,bu=bv.length;bD<bu;bD++){bA=bv[bD];if(bC===bA){return bC}}}}}return null};bj=function(bw){var bv,bt,bs,bu;bv=[0,0,0];for(bt=0,bs=bw.length;bt<bs;bt++){bu=bw[bt];bv=z(bv,bu)}return d(1/bw.length,bv)};ak=function(bv){var bu,bw,bs,bt,bx,bA,bz,by;bs=[0,0,0];bt=bv.slice(-2),bA=bt[0],bz=bt[1];for(bu=0,bw=bv.length;bu<bw;bu++){by=bv[bu];bs=z(bs,aW(bA,bz,by));bx=[bz,by],bA=bx[0],bz=bx[1]}return bk(bs)};bi=function(bv){var bs,bu,bw,bt,bx,bA,bz,by;bs=0;bt=bv.slice(0,2),bA=bt[0],bz=bt[1];bx=bv.slice(2);for(bu=0,bw=bx.length;bu<bw;bu++){by=bx[bu];bs+=K(ax(be(bz,bA),be(by,bA)));bz=by}return bs};aA=function(bz){var bx,bu,bA,bw,bv,bs,bt,bB,by,bH,bG,bF,bE,bC,bD;bx=[];bt=bz.slice(0,2),bF=bt[0],bE=bt[1];bB=bz.slice(2);for(bu=0,bA=bB.length;bu<bA;bu++){bC=bB[bu];bx.push(K(ax(be(bE,bF),be(bC,bF))));bE=bC}bx.sort(function(bJ,bI){return bJ-bI});bH="";for(bs=0,bw=bx.length;bs<bw;bs++){bD=bx[bs];bH+=ar(bD,2)}by=bx.reverse();for(bG=0,bv=by.length;bG<bv;bG++){bD=by[bG];bH+=ar(bD,2)}return bH};Z=function(bz){var by,bu,bx,bt,bs,bw,bv,bB,bA;bv=L(bz);bA=bz[0];bv=_.map(bv,function(bC){return bC-bA});bt=ak(bz);by=bk(bj(bz));bs=ax(bt,by);bw=[];for(bu=0,bx=bv.length;bu<bx;bu++){bB=bv[bu];bw.push([D(bt,bB),D(bs,bB)])}return bw};a5=function(bv){var bu,bt,bs,bw;bs=new Array(bv.length);for(bu=bt=0,bw=bv.length-1;0<=bw?bt<=bw:bt>=bw;bu=0<=bw?++bt:--bt){bs[bu]=bv[bu].slice(0)}return bs};r=function(bt,bs){return[bt[0][0]*bs[0]+bt[0][1]*bs[1]+bt[0][2]*bs[2],bt[1][0]*bs[0]+bt[1][1]*bs[1]+bt[1][2]*bs[2],bt[2][0]*bs[0]+bt[2][1]*bs[1]+bt[2][2]*bs[2]]};aF=function(bs,bt){return[[bs[0][0]*bt[0][0]+bs[0][1]*bt[1][0]+bs[0][2]*bt[2][0],bs[0][0]*bt[0][1]+bs[0][1]*bt[1][1]+bs[0][2]*bt[2][1],bs[0][0]*bt[0][2]+bs[0][1]*bt[1][2]+bs[0][2]*bt[2][2]],[bs[1][0]*bt[0][0]+bs[1][1]*bt[1][0]+bs[1][2]*bt[2][0],bs[1][0]*bt[0][1]+bs[1][1]*bt[1][1]+bs[1][2]*bt[2][1],bs[1][0]*bt[0][2]+bs[1][1]*bt[1][2]+bs[1][2]*bt[2][2]],[bs[2][0]*bt[0][0]+bs[2][1]*bt[1][0]+bs[2][2]*bt[2][0],bs[2][0]*bt[0][1]+bs[2][1]*bt[1][1]+bs[2][2]*bt[2][1],bs[2][0]*bt[0][2]+bs[2][1]*bt[1][2]+bs[2][2]*bt[2][2]]]};v=[[1,0,0],[0,1,0],[0,0,1]];i=function(bw,bu,bv){var bx,bt,bs;bx=[[I(bw),-1*aZ(bw),0],[aZ(bw),I(bw),0],[0,0,1]];bs=[[I(bu),0,-1*aZ(bu)],[0,1,0],[aZ(bu),0,I(bu)]];bt=[[1,0,0],[0,I(bv),-1*aZ(bv)],[0,aZ(bv),I(bv)]];return aF(bt,aF(bs,bx))};aU=function(bw,bF,bE,bA){var by,bt,bv,bu,bz,bD,bC,bs,bB,bx;bw/=2;bD=aZ(bw);by=I(bw);bC=bD*bD;bt=K([bF,bE,bA]);if(bt===0){bu=[0,0,1],bF=bu[0],bE=bu[1],bA=bu[2]}if(bt!==1){bz=bk([bF,bE,bA]),bF=bz[0],bE=bz[1],bA=bz[2]}if(bF===1&&bE===0&&bA===0){bv=[[1,0,0],[0,1-2*bC,2*bD*by],[0,-2*bD*by,1-2*bC]]}else{if(bF===0&&bE===1&&bA===0){bv=[[1-2*bC,0,-2*bD*by],[0,1,0],[2*bD*by,0,1-2*bC]]}else{if(bF===0&&bE===0&&bA===1){bv=[[1-2*bC,2*bD*by,0],[-2*bD*by,1-2*bC,0],[0,0,1]]}else{bs=bF*bF;bB=bE*bE;bx=bA*bA;bv=[[1-2*(bB+bx)*bC,2*(bF*bE*bC+bA*bD*by),2*(bF*bA*bC-bE*bD*by)],[2*(bE*bF*bC-bA*bD*by),1-2*(bx+bs)*bC,2*(bE*bA*bC+bF*bD*by)],[2*(bA*bF*bC+bE*bD*by),2*(bA*bE*bC-bF*bD*by),1-2*(bs+bB)*bC]]}}}return bv};x=function(bu,bt,bv,by,bs){var bw,bx;bx=(bt*by-bv)/(1-by);bw=bs*by/(1-by);return[bw*bu[0]/(bu[2]+bx),bw*bu[1]/(bu[2]+bx)]};aL=function(bz,bw,bC,bA,bG,bv,bu,bt){var bF,bs,bB,bx,bD,bI,bK,by,bE,bH,bJ;bE=(bG*bu-bv)/(1-bu);bF=bt*bu/(1-bu);bB=bz-bC;bI=bw-bA;bs=bF*bF;bH=bE*bE;bx=bB*bB;bK=bI*bI;bD=(2*bF*bB*bE+V(4*bs*bx*bH+4*bx*(bs+bx+bK)*(1-bH)))/(2*(bs+bx+bK));by=(bF*bI*bE)/(bs+bx+bK)+(bI*V(4*bs*bH+4*(bs+bx+bK)*(1-bH)))/(2*(bs+bx+bK));bJ=V(1-bD*bD-by*by);return[bD,by,bJ]};aD=function(bu,bt){var bv,bs;bs=ax(bu,bt);bv=a2(D(bu,bt));return aU(-1*bv,bs[0],bs[1],bs[2])};a8=function(bv){var bu,bt,bs,bx,bw;bu=[];bx=bv.slice(-1)[0];for(bt=0,bs=bv.length;bt<bs;bt++){bw=bv[bt];bu.push([bx,bw]);bx=bw}return bu};c=function(bs){var by,bx,bv,bz,bw,bt,bu,bB,bA;bA=[];bu=bs.face;for(bx=bv=0,bz=bu.length;bv<bz;bx=++bv){by=bu[bx];for(bt=0,bw=by.length;bt<bw;bt++){bB=by[bt];bA[bB]=bs.face_class[bx]}}return bA};aQ=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];bq=function(bt){var bs;if(bt[0]==="#"){bt=bt.slice(1)}if(bt.length===3){bs=bt.split("").map(function(bu){return parseInt(bu+bu,16)/255})}else{bs=bt.match(/.{2}/g).map(function(bu){return parseInt(bu,16)/255})}return bs};a0=aQ;ag=function(bs){if(bs<a0.length){return bq(a0[bs])}else{return bq(a0[a0.length-1])}};Q=function(bs){var bB,bu,by,bw,bA,bv,bx,bt,bz;bs.face_class=[];by={};bu=function(bC,bF){var bD,bE;bE=Y(100*bC);if(bE in bF){return bF[bE]}else{bD=_.toArray(bF).length;bF[bE]=bD;return bD}};bt=bs.face;for(bv=0,bx=bt.length;bv<bx;bv++){bw=bt[bv];if(an==="area"){bA=(function(){var bC,bE,bD;bD=[];for(bE=0,bC=bw.length;bE<bC;bE++){bz=bw[bE];bD.push(bs.xyz[bz])}return bD})();bB=bu(bi(bA),by)}else{if(an==="signature"){bA=(function(){var bC,bE,bD;bD=[];for(bE=0,bC=bw.length;bE<bC;bE++){bz=bw[bE];bD.push(bs.xyz[bz])}return bD})();bB=bu(aA(bA),by)}else{bB=bw.length-3}}bs.face_class.push(bB)}console.log(_.toArray(by).length+" face classes");return bs};aR=function(bs){var bt,bB,bw,bA,bC,bx,bv,by,bu,bz;bt=bs.centers();bA=bs.normals();bx=[0,0,(A*M-bm)/(1-M)];bC=function(bE,bD){return -D(be(bx,bE[0]),bE[1])*D(be(bD[0],bE[0]),bE[1])};bu=function(bE,bD){return bE[0][2]-bD[0][2]};bz=_.zip(bt,bA,(function(){by=[];for(var bD=0,bE=bs.face.length-1;0<=bE?bD<=bE:bD>=bE;0<=bE?bD++:bD--){by.push(bD)}return by}).apply(this)).sort(bu).map(function(bD){return bD[2]});bs.face=(function(){var bD,bF,bE;bE=[];for(bF=0,bD=bz.length;bF<bD;bF++){bB=bz[bF];bE.push(bs.face[bB])}return bE})();return bs.face_class=(function(){var bD,bF,bE;bE=[];for(bF=0,bD=bz.length;bF<bD;bF++){bB=bz[bF];bE.push(bs.face_class[bB])}return bE})()};aP=(function(){function bs(bv,bt,bu){this.face=bt||new Array();this.xyz=bv||new Array();this.name=bu||"null polyhedron"}bs.prototype.data=function(){var bt;bt=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bt+" edges, "+this.xyz.length+" vertices)"};bs.prototype.edges=function(){var bD,bA,bC,bB,bt,bz,bx,bv,by,bw,bu,bE;bz={};bE=[];bA=_.map(this.face,a8);for(bv=0,by=bA.length;bv<by;bv++){bt=bA[bv];for(bu=0,bw=bt.length;bu<bw;bu++){bB=bt[bu];if(bB[0]<bB[1]){bD=bB[0],bC=bB[1]}else{bC=bB[0],bD=bB[1]}bz[bD+"~"+bC]=bB}}for(bx in bz){bB=bz[bx];bE.push(bB)}return bE};bs.prototype.centers=function(){var by,bz,bw,bv,bA,bx,bt,bu,bB;by=[];bu=this.face;for(bv=0,bA=bu.length;bv<bA;bv++){bz=bu[bv];bw=[0,0,0];for(bt=0,bx=bz.length;bt<bx;bt++){bB=bz[bt];bw=z(bw,this.xyz[bB])}by.push(d(1/bz.length,bw))}return by};bs.prototype.normals=function(){var bx,bu,bt,by,bw,bv;by=[];bw=this.face;for(bu=0,bt=bw.length;bu<bt;bu++){bx=bw[bu];by.push(ak((function(){var bz,bB,bA;bA=[];for(bB=0,bz=bx.length;bB<bz;bB++){bv=bx[bB];bA.push(this.xyz[bv])}return bA}).call(this)))}return by};bs.prototype.toOBJ=function(){var bD,bA,bw,bE,bz,by,bx,bt,bu,bC,bv,bF,bB,bI,bH,bG;bC="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bC+="group "+this.name+"\n";bC+="#vertices\n";bv=this.xyz;for(bw=0,bE=bv.length;bw<bE;bw++){bH=bv[bw];bC+="v "+bH[0]+" "+bH[1]+" "+bH[2]+"\n"}bC+="#normal vector defs \n";bF=this.face;for(bu=0,bz=bF.length;bu<bz;bu++){bD=bF[bu];bt=ak((function(){var bJ,bL,bK;bL=[];for(bK=0,bJ=bD.length;bK<bJ;bK++){bH=bD[bK];bL.push(this.xyz[bH])}return bL}).call(this));bC+="vn "+bt[0]+" "+bt[1]+" "+bt[2]+"\n"}bC+="#face defs \n";bB=this.face;for(bA=bI=0,by=bB.length;bI<by;bA=++bI){bD=bB[bA];bC+="f ";for(bG=0,bx=bD.length;bG<bx;bG++){bH=bD[bG];bC+=(bH+1)+"//"+(bA+1)+" "}bC+="\n"}return bC};bs.prototype.toX3D=function(){var bv,bG,bJ,bB,bx,bC,bz,by,bw,bt,bu,bD,bA,bH,bF,bE,bI;bv=0.01;bI='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bu=this.face;for(bx=0,bC=bu.length;bx<bC;bx++){bB=bu[bx];for(bt=0,bz=bB.length;bt<bz;bt++){bF=bB[bt];bI+=bF+" "}bI+="-1\n"}bI+='">\n';bI+='<Color color="';bD=c(this);for(bH=0,by=bD.length;bH<by;bH++){bG=bD[bH];bJ=ag(bG);bI+=bJ[0]+" "+bJ[1]+" "+bJ[2]+" "}bI+='"/>';bI+='<Coordinate point="';bA=this.xyz;for(bE=0,bw=bA.length;bE<bw;bE++){bF=bA[bE];bI+=(bF[0]*bv)+" "+(bF[1]*bv)+" "+(bF[2]*bv)+" "}bI+='"/>\n';bI+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bI};bs.prototype.toVRML=function(){var bv,bG,bJ,bB,bx,bC,bz,by,bw,bt,bu,bD,bA,bH,bF,bE,bI;bv=0.01;bI='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bu=this.xyz;for(bx=0,bC=bu.length;bx<bC;bx++){bF=bu[bx];bI+=(bF[0]*bv)+" "+(bF[1]*bv)+" "+(bF[2]*bv)+","}bI=bI.slice(0,-1);bI+="    ]\n}\ncolor Color\n{\n  color\n  [";bD=this.face_class;for(bt=0,bz=bD.length;bt<bz;bt++){bG=bD[bt];bJ=ag(bG);bI+=bJ[0]+" "+bJ[1]+" "+bJ[2]+" ,"}bI=bI.slice(0,-1);bI+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bA=this.face;for(bH=0,by=bA.length;bH<by;bH++){bB=bA[bH];for(bE=0,bw=bB.length;bE<bw;bE++){bF=bB[bE];bI+=bF+", "}bI+="-1,"}bI=bI.slice(0,-1);bI+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bI};return bs})();f=function(){var bs;bs=new aP();bs.name="T";bs.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bs.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bs};ap=function(){var bs;bs=new aP();bs.name="O";bs.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bs.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bs};aj=function(){var bs;bs=new aP();bs.name="C";bs.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bs.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bs};a7=function(){var bs;bs=new aP();bs.name="I";bs.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bs.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bs};aq=function(){var bs;bs=new aP();bs.name="D";bs.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bs.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bs};T=function(bw){var bs,bD,bB,bz,bv,bt,bx,bG,bF,bE,bC,bA,by,bu,bI,bH;bu=2*aJ/bw;bD=Math.sin(bu/2);bt=new aP();bt.name="P"+bw;for(bB=bz=0,bx=bw-1;0<=bx?bz<=bx:bz>=bx;bB=0<=bx?++bz:--bz){bt.xyz.push([-I(bB*bu),-aZ(bB*bu),-bD])}for(bB=bv=0,bG=bw-1;0<=bG?bv<=bG:bv>=bG;bB=0<=bG?++bv:--bv){bt.xyz.push([-I(bB*bu),-aZ(bB*bu),bD])}bt.face.push((function(){bA=[];for(var bJ=bF=bw-1;bF<=0?bJ<=0:bJ>=0;bF<=0?bJ++:bJ--){bA.push(bJ)}return bA}).apply(this));bt.face.push((function(){by=[];for(var bK=bw,bJ=2*bw-1;bw<=bJ?bK<=bJ:bK>=bJ;bw<=bJ?bK++:bK--){by.push(bK)}return by}).apply(this));for(bB=bs=0,bC=bw-1;0<=bC?bs<=bC:bs>=bC;bB=0<=bC?++bs:--bs){bt.face.push([bB,(bB+1)%bw,(bB+1)%bw+bw,bB+bw])}bt=y(bt,1);return bt};aX=function(bF){var bK,bJ,bI,bH,bG,bD,bu,bC,bt,bB,bA,by,bx,bE,bs,bv,bz,bw;bv=2*aJ/bF;bI=V(1-4/(4+2*I(bv/2)-2*I(bv)));bC=V(1-bI*bI);bJ=V(bI*bI+a9(bC*I(bv/2),2));bC=-bC/bJ;bI=-bI/bJ;bu=new aP();bu.name="A"+bF;for(bH=bG=0,bt=bF-1;0<=bt?bG<=bt:bG>=bt;bH=0<=bt?++bG:--bG){bu.xyz.push([bC*I(bH*bv),bC*aZ(bH*bv),bI])}for(bH=bD=0,bB=bF-1;0<=bB?bD<=bB:bD>=bB;bH=0<=bB?++bD:--bD){bu.xyz.push([bC*I((bH+0.5)*bv),bC*aZ((bH+0.5)*bv),-bI])}bu.face.push((function(){bE=[];for(var bL=bA=bF-1;bA<=0?bL<=0:bL>=0;bA<=0?bL++:bL--){bE.push(bL)}return bE}).apply(this));bu.face.push((function(){bs=[];for(var bM=bF,bL=2*bF-1;bF<=bL?bM<=bL:bM>=bL;bF<=bL?bM++:bM--){bs.push(bM)}return bs}).apply(this));for(bH=bK=0,bx=bF-1;0<=bx?bK<=bx:bK>=bx;bH=0<=bx?++bK:--bK){bu.face.push([bH,(bH+1)%bF,bH+bF]);bu.face.push([bH,bH+bF,(bF+bH-1)%bF+bF])}bu=y(bu,1);return bu};bo=function(bv){var bD,bz,bx,bu,bs,bw,bB,bA,by,bt,bC;bt=2*aJ/bv;bD=1;bs=new aP();bs.name="Y"+bv;for(bz=bx=0,bw=bv-1;0<=bw?bx<=bw:bx>=bw;bz=0<=bw?++bx:--bx){bs.xyz.push([-I(bz*bt),-aZ(bz*bt),-0.2])}bs.xyz.push([0,0,bD]);bs.face.push((function(){by=[];for(var bE=bB=bv-1;bB<=0?bE<=0:bE>=0;bB<=0?bE++:bE--){by.push(bE)}return by}).apply(this));for(bz=bC=0,bA=bv-1;0<=bA?bC<=bA:bC>=bA;bz=0<=bA?++bC:--bC){bs.face.push([bz,(bz+1)%bv,bv])}bs=g(bs,3);return bs};ai=(function(){function bs(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bs.prototype.newV=function(bu,bt){if(this.verts[bu]===void 0){this.verts[bu]=0;return this.xyzs[bu]=bt}};bs.prototype.newFlag=function(bt,bv,bu){if(this.flags[bt]===void 0){this.flags[bt]={}}return this.flags[bt][bv]=bu};bs.prototype.topoly=function(){var bu,by,bC,bx,bw,bt,bv,bz,bB,bA;bt=new aP();bu=0;bv=this.verts;for(bx in bv){bB=bv[bx];bt.xyz[bu]=this.xyzs[bx];this.verts[bx]=bu;bu++}bu=0;bz=this.flags;for(bx in bz){by=bz[bx];bt.face[bu]=[];for(bw in by){bB=by[bw];bA=bB;break}bB=bA;bt.face[bu].push(this.verts[bB]);bB=this.flags[bx][bB];bC=0;while(bB!==bA){bt.face[bu].push(this.verts[bB]);bB=this.flags[bx][bB];bC++;if(bC>1000){console.log("Bad flag spec, have a neverending face:",bx,this.flags[bx]);break}}bu++}bt.name="unknown polyhedron";return bt};return bs})();ad=function(by,bI,bw){var bv,bO,bN,bK,bP,bu,bL,bJ,bM,bA,bz,bB,bF,bH,bG,bx,bE,bD,bC,bt,bs;bI||(bI=0);bw||(bw=0.1);console.log("Taking kis of "+(bI===0?"":bI)+"-sided faces of "+by.name+"...");bK=new ai();bx=by.xyz;for(bL=bJ=0,bM=bx.length;bJ<bM;bL=++bJ){bG=bx[bL];bK.newV("v"+bL,bG)}bF=by.normals();bO=by.centers();bu=false;bE=by.face;for(bL=bH=0,bA=bE.length;bH<bA;bL=++bH){bN=bE[bL];bt="v"+bN[bN.length-1];for(bD=0,bz=bN.length;bD<bz;bD++){bC=bN[bD];bs="v"+bC;if(bN.length===bI||bI===0){bu=true;bv="apex"+bL;bP=""+bL+bt;bK.newV(bv,z(bO[bL],d(bw,bF[bL])));bK.newFlag(bP,bt,bs);bK.newFlag(bP,bs,bv);bK.newFlag(bP,bv,bt)}else{bK.newFlag(""+bL,bt,bs)}bt=bs}}if(!bu){console.log("No "+bI+"-fold components were found.")}bB=bK.topoly();bB.name="k"+(bI===0?"":bI)+by.name;return bB};aH=function(bs){var bB,bE,bz,bx,bC,by,bt,bw,bu,bv,bD,bA,bH,bG,bF;console.log("Taking ambo of "+bs.name+"...");bt=function(bJ,bI){if(bJ<bI){return bJ+"_"+bI}else{return bI+"_"+bJ}};bE=new ai();bv=bs.face;for(bz=bx=0,bC=bv.length;bx<bC;bz=++bx){bB=bv[bz];bD=bB.slice(-2),bH=bD[0],bG=bD[1];for(bu=0,by=bB.length;bu<by;bu++){bF=bB[bu];if(bH<bG){bE.newV(bt(bH,bG),aV(bs.xyz[bH],bs.xyz[bG]))}bE.newFlag("orig"+bz,bt(bH,bG),bt(bG,bF));bE.newFlag("dual"+bG,bt(bG,bF),bt(bH,bG));bA=[bG,bF],bH=bA[0],bG=bA[1]}}bw=bE.topoly();bw.name="a"+bs.name;return bw};a3=function(bw){var bP,bO,bL,bQ,bM,bK,bJ,bN,bz,by,bx,bC,bI,bv,bH,bG,bE,bB,bF,bD,bu,bt,bs,bA;console.log("Taking gyro of "+bw.name+"...");bL=new ai();bv=bw.xyz;for(bM=bJ=0,bN=bv.length;bJ<bN;bM=++bJ){bD=bv[bM];bL.newV("v"+bM,bk(bD))}bP=bw.centers();bH=bw.face;for(bM=bI=0,bz=bH.length;bI<bz;bM=++bI){bO=bH[bM];bL.newV("center"+bM,bk(bP[bM]))}bG=bw.face;for(bM=bF=0,by=bG.length;bF<by;bM=++bF){bO=bG[bM];bE=bO.slice(-2),bu=bE[0],bt=bE[1];for(bK=bA=0,bx=bO.length;bA<bx;bK=++bA){bD=bO[bK];bs=bD;bL.newV(bu+"~"+bt,at(bw.xyz[bu],bw.xyz[bt]));bQ=bM+"f"+bu;bL.newFlag(bQ,"center"+bM,bu+"~"+bt);bL.newFlag(bQ,bu+"~"+bt,bt+"~"+bu);bL.newFlag(bQ,bt+"~"+bu,"v"+bt);bL.newFlag(bQ,"v"+bt,bt+"~"+bs);bL.newFlag(bQ,bt+"~"+bs,"center"+bM);bB=[bt,bs],bu=bB[0],bt=bB[1]}}bC=bL.topoly();bC.name="g"+bw.name;return bC};s=function(bw){var bK,bH,bL,bI,bG,bJ,by,bx,bz,bF,bv,bE,bD,bB,bC,bA,bu,bt,bs;console.log("Taking propellor of "+bw.name+"...");bH=new ai();bv=bw.xyz;for(bI=bG=0,bJ=bv.length;bG<bJ;bI=++bG){bA=bv[bI];bH.newV("v"+bI,bk(bA))}bE=bw.face;for(bI=bF=0,by=bE.length;bF<by;bI=++bF){bK=bE[bI];bD=bK.slice(-2),bu=bD[0],bt=bD[1];for(bC=0,bx=bK.length;bC<bx;bC++){bA=bK[bC];bs=""+bA;bH.newV(bu+"~"+bt,at(bw.xyz[bu],bw.xyz[bt]));bL=bI+"f"+bt;bH.newFlag("v"+bI,bu+"~"+bt,bt+"~"+bs);bH.newFlag(bL,bu+"~"+bt,bt+"~"+bu);bH.newFlag(bL,bt+"~"+bu,"v"+bt);bH.newFlag(bL,"v"+bt,bt+"~"+bs);bH.newFlag(bL,bt+"~"+bs,bu+"~"+bt);bB=[bt,bs],bu=bB[0],bt=bB[1]}}bz=bH.topoly();bz.name="p"+bw.name;return bz};t=function(bw){var bu,bs,bx,bv,bt;console.log("Taking reflection of "+bw.name+"...");for(bu=bs=0,bv=bw.xyz.length-1;0<=bv?bs<=bv:bs>=bv;bu=0<=bv?++bs:--bs){bw.xyz[bu]=d(-1,bw.xyz[bu])}for(bu=bx=0,bt=bw.face.length-1;0<=bt?bx<=bt:bx>=bt;bu=0<=bt?++bx:--bx){bw.face[bu]=bw.face[bu].reverse()}bw.name="r"+bw.name;return bw};aI=function(bv){var bS,bR,bQ,bP,bT,bO,bA,bL,bM,bK,bJ,bN,bz,by,bx,bw,bI,bu,bG,bF,bD,bC,bH,bE,bt,bs,bB;console.log("Taking dual of "+bv.name+"...");bL=new ai();bA=[];for(bM=bJ=0,bu=bv.xyz.length-1;0<=bu?bJ<=bu:bJ>=bu;bM=0<=bu?++bJ:--bJ){bA[bM]={}}bG=bv.face;for(bM=bI=0,bN=bG.length;bI<bN;bM=++bI){bO=bG[bM];bt=bO[bO.length-1];for(bE=0,bz=bO.length;bE<bz;bE++){bs=bO[bE];bA[bt]["v"+bs]=""+bM;bt=bs}}bP=bv.centers();for(bM=bB=0,bF=bv.face.length-1;0<=bF?bB<=bF:bB>=bF;bM=0<=bF?++bB:--bB){bL.newV(""+bM,bP[bM])}bD=bv.face;for(bM=bS=0,by=bD.length;bS<by;bM=++bS){bO=bD[bM];bt=bO[bO.length-1];for(bR=0,bx=bO.length;bR<bx;bR++){bs=bO[bR];bL.newFlag(bt,bA[bs]["v"+bt],""+bM);bt=bs}}bT=bL.topoly();bH=[];bC=bT.face;for(bQ=0,bw=bC.length;bQ<bw;bQ++){bO=bC[bQ];bK=F(bv.face[bO[0]],bv.face[bO[1]],bv.face[bO[2]]);bH[bK]=bO}bT.face=bH;if(bv.name[0]!=="d"){bT.name="d"+bv.name}else{bT.name=bv.name.slice(1)}return bT};E=function(bw,bL,bx,bM){var bU,bS,bR,bO,bT,bu,bP,bN,bQ,bB,bA,bz,by,bD,bI,bK,bJ,bv,bH,bG,bF,bE,bt,bs,bC;bL||(bL=0);bx||(bx=0.5);bM||(bM=-0.2);console.log("Taking inset of "+(bL===0?"":bL)+"-sided faces of "+bw.name+"...");bO=new ai();bv=bw.xyz;for(bP=bN=0,bQ=bv.length;bN<bQ;bP=++bN){bJ=bv[bP];bO.newV("v"+bP,bJ)}bI=bw.normals();bS=bw.centers();bH=bw.face;for(bP=bK=0,bB=bH.length;bK<bB;bP=++bK){bR=bH[bP];if(bR.length===bL||bL===0){for(bF=0,bA=bR.length;bF<bA;bF++){bE=bR[bF];bO.newV("f"+bP+"v"+bE,z(l(bw.xyz[bE],bS[bP],bx),d(bM,bI[bP])))}}}bu=false;bG=bw.face;for(bP=bC=0,bz=bG.length;bC<bz;bP=++bC){bR=bG[bP];bt="v"+bR[bR.length-1];for(bU=0,by=bR.length;bU<by;bU++){bE=bR[bU];bs="v"+bE;if(bR.length===bL||bL===0){bu=true;bT=bP+bt;bO.newFlag(bT,bt,bs);bO.newFlag(bT,bs,"f"+bP+bs);bO.newFlag(bT,"f"+bP+bs,"f"+bP+bt);bO.newFlag(bT,"f"+bP+bt,bt);bO.newFlag("ex"+bP,"f"+bP+bt,"f"+bP+bs)}else{bO.newFlag(bP,bt,bs)}bt=bs}}if(!bu){console.log("No "+bL+"-fold components were found.")}bD=bO.topoly();bD.name="n"+(bL===0?"":bL)+bw.name;return bD};ac=function(bw,bK){var bR,bQ,bP,bM,bu,bN,bL,bO,bA,bz,by,bx,bC,bH,bJ,bI,bv,bG,bF,bE,bD,bt,bs,bB;bK||(bK=0);console.log("Taking extrusion of "+(bK===0?"":bK)+"-sided faces of "+bw.name+"...");bM=new ai();bv=bw.xyz;for(bN=bL=0,bO=bv.length;bL<bO;bN=++bL){bI=bv[bN];bM.newV("v"+bN,bI)}bH=bw.normals();bQ=bw.centers();bG=bw.face;for(bN=bJ=0,bA=bG.length;bJ<bA;bN=++bJ){bP=bG[bN];if(bP.length===bK||bK===0){for(bE=0,bz=bP.length;bE<bz;bE++){bD=bP[bE];bM.newV("f"+bN+"v"+bD,z(bw.xyz[bD],d(0.3,bH[bN])))}}}bu=false;bF=bw.face;for(bN=bB=0,by=bF.length;bB<by;bN=++bB){bP=bF[bN];bt="v"+bP[bP.length-1];for(bR=0,bx=bP.length;bR<bx;bR++){bD=bP[bR];bs="v"+bD;if(bP.length===bK||bK===0){bu=true;bM.newFlag(bN+bt,bt,bs);bM.newFlag(bN+bt,bs,"f"+bN+bs);bM.newFlag(bN+bt,"f"+bN+bs,"f"+bN+bt);bM.newFlag(bN+bt,"f"+bN+bt,bt);bM.newFlag("ex"+bN,"f"+bN+bt,"f"+bN+bs)}else{bM.newFlag(bN,bt,bs)}bt=bs}}if(!bu){console.log("No "+bK+"-fold components were found.")}bC=bM.topoly();bC.name="x"+(bK===0?"":bK)+bw.name;return bC};aY=function(by){var bR,bQ,bN,bO,bM,bP,bD,bB,bE,bL,bK,bx,bJ,bI,bG,bH,bF,bu,bS,bt,bw,bv,bs,bC,bA,bz;console.log("Taking stella of "+by.name+"...");bR=by.centers();bN=new ai();bx=by.xyz;for(bO=bM=0,bP=bx.length;bM<bP;bO=++bM){bK=bx[bO];bN.newV("v"+bO,bK)}bJ=by.face;for(bO=bL=0,bD=bJ.length;bL<bD;bO=++bL){bQ=bJ[bO];bu="v"+bQ[bQ.length-2];bt="v"+bQ[bQ.length-1];bC=by.xyz[bQ[bQ.length-2]];bA=by.xyz[bQ[bQ.length-1]];for(bH=0,bB=bQ.length;bH<bB;bH++){bF=bQ[bH];bs="v"+bF;bz=by.xyz[bF];bS=bu+"~"+bt;bw=bt+"~"+bu;bv=bt+"~"+bs;bN.newV(bS,aV(aV(bC,bA),bR[bO]));bN.newFlag("in"+bO,bS,bv);bN.newFlag("f"+bO+bt,bv,bS);bN.newFlag("f"+bO+bt,bS,bt);bN.newFlag("f"+bO+bt,bt,bv);bN.newFlag("f"+bS,bu,bw);bN.newFlag("f"+bS,bw,bS);bN.newFlag("f"+bS,bS,bu);bI=[bt,bs],bu=bI[0],bt=bI[1];bG=[bA,bz],bC=bG[0],bA=bG[1]}}bE=bN.topoly();bE.name="l"+by.name;return bE};aa=function(bv,bu){var bz,by,bx,bt,bw,bs,bA;bz=0.1;bs=a5(bv);for(bt=0,bw=bu.length;bt<bw;bt++){bx=bu[bt];bA=k(bs[bx[0]],bs[bx[1]]);by=d(bz*1/2*(1-V(D(bA,bA))),bA);bs[bx[0]]=z(bs[bx[0]],by);bs[bx[1]]=z(bs[bx[1]],by)}return bs};ba=function(bw,bv){var bz,by,bs,bt,bx,bu,bA;bs=(function(){var bC,bB,bE,bD;bD=[];for(bC=0,bB=bv.length;bC<bB;bC++){bE=bv[bC],bz=bE[0],by=bE[1];bD.push(k(bw[bz],bw[by]))}return bD})();bu=[0,0,0];for(bt=0,bx=bs.length;bt<bx;bt++){bA=bs[bt];bu=z(bu,bA)}bu=d(1/bv.length,bu);return _.map(bw,function(bB){return be(bB,bu)})};B=function(bv){var bs,bu,bt;bu=[0,0,0];bs=_.max(_.map(bv,function(bw){return K(bw)}));bt=1/bs;return _.map(bv,function(bw){return[bt*bw[0],bt*bw[1],bt*bw[2]]})};bd=function(by,bv){var bD,bB,bC,bz,bw,bA,bx,bu,bs,bt,bE;bD=0.1;bs=a5(by);for(bw=0,bA=bv.length;bw<bA;bw++){bz=bv[bw];bC=(function(){var bF,bH,bG;bG=[];for(bH=0,bF=bz.length;bH<bF;bH++){bE=bz[bH];bG.push(by[bE])}return bG})();bu=ak(bC);bB=bj(bC);if(D(bu,bB)<0){bu=d(-1,bu)}for(bt=0,bx=bz.length;bt<bx;bt++){bE=bz[bt];bs[bE]=z(bs[bE],d(D(d(bD,bu),be(bB,by[bE])),bu))}}return bs};n=function(bt,bB){var by,bv,bz,bx,bA,bs,bw,bC,bu;bB||(bB=1);console.log("Canonicalizing "+bt.name+"...");bv=bt.face;by=bt.edges();bs=bt.xyz;bA=1;for(bz=bx=0,bu=bB;0<=bu?bx<=bu:bx>=bu;bz=0<=bu?++bx:--bx){bC=a5(bs);bs=aa(bs,by);bs=ba(bs,by);bs=bd(bs,bv);bA=_.max(_.map(_.zip(bs,bC),function(bE){var bD,bF;bD=bE[0],bF=bE[1];return K(be(bD,bF))}));if(bA<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bA+"]");bw=new aP(bs,bt.face,bt.name);console.log("canonicalize",bw);return bw};O=function(bv){var bw,bu,bt,bs;bu=bv.centers();for(bt=0,bs=bu.length;bt<bs;bt++){bw=bu[bt];bw=d(1/D(bw,bw),bw)}return bu};H=function(bt){var bI,bA,bv,bC,bx,bD,by,bs,bu,bw,bE,bB,bz,bH,bG,bF;bI=[];bw=bt.face;for(bx=0,bD=bw.length;bx<bD;bx++){bC=bw[bx];bv=[0,0,0];bs=[0,0,0];bA=0;bE=bC.slice(-2),bH=bE[0],bG=bE[1];for(bu=0,by=bC.length;bu<by;bu++){bF=bC[bu];bv=z(bv,bt.xyz[bF]);bs=z(bs,aW(bt.xyz[bH],bt.xyz[bG],bt.xyz[bF]));bA+=au(bt.xyz[bH],bt.xyz[bG]);bB=[bG,bF],bH=bB[0],bG=bB[1]}bv=d(1/bC.length,bv);bs=bk(bs);bA=bA/bC.length;bz=aC(d(D(bv,bs),bs));bI.push(d((1+bA)/2,bz))}return bI};g=function(bx,bu){var bw,bt,bs,bv;bu||(bu=1);bt=aI(bx);console.log("Pseudo-canonicalizing "+bx.name+"...");for(bw=bs=0,bv=bu-1;0<=bv?bs<=bv:bs>=bv;bw=0<=bv?++bs:--bs){bt.xyz=H(bx);bx.xyz=H(bt)}return new aP(bx.xyz,bx.face,bx.name)};y=function(bx,bu){var bw,bt,bs,bv;bu||(bu=1);bt=aI(bx);console.log("Planarizing "+bx.name+"...");for(bw=bs=0,bv=bu-1;0<=bv?bs<=bv:bs>=bv;bw=0<=bv?++bs:--bs){bt.xyz=O(bx);bx.xyz=O(bt)}return new aP(bx.xyz,bx.face,bx.name)};J=function(bU){var bT,bP,bI,bN,bS,bB,bV,bL,bG,bD,bR,bw,bO,bH,by,bz,bM,bC,bK,bQ,bA,bJ,bx,bv,bu,bt,bs,bF,bE;bC=999;bO=[];bH=[];by=bU.length;bR=function(bW,bX){return(bW||bX)&&!(bW&&bX)};bT=function(bY,bX,bW){return(bX[0]-bY[0])*(bW[1]-bY[1])-(bW[0]-bY[0])*(bX[1]-bY[1])};bG=function(bY,bX,bW){return bT(bY,bX,bW)>0};bD=function(bY,bX,bW){return bT(bY,bX,bW)>=0};bI=function(bY,bX,bW){return bT(bY,bX,bW)===0};bP=function(bY,bX,bW){if(bI(bY,bX,bW)){return false}if(bY[0]!==bX[0]){return(bY[0]<=bW[0])&&(bW[0]<=bX[0])||(bY[0]>=bW[0])&&(bW[0]>=bX[0])}else{return(bY[1]<=bW[1])&&(bW[1]<=bX[1])||(bY[1]>=bW[1])&&(bW[1]>=bX[1])}};bL=function(bZ,bY,bX,bW){if(bI(bZ,bY,bX)||bI(bZ,bY,bW)||bI(bX,bW,bZ)||bI(bX,bW,bY)){return false}return bR(bG(bZ,bY,bX),bG(bZ,bY,bW))&&bR(bG(bX,bW,bZ),bG(bX,bW,bY))};bV=function(bZ,bY,bX,bW){if(bL(bZ,bY,bX,bW)){return true}else{if(bP(bZ,bY,bX)||bP(bZ,bY,bW)||bP(bX,bW,bZ)||bP(bX,bW,bY)){return true}else{return false}}};bB=function(bY,bW){var bZ,bX;bX=(bY+1+by)%by;bZ=(bY-1+by)%by;if(bD(bU[bY],bU[bX],bU[bZ])){return bG(bU[bY],bU[bW],bU[bZ])&&bG(bU[bW],bU[bY],bU[bX])}return !(bD(bU[bY],bU[bW],bU[bX])&&bD(bU[bW],bU[bY],bU[bZ]))};bS=function(bX,bW){var bZ,bY;bZ=0;while(true){bY=(bZ+1+by)%by;if((bZ!==bX)&&(bY!==bX)&&(bZ!==bW)&&(bY!==bW)&&bL(bU[bX],bU[bW],bU[bZ],bU[bY])){return false}bZ=(bZ+1+by)%by;if(bZ===0){break}}return true};bN=function(bX,bW){return bB(bX,bW)&&bB(bW,bX)&&bS(bX,bW)};bv=0;while(true){bu=(bv+1+by)%by;bx=(bv-1+by)%by;bH[bv]=bN(bx,bu);bv=(bv+1+by)%by;if(bv===0){break}}bQ=(function(){bJ=[];for(var bW=0,bX=by-1;0<=bX?bW<=bX:bW>=bX;0<=bX?bW++:bW--){bJ.push(bW)}return bJ}).apply(this);bK=by;bE=bC;bz=0;while(bE>0&&bK>3){bE-=1;bu=bz;bF=bC;while(true){bF-=1;bw=false;if(bH[bu]){bt=(bu+1+by)%by;bs=(bt+1+by)%by;bv=(bu-1+by)%by;bx=(bv-1+by)%by;bO.push([bQ[bv],bQ[bt]]);bH[bv]=bN(bx,bt);bH[bt]=bN(bv,bs);bU=bU.slice(0,+bu+1||9000000000).concat(bU.slice(bt));bQ=bQ.slice(0,+bu+1||9000000000).concat(bQ.slice(bt));if(bx>bu){bx-=1}if(bv>bu){bv-=1}if(bt>bu){bt-=1}if(bs>bu){bs-=1}by--;bz=bt;bK--;bw=true}bu=(bu+1+by)%by;if(!(bF>0&&!bw&&bu!==bz)){break}}}return bO};a=function(bt,bs){if(((bt[0]===bs[0])&&(bt[1]===bs[1])&&(bt[2]===bs[2]))||(bt[0]===bs[1])&&(bt[1]===bs[2])&&(bt[2]===bs[0])||(bt[0]===bs[2])&&(bt[1]===bs[0])&&(bt[2]===bs[1])){return true}else{return false}};u=function(bZ,bR){var bM,bK,bI,bG,bE,bO,b0,bQ,bP,bL,bS,bY,bX,bN,bA,bz,by,bx,bw,bv,bu,bt,bW,bs,bV,bJ,bH,bF,bD,bC,bB,b1,bU,b4,b3,b2,bT;bL=[];bs=[];bV=(function(){var b7,b6,b5;b5=[];for(bY=b7=0,b6=bZ.length-1;0<=b6?b7<=b6:b7>=b6;bY=0<=b6?++b7:--b7){b5.push([bY,(bY+1)%bZ.length])}return b5})();for(bX=0,bN=bV.length;bX<bN;bX++){bJ=bV[bX],b3=bJ[0],b2=bJ[1];bL[b3]=[b2];bs[b2]=[b3]}for(bW=0,bA=bR.length;bW<bA;bW++){b0=bR[bW];bL[b0[0]].push(b0[1]);bL[b0[1]].push(b0[0]);bs[b0[0]].push(b0[1]);bs[b0[1]].push(b0[0])}b1=[];for(bU=0,bz=bR.length;bU<bz;bU++){b0=bR[bU];bH=bL[b0[1]];for(bT=0,by=bH.length;bT<by;bT++){bQ=bH[bT];bF=bs[b0[0]];for(bM=0,bx=bF.length;bM<bx;bM++){bP=bF[bM];if(bQ===bP){b1.push([b0[0],b0[1],bQ])}}}bD=bL[b0[0]];for(bK=0,bw=bD.length;bK<bw;bK++){bQ=bD[bK];bC=bs[b0[1]];for(bI=0,bv=bC.length;bI<bv;bI++){bP=bC[bI];if(bQ===bP){b1.push([b0[1],b0[0],bQ])}}}}b4=[b1.pop()];for(bG=0,bu=b1.length;bG<bu;bG++){bB=b1[bG];bO=false;for(bE=0,bt=b4.length;bE<bt;bE++){bS=b4[bE];if(a(bB,bS)){bO=true;break}}if(!bO){b4.push(bB)}}return b4};ab=function(bt,bs){var bw,bv,bE,bC,bB,bz,bD,bA,by,bu,bx,bH,bG,bF;bs=bs||false;console.log("Triangulating faces of "+bt.name+"...");by=new aP();by.xyz=L(bt.xyz);by.face_class=[];bx=bt.face;for(bC=bz=0,bD=bx.length;bz<bD;bC=++bz){bE=bx[bC];if(bE.length>3){bw=Z((function(){var bI,bK,bJ;bJ=[];for(bK=0,bI=bE.length;bK<bI;bK++){bF=bE[bK];bJ.push(bt.xyz[bF])}return bJ})());bv=J(bw);bG=u(bE,bv);for(bB=bu=0,bA=bG.length;bu<bA;bB=++bu){bH=bG[bB];by.face.push([bE[bH[0]],bE[bH[1]],bE[bH[2]]]);if(bs){by.face_class.push(bt.face_class[bC])}}}else{by.face.push([bE[0],bE[1],bE[2]]);if(bs){by.face_class.push(bt.face_class[bC])}}}by.name=bt.name;return by};ah=function(bs){var bx,bv,by,bw,bt,bu,bz,bA;bz="";bu=bs.face;for(bv=0,by=bu.length;bv<by;bv++){bx=bu[bv];for(bt=0,bw=bx.length;bt<bw;bt++){bA=bx[bt];bz+=bA+"->"}bz+="\n"}return console.log(bz)};C=function(){var bv,bs,bw,by,bz,bx,bu,bt;bt=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bx=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bv=0,bs=bx.length;bv<bs;bv++){bz=bx[bv];console.log("Operator "+bz);for(by=0,bw=bt.length;by<bw;by++){bu=bt[by];console.log(bz+bu+":",generatePoly(bz+bu))}}return console.log("===== Done Testing Basic Ops =====")};aS='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';bf=PEG.buildParser(aS);br=function(bt,bs){return bt.apply(this,bs||[])};bh={T:f,O:ap,C:aj,I:a7,D:aq,P:T,A:aX,Y:bo};G={d:aI,k:ad,a:aH,g:a3,p:s,r:t,n:E,x:ac,l:aY,z:ab,K:g,C:n,A:y};aO=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a1=function(bx){var bt,bv,bu,bs,by,bw;bv=bx;for(bu=0,bs=aO.length;bu<bs;bu++){bw=aO[bu],by=bw[0],bt=bw[1];bv=bv.replace(by,bt)}console.log(bx+" executed as "+bv);return bv};bp=function(bz){var bt,bA,bu,bx,bv,bC,bw,bB,by,bs;by=a1(bz);bB=bf.parse(by).reverse();bv=bB.shift();bA=bh[bv.op];bt=bv.args;bs=br(bA,bt);for(bu=0,bx=bB.length;bu<bx;bu++){bv=bB[bu];bw=G[bv.op];bC=[bs].concat(bv.args);bs=br(bw,bC)}bs.xyz=ba(bs.xyz,bs.edges());bs.xyz=B(bs.xyz);bs=Q(bs);return bs};ae={};bl=500;az=400;P={};j=L(v);al=L(v);U=800;A=5;bm=0;M=0.8;o=bl/2;aw=az/2;w=new Date();q=true;aT="rgba(255,255,255,1.0)";an="signature";h="fillstroke";bc=0.5;ao=false;X=0;W=0;aG=[1,0,0];a4=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aE=function(bu,bs){var bv,bt;bv=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bt=new bv();bt.append(bu);return saveAs(bt.getBlob("text/plain;charset="+document.characterSet),bs)};bn=function(){var bs,bx,bw,bv,bu,bt;bt={};bs=/\+/g;bu=/([^&=]+)=?([^&]*)/g;bx=function(by){return decodeURIComponent(by.replace(bs," "))};bv=window.location.search.substring(1);while(bw=bu.exec(bv)){bt[bx(bw[1])]=bx(bw[2])}return bt};aK=function(){var bs;bs=$("#poly");bs.width(bl);bs.height(az);ae=bs[0].getContext("2d");ae.lineWidth=bc;if(q){return ae.clearRect(0,0,bl,az)}else{ae.clearRect(0,0,bl,az);ae.fillStyle=aT;return ae.fillRect(0,0,bl,az)}};aM=function(){if(q){return ae.clearRect(0,0,bl,az)}else{ae.clearRect(0,0,bl,az);ae.fillStyle=aT;return ae.fillRect(0,0,bl,az)}};R=function(bx,bK){var bs,bA,by,bF,bt,bI,bJ,bz,bH,bu,bw,bG,bE,bD,bv,bC,bB;bK||(bK=[3,3,3]);bu=_.map(bx.xyz,function(bL){return bL});bx.xyz=_.map(bx.xyz,function(bL){return r(j,bL)});aR(bx);bw=bx.face;for(bF=bI=0,bJ=bw.length;bI<bJ;bF=++bI){bA=bw[bF];ae.beginPath();bv=bA[bA.length-1];bG=x(z(bK,bx.xyz[bv]),A,bm,M,U),bC=bG[0],bB=bG[1];ae.moveTo(bC+o,bB+aw);for(bH=0,bz=bA.length;bH<bz;bH++){bD=bA[bH];bE=x(z(bK,bx.xyz[bD]),A,bm,M,U),bC=bE[0],bB=bE[1];ae.lineTo(bC+o,bB+aw)}bs=ag(bx.face_class[bF]);by=(function(){var bL,bN,bM;bN=[];for(bM=0,bL=bA.length;bM<bL;bM++){bD=bA[bM];bN.push(bx.xyz[bD])}return bN})();bt=D(ak(by),bk([1,-1,0]));bs=d((bt/2+0.5)*0.7+0.3,bs);if(h==="fill"||h==="fillstroke"){ae.fillStyle="rgba("+(Y(bs[0]*255))+", "+(Y(bs[1]*255))+", "+(Y(bs[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba("+(Y(bs[0]*255))+", "+(Y(bs[1]*255))+", "+(Y(bs[2]*255))+", "+1+")";ae.stroke()}if(h==="fillstroke"){ae.fillStyle="rgba("+(Y(bs[0]*255))+", "+(Y(bs[1]*255))+", "+(Y(bs[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba(0,0,0, .3)";ae.stroke()}if(h==="stroke"){ae.strokeStyle="rgba(0,0,0, .8)";ae.stroke()}}return bx.xyz=bu};aB=function(){var bv,bt,bs,bw,bu;aM();bu=[];for(bv=bt=0,bs=P.length;bt<bs;bv=++bt){bw=P[bv];bu.push(R(bw,[0+3*bv,0,3]))}return bu};av=function(){var bv,bt,bs,bw,bu;bu=[];for(bv=bt=0,bs=P.length;bt<bs;bv=++bt){bw=P[bv];$("#V").text(bw.xyz.length);$("#E").text(bw.xyz.length+bw.face.length-2);bu.push($("#F").text(bw.face.length))}return bu};bg=function(){var bu,bv,bt,bs,bw;aM();bu=(2*Math.PI)/180*w.getSeconds()*0.1;for(bv=bt=0,bs=P.length;bt<bs;bv=++bt){bw=P[bv];R(bw,[0+3*bv,0,3])}return setTimeout(bg,100)};$(function(){var bt,bs;aK();bs=bn();if("recipe" in bs){bt=[bs.recipe];$("#spec").val(bt)}else{bt=[bb(a4)];$("#spec").val(bt)}$("#palette").val(a0.reduce(function(bu,bv){return bu+" "+bv}));P=_.map(bt,function(bu){return bp(bu)});av();aB();$("#spec").change(function(bu){bt=$("#spec").val().split(/\s+/g).slice(0,2);P=_.map(bt,function(bv){return bp(bv)});av();return aB()});$("#palette").change(function(bu){a0=$(this).val().split(/\s+/g);return aB()});$("#poly").mousewheel(function(bw,bx,bv,bu){bw.preventDefault();U*=(10+bx)/10;return aB()});$("#poly").mousedown(function(bu){var bv;bu.preventDefault();ao=true;X=bu.clientX-$(this).offset().left;W=bu.clientY-($(this).offset().top-$(window).scrollTop());bv=aL(X,W,o,aw,A,bm,M,U);if(bv[0]*bv[1]*bv[2]*0===0){aG=bv}return al=L(j)});$("#poly").mouseup(function(bu){bu.preventDefault();return ao=false});$("#poly").mouseleave(function(bu){bu.preventDefault();return ao=false});$("#poly").mousemove(function(bx){var bv,bu,bw;bx.preventDefault();if(ao){bv=bx.clientX-$(this).offset().left;bu=bx.clientY-($(this).offset().top-$(window).scrollTop());bw=aL(bv,bu,o,aw,A,bm,M,U);if(bw[0]*bw[1]*bw[2]*0===0&&aG[0]*aG[1]*aG[2]*0===0){j=aF(aD(aG,bw),al)}return aB()}});$("#strokeonly").click(function(bu){h="stroke";return aB()});$("#fillonly").click(function(bu){h="fill";return aB()});$("#fillandstroke").click(function(bu){h="fillstroke";return aB()});$("#siderot").click(function(bu){j=aU(aJ/2,0,1,0);return aB()});$("#toprot").click(function(bu){j=aU(aJ/2,1,0,0);return aB()});$("#frontrot").click(function(bu){j=i(0,0,0);return aB()});$("#pngsavebutton").click(function(bx){var bw,bv,bu;bw=$("#poly")[0];bu=$("#spec").val().split(/\s+/g)[0];bv="polyhedronisme-"+bu.replace(/\([^\)]+\)/g,"")+".png";return bw.toBlob(function(by){return saveAs(by,bv)})});$("#objsavebutton").click(function(bx){var bv,bw,bu;bw=P[0].toOBJ();bu=$("#spec").val().split(/\s+/g)[0];bv="polyhedronisme-"+bu.replace(/\([^\)]+\)/g,"")+".obj";return aE(bw,bv)});return $("#x3dsavebutton").click(function(bx){var bv,bu,bw,by;bw=ab(P[0],true);by=bw.toVRML();bu=$("#spec").val().split(/\s+/g)[0];bv="polyhedronisme-"+bu.replace(/\([^\)]+\)/g,"")+".wrl";return aE(by,bv)})})}).call(this);