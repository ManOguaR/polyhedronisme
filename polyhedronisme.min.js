(function(){var q,aU,aA,bm,an,a5,S,X,W,aH,ao,a1,aT,aK,h,o,ax,p,af,a3,z,y,aI,bh,aY,N,az,bi,bk,g,n,aN,L,bj,a6,I,ay,ae,bd,aj,u,bs,aq,D,aC,R,aJ,av,ac,v,aB,a9,am,J,a2,aE,P,j,al,w,a4,br,a8,aL,E,F,aM,ad,e,m,K,a7,aW,aG,d,r,bq,ak,ap,au,bg,G,aX,Q,ag,bo,x,M,A,bn,U,be,ai,aQ,ba,T,Z,s,bp,aO,bc,bb,aD,O,H,t,B,i,Y,aR,aF,ar,at,a0,aS,aP,V,aZ,bf,b,k,aa,C,f,ah,a,ab,l,bl,aw,aV,c;aO=Math.random;Y=Math.round;am=Math.floor;V=Math.sqrt;a0=Math.sin;I=Math.cos;b=Math.tan;N=Math.asin;a3=Math.acos;az=Math.atan;ba=Math.pow;af=Math.abs;aK=Math.PI;S=Math.LN10;e=Math.log;ba=Math.pow;m=function(bt){return e(bt)/S};at=function(bv,bu){var bt;bt=ba(10,m(bv)-am(m(bv)));return""+(Y(bt*(bu-1)))};L=function(bv){var bu,bt;if((bv==null)||typeof bv!=="object"){return bv}bt=new bv.constructor();for(bu in bv){bt[bu]=L(bv[bu])}return bt};bc=function(bu){var bt;bt=am(aO()*bu.length);return bu[bt]};d=function(bu,bt){return[bu*bt[0],bu*bt[1],bu*bt[2]]};p=function(bu,bt){return[bu[0]*bt[0],bu[1]*bt[1],bu[2]*bt[2]]};z=function(bu,bt){return[bu[0]+bt[0],bu[1]+bt[1],bu[2]+bt[2]]};bf=function(bu,bt){return[bu[0]-bt[0],bu[1]-bt[1],bu[2]-bt[2]]};D=function(bu,bt){return bu[0]*bt[0]+bu[1]*bt[1]+bu[2]*bt[2]};ay=function(bu,bt){return[bu[1]*bt[2]-bu[2]*bt[1],bu[2]*bt[0]-bu[0]*bt[2],bu[0]*bt[1]-bu[1]*bt[0]]};K=function(bt){return V(D(bt,bt))};a7=function(bt){return D(bt,bt)};bl=function(bt){return d(1/V(a7(bt)),bt)};aW=function(bu,bt){return d(1/2,z(bu,bt))};l=function(bv,bu,bt){return[(1-bt)*bv[0]+bt*bu[0],(1-bt)*bv[1]+bt*bu[1],(1-bt)*bv[2]+bt*bu[2]]};au=function(bu,bt){return l(bu,bt,1/3)};aD=function(bt){return d(1/a7(bt),bt)};k=function(bv,bu){var bt;bt=bf(bu,bv);return bf(bv,d(D(bt,bv)/a7(bt),bt))};av=function(bu,bt){return V(a7(k(bu,bt)))};aX=function(bx,bw,bv){var bu,bt;bu=bf(bw,bx);bt=bf(bv,bw);return ay(bu,bt)};F=function(bz,by,bw){var bu,bA,bx,bv,bt,bD,bC,bB,bE;for(bu=0,bA=bz.length;bu<bA;bu++){bD=bz[bu];for(bt=0,bx=by.length;bt<bx;bt++){bC=by[bt];if(bD===bC){for(bE=0,bv=bw.length;bE<bv;bE++){bB=bw[bE];if(bD===bB){return bD}}}}}return null};bk=function(bx){var bw,bu,bt,bv;bw=[0,0,0];for(bu=0,bt=bx.length;bu<bt;bu++){bv=bx[bu];bw=z(bw,bv)}return d(1/bx.length,bw)};ak=function(bw){var bv,bx,bt,bu,by,bB,bA,bz;bt=[0,0,0];bu=bw.slice(-2),bB=bu[0],bA=bu[1];for(bv=0,bx=bw.length;bv<bx;bv++){bz=bw[bv];bt=z(bt,aX(bB,bA,bz));by=[bA,bz],bB=by[0],bA=by[1]}return bl(bt)};bj=function(bw){var bt,bv,bx,bu,by,bB,bA,bz;bt=0;bu=bw.slice(0,2),bB=bu[0],bA=bu[1];by=bw.slice(2);for(bv=0,bx=by.length;bv<bx;bv++){bz=by[bv];bt+=K(ay(bf(bA,bB),bf(bz,bB)));bA=bz}return bt};aB=function(bA){var by,bv,bB,bx,bw,bt,bu,bC,bz,bI,bH,bG,bF,bD,bE;by=[];bu=bA.slice(0,2),bG=bu[0],bF=bu[1];bC=bA.slice(2);for(bv=0,bB=bC.length;bv<bB;bv++){bD=bC[bv];by.push(K(ay(bf(bF,bG),bf(bD,bG))));bF=bD}by.sort(function(bK,bJ){return bK-bJ});bI="";for(bt=0,bx=by.length;bt<bx;bt++){bE=by[bt];bI+=at(bE,2)}bz=by.reverse();for(bH=0,bw=bz.length;bH<bw;bH++){bE=bz[bH];bI+=at(bE,2)}return bI};Z=function(bA){var bz,bv,by,bu,bt,bx,bw,bC,bB;bw=L(bA);bB=bA[0];bw=_.map(bw,function(bD){return bD-bB});bu=ak(bA);bz=bl(bk(bA));bt=ay(bu,bz);bx=[];for(bv=0,by=bw.length;bv<by;bv++){bC=bw[bv];bx.push([D(bu,bC),D(bt,bC)])}return bx};a6=function(bw){var bv,bu,bt,bx;bt=new Array(bw.length);for(bv=bu=0,bx=bw.length-1;0<=bx?bu<=bx:bu>=bx;bv=0<=bx?++bu:--bu){bt[bv]=bw[bv].slice(0)}return bt};r=function(bu,bt){return[bu[0][0]*bt[0]+bu[0][1]*bt[1]+bu[0][2]*bt[2],bu[1][0]*bt[0]+bu[1][1]*bt[1]+bu[1][2]*bt[2],bu[2][0]*bt[0]+bu[2][1]*bt[1]+bu[2][2]*bt[2]]};aG=function(bt,bu){return[[bt[0][0]*bu[0][0]+bt[0][1]*bu[1][0]+bt[0][2]*bu[2][0],bt[0][0]*bu[0][1]+bt[0][1]*bu[1][1]+bt[0][2]*bu[2][1],bt[0][0]*bu[0][2]+bt[0][1]*bu[1][2]+bt[0][2]*bu[2][2]],[bt[1][0]*bu[0][0]+bt[1][1]*bu[1][0]+bt[1][2]*bu[2][0],bt[1][0]*bu[0][1]+bt[1][1]*bu[1][1]+bt[1][2]*bu[2][1],bt[1][0]*bu[0][2]+bt[1][1]*bu[1][2]+bt[1][2]*bu[2][2]],[bt[2][0]*bu[0][0]+bt[2][1]*bu[1][0]+bt[2][2]*bu[2][0],bt[2][0]*bu[0][1]+bt[2][1]*bu[1][1]+bt[2][2]*bu[2][1],bt[2][0]*bu[0][2]+bt[2][1]*bu[1][2]+bt[2][2]*bu[2][2]]]};v=[[1,0,0],[0,1,0],[0,0,1]];i=function(bx,bv,bw){var by,bu,bt;by=[[I(bx),-1*a0(bx),0],[a0(bx),I(bx),0],[0,0,1]];bt=[[I(bv),0,-1*a0(bv)],[0,1,0],[a0(bv),0,I(bv)]];bu=[[1,0,0],[0,I(bw),-1*a0(bw)],[0,a0(bw),I(bw)]];return aG(bu,aG(bt,by))};aV=function(bx,bG,bF,bB){var bz,bu,bw,bv,bA,bE,bD,bt,bC,by;bx/=2;bE=a0(bx);bz=I(bx);bD=bE*bE;bu=K([bG,bF,bB]);if(bu===0){bv=[0,0,1],bG=bv[0],bF=bv[1],bB=bv[2]}if(bu!==1){bA=bl([bG,bF,bB]),bG=bA[0],bF=bA[1],bB=bA[2]}if(bG===1&&bF===0&&bB===0){bw=[[1,0,0],[0,1-2*bD,2*bE*bz],[0,-2*bE*bz,1-2*bD]]}else{if(bG===0&&bF===1&&bB===0){bw=[[1-2*bD,0,-2*bE*bz],[0,1,0],[2*bE*bz,0,1-2*bD]]}else{if(bG===0&&bF===0&&bB===1){bw=[[1-2*bD,2*bE*bz,0],[-2*bE*bz,1-2*bD,0],[0,0,1]]}else{bt=bG*bG;bC=bF*bF;by=bB*bB;bw=[[1-2*(bC+by)*bD,2*(bG*bF*bD+bB*bE*bz),2*(bG*bB*bD-bF*bE*bz)],[2*(bF*bG*bD-bB*bE*bz),1-2*(by+bt)*bD,2*(bF*bB*bD+bG*bE*bz)],[2*(bB*bG*bD+bF*bE*bz),2*(bB*bF*bD-bG*bE*bz),1-2*(bt+bC)*bD]]}}}return bw};x=function(bv,bu,bw,bz,bt){var bx,by;by=(bu*bz-bw)/(1-bz);bx=bt*bz/(1-bz);return[bx*bv[0]/(bv[2]+by),bx*bv[1]/(bv[2]+by)]};aM=function(bA,bx,bD,bB,bH,bw,bv,bu){var bG,bt,bC,by,bE,bJ,bL,bz,bF,bI,bK;bF=(bH*bv-bw)/(1-bv);bG=bu*bv/(1-bv);bC=bA-bD;bJ=bx-bB;bt=bG*bG;bI=bF*bF;by=bC*bC;bL=bJ*bJ;bE=(2*bG*bC*bF+V(4*bt*by*bI+4*by*(bt+by+bL)*(1-bI)))/(2*(bt+by+bL));bz=(bG*bJ*bF)/(bt+by+bL)+(bJ*V(4*bt*bI+4*(bt+by+bL)*(1-bI)))/(2*(bt+by+bL));bK=V(1-bE*bE-bz*bz);return[bE,bz,bK]};aE=function(bv,bu){var bw,bt;bt=ay(bv,bu);bw=a3(D(bv,bu));return aV(-1*bw,bt[0],bt[1],bt[2])};a9=function(bw){var bv,bu,bt,by,bx;bv=[];by=bw.slice(-1)[0];for(bu=0,bt=bw.length;bu<bt;bu++){bx=bw[bu];bv.push([by,bx]);by=bx}return bv};c=function(bt){var bz,by,bw,bA,bx,bu,bv,bC,bB;bB=[];bv=bt.face;for(by=bw=0,bA=bv.length;bw<bA;by=++bw){bz=bv[by];for(bu=0,bx=bz.length;bu<bx;bu++){bC=bz[bu];bB[bC]=bt.face_class[by]}}return bB};aR=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];br=function(bu){var bt;if(bu[0]==="#"){bu=bu.slice(1)}if(bu.length===3){bt=bu.split("").map(function(bv){return parseInt(bv+bv,16)/255})}else{bt=bu.match(/.{2}/g).map(function(bv){return parseInt(bv,16)/255})}return bt};a1=aR;ag=function(bt){if(bt<a1.length){return br(a1[bt])}else{return br(a1[a1.length-1])}};Q=function(bt){var bC,bv,bz,bx,bB,bw,by,bu,bA;bt.face_class=[];bz={};bv=function(bD,bG){var bE,bF;bF=Y(100*bD);if(bF in bG){return bG[bF]}else{bE=_.toArray(bG).length;bG[bF]=bE;return bE}};bu=bt.face;for(bw=0,by=bu.length;bw<by;bw++){bx=bu[bw];if(an==="area"){bB=(function(){var bD,bF,bE;bE=[];for(bF=0,bD=bx.length;bF<bD;bF++){bA=bx[bF];bE.push(bt.xyz[bA])}return bE})();bC=bv(bj(bB),bz)}else{if(an==="signature"){bB=(function(){var bD,bF,bE;bE=[];for(bF=0,bD=bx.length;bF<bD;bF++){bA=bx[bF];bE.push(bt.xyz[bA])}return bE})();bC=bv(aB(bB),bz)}else{bC=bx.length-3}}bt.face_class.push(bC)}console.log(_.toArray(bz).length+" face classes");return bt};aS=function(bt){var bu,bC,bx,bB,bD,by,bw,bz,bv,bA;bu=bt.centers();bB=bt.normals();by=[0,0,(A*M-bn)/(1-M)];bD=function(bF,bE){return -D(bf(by,bF[0]),bF[1])*D(bf(bE[0],bF[0]),bF[1])};bv=function(bF,bE){return bF[0][2]-bE[0][2]};bA=_.zip(bu,bB,(function(){bz=[];for(var bE=0,bF=bt.face.length-1;0<=bF?bE<=bF:bE>=bF;0<=bF?bE++:bE--){bz.push(bE)}return bz}).apply(this)).sort(bv).map(function(bE){return bE[2]});bt.face=(function(){var bE,bG,bF;bF=[];for(bG=0,bE=bA.length;bG<bE;bG++){bC=bA[bG];bF.push(bt.face[bC])}return bF})();return bt.face_class=(function(){var bE,bG,bF;bF=[];for(bG=0,bE=bA.length;bG<bE;bG++){bC=bA[bG];bF.push(bt.face_class[bC])}return bF})()};aQ=(function(){function bt(bw,bu,bv){this.face=bu||new Array();this.xyz=bw||new Array();this.name=bv||"null polyhedron"}bt.prototype.data=function(){var bu;bu=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bu+" edges, "+this.xyz.length+" vertices)"};bt.prototype.edges=function(){var bE,bB,bD,bC,bu,bA,by,bw,bz,bx,bv,bF;bA={};bF=[];bB=_.map(this.face,a9);for(bw=0,bz=bB.length;bw<bz;bw++){bu=bB[bw];for(bv=0,bx=bu.length;bv<bx;bv++){bC=bu[bv];if(bC[0]<bC[1]){bE=bC[0],bD=bC[1]}else{bD=bC[0],bE=bC[1]}bA[bE+"~"+bD]=bC}}for(by in bA){bC=bA[by];bF.push(bC)}return bF};bt.prototype.centers=function(){var bz,bA,bx,bw,bB,by,bu,bv,bC;bz=[];bv=this.face;for(bw=0,bB=bv.length;bw<bB;bw++){bA=bv[bw];bx=[0,0,0];for(bu=0,by=bA.length;bu<by;bu++){bC=bA[bu];bx=z(bx,this.xyz[bC])}bz.push(d(1/bA.length,bx))}return bz};bt.prototype.normals=function(){var by,bv,bu,bz,bx,bw;bz=[];bx=this.face;for(bv=0,bu=bx.length;bv<bu;bv++){by=bx[bv];bz.push(ak((function(){var bA,bC,bB;bB=[];for(bC=0,bA=by.length;bC<bA;bC++){bw=by[bC];bB.push(this.xyz[bw])}return bB}).call(this)))}return bz};bt.prototype.toOBJ=function(){var bE,bB,bx,bF,bA,bz,by,bu,bv,bD,bw,bG,bC,bJ,bI,bH;bD="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bD+="group "+this.name+"\n";bD+="#vertices\n";bw=this.xyz;for(bx=0,bF=bw.length;bx<bF;bx++){bI=bw[bx];bD+="v "+bI[0]+" "+bI[1]+" "+bI[2]+"\n"}bD+="#normal vector defs \n";bG=this.face;for(bv=0,bA=bG.length;bv<bA;bv++){bE=bG[bv];bu=ak((function(){var bK,bM,bL;bM=[];for(bL=0,bK=bE.length;bL<bK;bL++){bI=bE[bL];bM.push(this.xyz[bI])}return bM}).call(this));bD+="vn "+bu[0]+" "+bu[1]+" "+bu[2]+"\n"}bD+="#face defs \n";bC=this.face;for(bB=bJ=0,bz=bC.length;bJ<bz;bB=++bJ){bE=bC[bB];bD+="f ";for(bH=0,by=bE.length;bH<by;bH++){bI=bE[bH];bD+=(bI+1)+"//"+(bB+1)+" "}bD+="\n"}return bD};bt.prototype.toX3D=function(){var bw,bH,bK,bC,by,bD,bA,bz,bx,bu,bv,bE,bB,bI,bG,bF,bJ;bw=0.01;bJ='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bv=this.face;for(by=0,bD=bv.length;by<bD;by++){bC=bv[by];for(bu=0,bA=bC.length;bu<bA;bu++){bG=bC[bu];bJ+=bG+" "}bJ+="-1\n"}bJ+='">\n';bJ+='<Color color="';bE=c(this);for(bI=0,bz=bE.length;bI<bz;bI++){bH=bE[bI];bK=ag(bH);bJ+=bK[0]+" "+bK[1]+" "+bK[2]+" "}bJ+='"/>';bJ+='<Coordinate point="';bB=this.xyz;for(bF=0,bx=bB.length;bF<bx;bF++){bG=bB[bF];bJ+=(bG[0]*bw)+" "+(bG[1]*bw)+" "+(bG[2]*bw)+" "}bJ+='"/>\n';bJ+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bJ};bt.prototype.toVRML=function(){var bw,bH,bK,bC,by,bD,bA,bz,bx,bu,bv,bE,bB,bI,bG,bF,bJ;bw=0.01;bJ='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bv=this.xyz;for(by=0,bD=bv.length;by<bD;by++){bG=bv[by];bJ+=(bG[0]*bw)+" "+(bG[1]*bw)+" "+(bG[2]*bw)+","}bJ=bJ.slice(0,-1);bJ+="    ]\n}\ncolor Color\n{\n  color\n  [";bE=this.face_class;for(bu=0,bA=bE.length;bu<bA;bu++){bH=bE[bu];bK=ag(bH);bJ+=bK[0]+" "+bK[1]+" "+bK[2]+" ,"}bJ=bJ.slice(0,-1);bJ+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bB=this.face;for(bI=0,bz=bB.length;bI<bz;bI++){bC=bB[bI];for(bF=0,bx=bC.length;bF<bx;bF++){bG=bC[bF];bJ+=bG+", "}bJ+="-1,"}bJ=bJ.slice(0,-1);bJ+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bJ};return bt})();f=function(){var bt;bt=new aQ();bt.name="T";bt.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bt.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bt};ap=function(){var bt;bt=new aQ();bt.name="O";bt.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bt.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bt};aj=function(){var bt;bt=new aQ();bt.name="C";bt.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bt.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bt};a8=function(){var bt;bt=new aQ();bt.name="I";bt.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bt.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bt};aq=function(){var bt;bt=new aQ();bt.name="D";bt.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bt.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bt};T=function(bx){var bt,bE,bC,bA,bw,bu,by,bH,bG,bF,bD,bB,bz,bv,bJ,bI;bv=2*aK/bx;bE=Math.sin(bv/2);bu=new aQ();bu.name="P"+bx;for(bC=bA=0,by=bx-1;0<=by?bA<=by:bA>=by;bC=0<=by?++bA:--bA){bu.xyz.push([-I(bC*bv),-a0(bC*bv),-bE])}for(bC=bw=0,bH=bx-1;0<=bH?bw<=bH:bw>=bH;bC=0<=bH?++bw:--bw){bu.xyz.push([-I(bC*bv),-a0(bC*bv),bE])}bu.face.push((function(){bB=[];for(var bK=bG=bx-1;bG<=0?bK<=0:bK>=0;bG<=0?bK++:bK--){bB.push(bK)}return bB}).apply(this));bu.face.push((function(){bz=[];for(var bL=bx,bK=2*bx-1;bx<=bK?bL<=bK:bL>=bK;bx<=bK?bL++:bL--){bz.push(bL)}return bz}).apply(this));for(bC=bt=0,bD=bx-1;0<=bD?bt<=bD:bt>=bD;bC=0<=bD?++bt:--bt){bu.face.push([bC,(bC+1)%bx,(bC+1)%bx+bx,bC+bx])}bu=y(bu,1);return bu};aY=function(bG){var bL,bK,bJ,bI,bH,bE,bv,bD,bu,bC,bB,bz,by,bF,bt,bw,bA,bx;bw=2*aK/bG;bJ=V(1-4/(4+2*I(bw/2)-2*I(bw)));bD=V(1-bJ*bJ);bK=V(bJ*bJ+ba(bD*I(bw/2),2));bD=-bD/bK;bJ=-bJ/bK;bv=new aQ();bv.name="A"+bG;for(bI=bH=0,bu=bG-1;0<=bu?bH<=bu:bH>=bu;bI=0<=bu?++bH:--bH){bv.xyz.push([bD*I(bI*bw),bD*a0(bI*bw),bJ])}for(bI=bE=0,bC=bG-1;0<=bC?bE<=bC:bE>=bC;bI=0<=bC?++bE:--bE){bv.xyz.push([bD*I((bI+0.5)*bw),bD*a0((bI+0.5)*bw),-bJ])}bv.face.push((function(){bF=[];for(var bM=bB=bG-1;bB<=0?bM<=0:bM>=0;bB<=0?bM++:bM--){bF.push(bM)}return bF}).apply(this));bv.face.push((function(){bt=[];for(var bN=bG,bM=2*bG-1;bG<=bM?bN<=bM:bN>=bM;bG<=bM?bN++:bN--){bt.push(bN)}return bt}).apply(this));for(bI=bL=0,by=bG-1;0<=by?bL<=by:bL>=by;bI=0<=by?++bL:--bL){bv.face.push([bI,(bI+1)%bG,bI+bG]);bv.face.push([bI,bI+bG,(bG+bI-1)%bG+bG])}bv=y(bv,1);return bv};bp=function(bw){var bE,bA,by,bv,bt,bx,bC,bB,bz,bu,bD;bu=2*aK/bw;bE=1;bt=new aQ();bt.name="Y"+bw;for(bA=by=0,bx=bw-1;0<=bx?by<=bx:by>=bx;bA=0<=bx?++by:--by){bt.xyz.push([-I(bA*bu),-a0(bA*bu),-0.2])}bt.xyz.push([0,0,bE]);bt.face.push((function(){bz=[];for(var bF=bC=bw-1;bC<=0?bF<=0:bF>=0;bC<=0?bF++:bF--){bz.push(bF)}return bz}).apply(this));for(bA=bD=0,bB=bw-1;0<=bB?bD<=bB:bD>=bB;bA=0<=bB?++bD:--bD){bt.face.push([bA,(bA+1)%bw,bw])}bt=g(bt,3);return bt};ai=(function(){function bt(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bt.prototype.newV=function(bv,bu){if(this.verts[bv]===void 0){this.verts[bv]=0;return this.xyzs[bv]=bu}};bt.prototype.newFlag=function(bu,bw,bv){if(this.flags[bu]===void 0){this.flags[bu]={}}return this.flags[bu][bw]=bv};bt.prototype.topoly=function(){var bv,bz,bD,by,bx,bu,bw,bA,bC,bB;bu=new aQ();bv=0;bw=this.verts;for(by in bw){bC=bw[by];bu.xyz[bv]=this.xyzs[by];this.verts[by]=bv;bv++}bv=0;bA=this.flags;for(by in bA){bz=bA[by];bu.face[bv]=[];for(bx in bz){bC=bz[bx];bB=bC;break}bC=bB;bu.face[bv].push(this.verts[bC]);bC=this.flags[by][bC];bD=0;while(bC!==bB){bu.face[bv].push(this.verts[bC]);bC=this.flags[by][bC];bD++;if(bD>1000){console.log("Bad flag spec, have a neverending face:",by,this.flags[by]);break}}bv++}bu.name="unknown polyhedron";return bu};return bt})();ad=function(bz,bJ,bx){var bw,bP,bO,bL,bQ,bv,bM,bK,bN,bB,bA,bC,bG,bI,bH,by,bF,bE,bD,bu,bt;bJ||(bJ=0);bx||(bx=0.1);console.log("Taking kis of "+(bJ===0?"":bJ)+"-sided faces of "+bz.name+"...");bL=new ai();by=bz.xyz;for(bM=bK=0,bN=by.length;bK<bN;bM=++bK){bH=by[bM];bL.newV("v"+bM,bH)}bG=bz.normals();bP=bz.centers();bv=false;bF=bz.face;for(bM=bI=0,bB=bF.length;bI<bB;bM=++bI){bO=bF[bM];bu="v"+bO[bO.length-1];for(bE=0,bA=bO.length;bE<bA;bE++){bD=bO[bE];bt="v"+bD;if(bO.length===bJ||bJ===0){bv=true;bw="apex"+bM;bQ=""+bM+bu;bL.newV(bw,z(bP[bM],d(bx,bG[bM])));bL.newFlag(bQ,bu,bt);bL.newFlag(bQ,bt,bw);bL.newFlag(bQ,bw,bu)}else{bL.newFlag(""+bM,bu,bt)}bu=bt}}if(!bv){console.log("No "+bJ+"-fold components were found.")}bC=bL.topoly();bC.name="k"+(bJ===0?"":bJ)+bz.name;return bC};aI=function(bt){var bC,bF,bA,by,bD,bz,bu,bx,bv,bw,bE,bB,bI,bH,bG;console.log("Taking ambo of "+bt.name+"...");bu=function(bK,bJ){if(bK<bJ){return bK+"_"+bJ}else{return bJ+"_"+bK}};bF=new ai();bw=bt.face;for(bA=by=0,bD=bw.length;by<bD;bA=++by){bC=bw[bA];bE=bC.slice(-2),bI=bE[0],bH=bE[1];for(bv=0,bz=bC.length;bv<bz;bv++){bG=bC[bv];if(bI<bH){bF.newV(bu(bI,bH),aW(bt.xyz[bI],bt.xyz[bH]))}bF.newFlag("orig"+bA,bu(bI,bH),bu(bH,bG));bF.newFlag("dual"+bH,bu(bH,bG),bu(bI,bH));bB=[bH,bG],bI=bB[0],bH=bB[1]}}bx=bF.topoly();bx.name="a"+bt.name;return bx};a4=function(bx){var bQ,bP,bM,bR,bN,bL,bK,bO,bA,bz,by,bD,bJ,bw,bI,bH,bF,bC,bG,bE,bv,bu,bt,bB;console.log("Taking gyro of "+bx.name+"...");bM=new ai();bw=bx.xyz;for(bN=bK=0,bO=bw.length;bK<bO;bN=++bK){bE=bw[bN];bM.newV("v"+bN,bl(bE))}bQ=bx.centers();bI=bx.face;for(bN=bJ=0,bA=bI.length;bJ<bA;bN=++bJ){bP=bI[bN];bM.newV("center"+bN,bl(bQ[bN]))}bH=bx.face;for(bN=bG=0,bz=bH.length;bG<bz;bN=++bG){bP=bH[bN];bF=bP.slice(-2),bv=bF[0],bu=bF[1];for(bL=bB=0,by=bP.length;bB<by;bL=++bB){bE=bP[bL];bt=bE;bM.newV(bv+"~"+bu,au(bx.xyz[bv],bx.xyz[bu]));bR=bN+"f"+bv;bM.newFlag(bR,"center"+bN,bv+"~"+bu);bM.newFlag(bR,bv+"~"+bu,bu+"~"+bv);bM.newFlag(bR,bu+"~"+bv,"v"+bu);bM.newFlag(bR,"v"+bu,bu+"~"+bt);bM.newFlag(bR,bu+"~"+bt,"center"+bN);bC=[bu,bt],bv=bC[0],bu=bC[1]}}bD=bM.topoly();bD.name="g"+bx.name;return bD};s=function(bx){var bL,bI,bM,bJ,bH,bK,bz,by,bA,bG,bw,bF,bE,bC,bD,bB,bv,bu,bt;console.log("Taking propellor of "+bx.name+"...");bI=new ai();bw=bx.xyz;for(bJ=bH=0,bK=bw.length;bH<bK;bJ=++bH){bB=bw[bJ];bI.newV("v"+bJ,bl(bB))}bF=bx.face;for(bJ=bG=0,bz=bF.length;bG<bz;bJ=++bG){bL=bF[bJ];bE=bL.slice(-2),bv=bE[0],bu=bE[1];for(bD=0,by=bL.length;bD<by;bD++){bB=bL[bD];bt=""+bB;bI.newV(bv+"~"+bu,au(bx.xyz[bv],bx.xyz[bu]));bM=bJ+"f"+bu;bI.newFlag("v"+bJ,bv+"~"+bu,bu+"~"+bt);bI.newFlag(bM,bv+"~"+bu,bu+"~"+bv);bI.newFlag(bM,bu+"~"+bv,"v"+bu);bI.newFlag(bM,"v"+bu,bu+"~"+bt);bI.newFlag(bM,bu+"~"+bt,bv+"~"+bu);bC=[bu,bt],bv=bC[0],bu=bC[1]}}bA=bI.topoly();bA.name="p"+bx.name;return bA};t=function(bx){var bv,bt,by,bw,bu;console.log("Taking reflection of "+bx.name+"...");for(bv=bt=0,bw=bx.xyz.length-1;0<=bw?bt<=bw:bt>=bw;bv=0<=bw?++bt:--bt){bx.xyz[bv]=d(-1,bx.xyz[bv])}for(bv=by=0,bu=bx.face.length-1;0<=bu?by<=bu:by>=bu;bv=0<=bu?++by:--by){bx.face[bv]=bx.face[bv].reverse()}bx.name="r"+bx.name;return bx};aJ=function(bw){var bT,bS,bR,bQ,bU,bP,bB,bM,bN,bL,bK,bO,bA,bz,by,bx,bJ,bv,bH,bG,bE,bD,bI,bF,bu,bt,bC;console.log("Taking dual of "+bw.name+"...");bM=new ai();bB=[];for(bN=bK=0,bv=bw.xyz.length-1;0<=bv?bK<=bv:bK>=bv;bN=0<=bv?++bK:--bK){bB[bN]={}}bH=bw.face;for(bN=bJ=0,bO=bH.length;bJ<bO;bN=++bJ){bP=bH[bN];bu=bP[bP.length-1];for(bF=0,bA=bP.length;bF<bA;bF++){bt=bP[bF];bB[bu]["v"+bt]=""+bN;bu=bt}}bQ=bw.centers();for(bN=bC=0,bG=bw.face.length-1;0<=bG?bC<=bG:bC>=bG;bN=0<=bG?++bC:--bC){bM.newV(""+bN,bQ[bN])}bE=bw.face;for(bN=bT=0,bz=bE.length;bT<bz;bN=++bT){bP=bE[bN];bu=bP[bP.length-1];for(bS=0,by=bP.length;bS<by;bS++){bt=bP[bS];bM.newFlag(bu,bB[bt]["v"+bu],""+bN);bu=bt}}bU=bM.topoly();bI=[];bD=bU.face;for(bR=0,bx=bD.length;bR<bx;bR++){bP=bD[bR];bL=F(bw.face[bP[0]],bw.face[bP[1]],bw.face[bP[2]]);bI[bL]=bP}bU.face=bI;if(bw.name[0]!=="d"){bU.name="d"+bw.name}else{bU.name=bw.name.slice(1)}return bU};E=function(bx,bM,by,bN){var bV,bT,bS,bP,bU,bv,bQ,bO,bR,bC,bB,bA,bz,bE,bJ,bL,bK,bw,bI,bH,bG,bF,bu,bt,bD;bM||(bM=0);by||(by=0.5);bN||(bN=-0.2);console.log("Taking inset of "+(bM===0?"":bM)+"-sided faces of "+bx.name+"...");bP=new ai();bw=bx.xyz;for(bQ=bO=0,bR=bw.length;bO<bR;bQ=++bO){bK=bw[bQ];bP.newV("v"+bQ,bK)}bJ=bx.normals();bT=bx.centers();bI=bx.face;for(bQ=bL=0,bC=bI.length;bL<bC;bQ=++bL){bS=bI[bQ];if(bS.length===bM||bM===0){for(bG=0,bB=bS.length;bG<bB;bG++){bF=bS[bG];bP.newV("f"+bQ+"v"+bF,z(l(bx.xyz[bF],bT[bQ],by),d(bN,bJ[bQ])))}}}bv=false;bH=bx.face;for(bQ=bD=0,bA=bH.length;bD<bA;bQ=++bD){bS=bH[bQ];bu="v"+bS[bS.length-1];for(bV=0,bz=bS.length;bV<bz;bV++){bF=bS[bV];bt="v"+bF;if(bS.length===bM||bM===0){bv=true;bU=bQ+bu;bP.newFlag(bU,bu,bt);bP.newFlag(bU,bt,"f"+bQ+bt);bP.newFlag(bU,"f"+bQ+bt,"f"+bQ+bu);bP.newFlag(bU,"f"+bQ+bu,bu);bP.newFlag("ex"+bQ,"f"+bQ+bu,"f"+bQ+bt)}else{bP.newFlag(bQ,bu,bt)}bu=bt}}if(!bv){console.log("No "+bM+"-fold components were found.")}bE=bP.topoly();bE.name="n"+(bM===0?"":bM)+bx.name;return bE};ac=function(bx,bL){var bS,bR,bQ,bN,bv,bO,bM,bP,bB,bA,bz,by,bD,bI,bK,bJ,bw,bH,bG,bF,bE,bu,bt,bC;bL||(bL=0);console.log("Taking extrusion of "+(bL===0?"":bL)+"-sided faces of "+bx.name+"...");bN=new ai();bw=bx.xyz;for(bO=bM=0,bP=bw.length;bM<bP;bO=++bM){bJ=bw[bO];bN.newV("v"+bO,bJ)}bI=bx.normals();bR=bx.centers();bH=bx.face;for(bO=bK=0,bB=bH.length;bK<bB;bO=++bK){bQ=bH[bO];if(bQ.length===bL||bL===0){for(bF=0,bA=bQ.length;bF<bA;bF++){bE=bQ[bF];bN.newV("f"+bO+"v"+bE,z(bx.xyz[bE],d(0.3,bI[bO])))}}}bv=false;bG=bx.face;for(bO=bC=0,bz=bG.length;bC<bz;bO=++bC){bQ=bG[bO];bu="v"+bQ[bQ.length-1];for(bS=0,by=bQ.length;bS<by;bS++){bE=bQ[bS];bt="v"+bE;if(bQ.length===bL||bL===0){bv=true;bN.newFlag(bO+bu,bu,bt);bN.newFlag(bO+bu,bt,"f"+bO+bt);bN.newFlag(bO+bu,"f"+bO+bt,"f"+bO+bu);bN.newFlag(bO+bu,"f"+bO+bu,bu);bN.newFlag("ex"+bO,"f"+bO+bu,"f"+bO+bt)}else{bN.newFlag(bO,bu,bt)}bu=bt}}if(!bv){console.log("No "+bL+"-fold components were found.")}bD=bN.topoly();bD.name="x"+(bL===0?"":bL)+bx.name;return bD};aZ=function(bz){var bS,bR,bO,bP,bN,bQ,bE,bC,bF,bM,bL,by,bK,bJ,bH,bI,bG,bv,bT,bu,bx,bw,bt,bD,bB,bA;console.log("Taking stella of "+bz.name+"...");bS=bz.centers();bO=new ai();by=bz.xyz;for(bP=bN=0,bQ=by.length;bN<bQ;bP=++bN){bL=by[bP];bO.newV("v"+bP,bL)}bK=bz.face;for(bP=bM=0,bE=bK.length;bM<bE;bP=++bM){bR=bK[bP];bv="v"+bR[bR.length-2];bu="v"+bR[bR.length-1];bD=bz.xyz[bR[bR.length-2]];bB=bz.xyz[bR[bR.length-1]];for(bI=0,bC=bR.length;bI<bC;bI++){bG=bR[bI];bt="v"+bG;bA=bz.xyz[bG];bT=bv+"~"+bu;bx=bu+"~"+bv;bw=bu+"~"+bt;bO.newV(bT,aW(aW(bD,bB),bS[bP]));bO.newFlag("in"+bP,bT,bw);bO.newFlag("f"+bP+bu,bw,bT);bO.newFlag("f"+bP+bu,bT,bu);bO.newFlag("f"+bP+bu,bu,bw);bO.newFlag("f"+bT,bv,bx);bO.newFlag("f"+bT,bx,bT);bO.newFlag("f"+bT,bT,bv);bJ=[bu,bt],bv=bJ[0],bu=bJ[1];bH=[bB,bA],bD=bH[0],bB=bH[1]}}bF=bO.topoly();bF.name="l"+bz.name;return bF};aa=function(bw,bv){var bA,bz,by,bu,bx,bt,bB;bA=0.1;bt=a6(bw);for(bu=0,bx=bv.length;bu<bx;bu++){by=bv[bu];bB=k(bt[by[0]],bt[by[1]]);bz=d(bA*1/2*(1-V(D(bB,bB))),bB);bt[by[0]]=z(bt[by[0]],bz);bt[by[1]]=z(bt[by[1]],bz)}return bt};bb=function(bx,bw){var bA,bz,bt,bu,by,bv,bB;bt=(function(){var bD,bC,bF,bE;bE=[];for(bD=0,bC=bw.length;bD<bC;bD++){bF=bw[bD],bA=bF[0],bz=bF[1];bE.push(k(bx[bA],bx[bz]))}return bE})();bv=[0,0,0];for(bu=0,by=bt.length;bu<by;bu++){bB=bt[bu];bv=z(bv,bB)}bv=d(1/bw.length,bv);return _.map(bx,function(bC){return bf(bC,bv)})};B=function(bw){var bt,bv,bu;bv=[0,0,0];bt=_.max(_.map(bw,function(bx){return K(bx)}));bu=1/bt;return _.map(bw,function(bx){return[bu*bx[0],bu*bx[1],bu*bx[2]]})};be=function(bz,bw){var bE,bC,bD,bA,bx,bB,by,bv,bt,bu,bF;bE=0.1;bt=a6(bz);for(bx=0,bB=bw.length;bx<bB;bx++){bA=bw[bx];bD=(function(){var bG,bI,bH;bH=[];for(bI=0,bG=bA.length;bI<bG;bI++){bF=bA[bI];bH.push(bz[bF])}return bH})();bv=ak(bD);bC=bk(bD);if(D(bv,bC)<0){bv=d(-1,bv)}for(bu=0,by=bA.length;bu<by;bu++){bF=bA[bu];bt[bF]=z(bt[bF],d(D(d(bE,bv),bf(bC,bz[bF])),bv))}}return bt};n=function(bu,bC){var bz,bw,bA,by,bB,bt,bx,bD,bv;bC||(bC=1);console.log("Canonicalizing "+bu.name+"...");bw=bu.face;bz=bu.edges();bt=bu.xyz;bB=1;for(bA=by=0,bv=bC;0<=bv?by<=bv:by>=bv;bA=0<=bv?++by:--by){bD=a6(bt);bt=aa(bt,bz);bt=bb(bt,bz);bt=be(bt,bw);bB=_.max(_.map(_.zip(bt,bD),function(bF){var bE,bG;bE=bF[0],bG=bF[1];return K(bf(bE,bG))}));if(bB<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bB+"]");bx=new aQ(bt,bu.face,bu.name);console.log("canonicalize",bx);return bx};O=function(bw){var bx,bv,bu,bt;bv=bw.centers();for(bu=0,bt=bv.length;bu<bt;bu++){bx=bv[bu];bx=d(1/D(bx,bx),bx)}return bv};H=function(bu){var bJ,bB,bw,bD,by,bE,bz,bt,bv,bx,bF,bC,bA,bI,bH,bG;bJ=[];bx=bu.face;for(by=0,bE=bx.length;by<bE;by++){bD=bx[by];bw=[0,0,0];bt=[0,0,0];bB=0;bF=bD.slice(-2),bI=bF[0],bH=bF[1];for(bv=0,bz=bD.length;bv<bz;bv++){bG=bD[bv];bw=z(bw,bu.xyz[bG]);bt=z(bt,aX(bu.xyz[bI],bu.xyz[bH],bu.xyz[bG]));bB+=av(bu.xyz[bI],bu.xyz[bH]);bC=[bH,bG],bI=bC[0],bH=bC[1]}bw=d(1/bD.length,bw);bt=bl(bt);bB=bB/bD.length;bA=aD(d(D(bw,bt),bt));bJ.push(d((1+bB)/2,bA))}return bJ};g=function(by,bv){var bx,bu,bt,bw;bv||(bv=1);bu=aJ(by);console.log("Pseudo-canonicalizing "+by.name+"...");for(bx=bt=0,bw=bv-1;0<=bw?bt<=bw:bt>=bw;bx=0<=bw?++bt:--bt){bu.xyz=H(by);by.xyz=H(bu)}return new aQ(by.xyz,by.face,by.name)};y=function(by,bv){var bx,bu,bt,bw;bv||(bv=1);bu=aJ(by);console.log("Planarizing "+by.name+"...");for(bx=bt=0,bw=bv-1;0<=bw?bt<=bw:bt>=bw;bx=0<=bw?++bt:--bt){bu.xyz=O(by);by.xyz=O(bu)}return new aQ(by.xyz,by.face,by.name)};J=function(bV){var bU,bQ,bJ,bO,bT,bC,bW,bM,bH,bE,bS,bx,bP,bI,bz,bA,bN,bD,bL,bR,bB,bK,by,bw,bv,bu,bt,bG,bF;bD=999;bP=[];bI=[];bz=bV.length;bS=function(bX,bY){return(bX||bY)&&!(bX&&bY)};bU=function(bZ,bY,bX){return(bY[0]-bZ[0])*(bX[1]-bZ[1])-(bX[0]-bZ[0])*(bY[1]-bZ[1])};bH=function(bZ,bY,bX){return bU(bZ,bY,bX)>0};bE=function(bZ,bY,bX){return bU(bZ,bY,bX)>=0};bJ=function(bZ,bY,bX){return bU(bZ,bY,bX)===0};bQ=function(bZ,bY,bX){if(bJ(bZ,bY,bX)){return false}if(bZ[0]!==bY[0]){return(bZ[0]<=bX[0])&&(bX[0]<=bY[0])||(bZ[0]>=bX[0])&&(bX[0]>=bY[0])}else{return(bZ[1]<=bX[1])&&(bX[1]<=bY[1])||(bZ[1]>=bX[1])&&(bX[1]>=bY[1])}};bM=function(b0,bZ,bY,bX){if(bJ(b0,bZ,bY)||bJ(b0,bZ,bX)||bJ(bY,bX,b0)||bJ(bY,bX,bZ)){return false}return bS(bH(b0,bZ,bY),bH(b0,bZ,bX))&&bS(bH(bY,bX,b0),bH(bY,bX,bZ))};bW=function(b0,bZ,bY,bX){if(bM(b0,bZ,bY,bX)){return true}else{if(bQ(b0,bZ,bY)||bQ(b0,bZ,bX)||bQ(bY,bX,b0)||bQ(bY,bX,bZ)){return true}else{return false}}};bC=function(bZ,bX){var b0,bY;bY=(bZ+1+bz)%bz;b0=(bZ-1+bz)%bz;if(bE(bV[bZ],bV[bY],bV[b0])){return bH(bV[bZ],bV[bX],bV[b0])&&bH(bV[bX],bV[bZ],bV[bY])}return !(bE(bV[bZ],bV[bX],bV[bY])&&bE(bV[bX],bV[bZ],bV[b0]))};bT=function(bY,bX){var b0,bZ;b0=0;while(true){bZ=(b0+1+bz)%bz;if((b0!==bY)&&(bZ!==bY)&&(b0!==bX)&&(bZ!==bX)&&bM(bV[bY],bV[bX],bV[b0],bV[bZ])){return false}b0=(b0+1+bz)%bz;if(b0===0){break}}return true};bO=function(bY,bX){return bC(bY,bX)&&bC(bX,bY)&&bT(bY,bX)};bw=0;while(true){bv=(bw+1+bz)%bz;by=(bw-1+bz)%bz;bI[bw]=bO(by,bv);bw=(bw+1+bz)%bz;if(bw===0){break}}bR=(function(){bK=[];for(var bX=0,bY=bz-1;0<=bY?bX<=bY:bX>=bY;0<=bY?bX++:bX--){bK.push(bX)}return bK}).apply(this);bL=bz;bF=bD;bA=0;while(bF>0&&bL>3){bF-=1;bv=bA;bG=bD;while(true){bG-=1;bx=false;if(bI[bv]){bu=(bv+1+bz)%bz;bt=(bu+1+bz)%bz;bw=(bv-1+bz)%bz;by=(bw-1+bz)%bz;bP.push([bR[bw],bR[bu]]);bI[bw]=bO(by,bu);bI[bu]=bO(bw,bt);bV=bV.slice(0,+bv+1||9000000000).concat(bV.slice(bu));bR=bR.slice(0,+bv+1||9000000000).concat(bR.slice(bu));if(by>bv){by-=1}if(bw>bv){bw-=1}if(bu>bv){bu-=1}if(bt>bv){bt-=1}bz--;bA=bu;bL--;bx=true}bv=(bv+1+bz)%bz;if(!(bG>0&&!bx&&bv!==bA)){break}}}return bP};a=function(bu,bt){if(((bu[0]===bt[0])&&(bu[1]===bt[1])&&(bu[2]===bt[2]))||(bu[0]===bt[1])&&(bu[1]===bt[2])&&(bu[2]===bt[0])||(bu[0]===bt[2])&&(bu[1]===bt[0])&&(bu[2]===bt[1])){return true}else{return false}};u=function(b0,bS){var bN,bL,bJ,bH,bF,bP,b1,bR,bQ,bM,bT,bZ,bY,bO,bB,bA,bz,by,bx,bw,bv,bu,bX,bt,bW,bK,bI,bG,bE,bD,bC,b2,bV,b5,b4,b3,bU;bM=[];bt=[];bW=(function(){var b8,b7,b6;b6=[];for(bZ=b8=0,b7=b0.length-1;0<=b7?b8<=b7:b8>=b7;bZ=0<=b7?++b8:--b8){b6.push([bZ,(bZ+1)%b0.length])}return b6})();for(bY=0,bO=bW.length;bY<bO;bY++){bK=bW[bY],b4=bK[0],b3=bK[1];bM[b4]=[b3];bt[b3]=[b4]}for(bX=0,bB=bS.length;bX<bB;bX++){b1=bS[bX];bM[b1[0]].push(b1[1]);bM[b1[1]].push(b1[0]);bt[b1[0]].push(b1[1]);bt[b1[1]].push(b1[0])}b2=[];for(bV=0,bA=bS.length;bV<bA;bV++){b1=bS[bV];bI=bM[b1[1]];for(bU=0,bz=bI.length;bU<bz;bU++){bR=bI[bU];bG=bt[b1[0]];for(bN=0,by=bG.length;bN<by;bN++){bQ=bG[bN];if(bR===bQ){b2.push([b1[0],b1[1],bR])}}}bE=bM[b1[0]];for(bL=0,bx=bE.length;bL<bx;bL++){bR=bE[bL];bD=bt[b1[1]];for(bJ=0,bw=bD.length;bJ<bw;bJ++){bQ=bD[bJ];if(bR===bQ){b2.push([b1[1],b1[0],bR])}}}}b5=[b2.pop()];for(bH=0,bv=b2.length;bH<bv;bH++){bC=b2[bH];bP=false;for(bF=0,bu=b5.length;bF<bu;bF++){bT=b5[bF];if(a(bC,bT)){bP=true;break}}if(!bP){b5.push(bC)}}return b5};ab=function(bu,bt){var bx,bw,bF,bD,bC,bA,bE,bB,bz,bv,by,bI,bH,bG;bt=bt||false;console.log("Triangulating faces of "+bu.name+"...");bz=new aQ();bz.xyz=L(bu.xyz);bz.face_class=[];by=bu.face;for(bD=bA=0,bE=by.length;bA<bE;bD=++bA){bF=by[bD];if(bF.length>3){bx=Z((function(){var bJ,bL,bK;bK=[];for(bL=0,bJ=bF.length;bL<bJ;bL++){bG=bF[bL];bK.push(bu.xyz[bG])}return bK})());bw=J(bx);bH=u(bF,bw);for(bC=bv=0,bB=bH.length;bv<bB;bC=++bv){bI=bH[bC];bz.face.push([bF[bI[0]],bF[bI[1]],bF[bI[2]]]);if(bt){bz.face_class.push(bu.face_class[bD])}}}else{bz.face.push([bF[0],bF[1],bF[2]]);if(bt){bz.face_class.push(bu.face_class[bD])}}}bz.name=bu.name;return bz};ah=function(bt){var by,bw,bz,bx,bu,bv,bA,bB;bA="";bv=bt.face;for(bw=0,bz=bv.length;bw<bz;bw++){by=bv[bw];for(bu=0,bx=by.length;bu<bx;bu++){bB=by[bu];bA+=bB+"->"}bA+="\n"}return console.log(bA)};C=function(){var bw,bt,bx,bz,bA,by,bv,bu;bu=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];by=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bw=0,bt=by.length;bw<bt;bw++){bA=by[bw];console.log("Operator "+bA);for(bz=0,bx=bu.length;bz<bx;bz++){bv=bu[bz];console.log(bA+bv+":",generatePoly(bA+bv))}}return console.log("===== Done Testing Basic Ops =====")};aT='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';bg=PEG.buildParser(aT);bs=function(bu,bt){return bu.apply(this,bt||[])};bi={T:f,O:ap,C:aj,I:a8,D:aq,P:T,A:aY,Y:bp};G={d:aJ,k:ad,a:aI,g:a4,p:s,r:t,n:E,x:ac,l:aZ,z:ab,K:g,C:n,A:y};aP=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a2=function(by){var bu,bw,bv,bt,bz,bx;bw=by;for(bv=0,bt=aP.length;bv<bt;bv++){bx=aP[bv],bz=bx[0],bu=bx[1];bw=bw.replace(bz,bu)}console.log(by+" executed as "+bw);return bw};bq=function(bA){var bu,bB,bv,by,bw,bD,bx,bC,bz,bt;bz=a2(bA);bC=bg.parse(bz).reverse();bw=bC.shift();bB=bi[bw.op];bu=bw.args;bt=bs(bB,bu);for(bv=0,by=bC.length;bv<by;bv++){bw=bC[bv];bx=G[bw.op];bD=[bt].concat(bw.args);bt=bs(bx,bD)}bt.xyz=bb(bt.xyz,bt.edges());bt.xyz=B(bt.xyz);bt=Q(bt);return bt};ae={};bm=500;aA=400;P={};j=L(v);al=L(v);U=800;A=5;bn=0;M=0.8;o=bm/2;ax=aA/2;w=new Date();q=true;aU="rgba(255,255,255,1.0)";an="signature";h="fillstroke";bd=0.5;ao=false;X=0;W=0;aH=[1,0,0];a5=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aF=function(bv,bt){var bw,bu;bw=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bu=new bw();bu.append(bv);return saveAs(bu.getBlob("text/plain;charset="+document.characterSet),bt)};bo=function(){var bt,by,bx,bw,bv,bu;bu={};bt=/\+/g;bv=/([^&=]+)=?([^&]*)/g;by=function(bz){return decodeURIComponent(bz.replace(bt," "))};bw=window.location.search.substring(1);while(bx=bv.exec(bw)){bu[by(bx[1])]=by(bx[2])}return bu};ar=function(){var bt,bu;bu=$("#spec").val().split(/\s+/g).slice(0,2);bt=location.protocol+"//"+location.host+location.pathname;bt+="?recipe="+encodeURIComponent(bu[0]);if(a1!==aR){bt+="&palette="+encodeURIComponent(a1.reduce(function(bv,bw){return bv+" "+bw}))}return $("#link").attr("href",bt)};aL=function(){var bt;bt=$("#poly");bt.width(bm);bt.height(aA);ae=bt[0].getContext("2d");ae.lineWidth=bd;if(q){return ae.clearRect(0,0,bm,aA)}else{ae.clearRect(0,0,bm,aA);ae.fillStyle=aU;return ae.fillRect(0,0,bm,aA)}};aN=function(){if(q){return ae.clearRect(0,0,bm,aA)}else{ae.clearRect(0,0,bm,aA);ae.fillStyle=aU;return ae.fillRect(0,0,bm,aA)}};R=function(by,bL){var bt,bB,bz,bG,bu,bJ,bK,bA,bI,bv,bx,bH,bF,bE,bw,bD,bC;bL||(bL=[3,3,3]);bv=_.map(by.xyz,function(bM){return bM});by.xyz=_.map(by.xyz,function(bM){return r(j,bM)});aS(by);bx=by.face;for(bG=bJ=0,bK=bx.length;bJ<bK;bG=++bJ){bB=bx[bG];ae.beginPath();bw=bB[bB.length-1];bH=x(z(bL,by.xyz[bw]),A,bn,M,U),bD=bH[0],bC=bH[1];ae.moveTo(bD+o,bC+ax);for(bI=0,bA=bB.length;bI<bA;bI++){bE=bB[bI];bF=x(z(bL,by.xyz[bE]),A,bn,M,U),bD=bF[0],bC=bF[1];ae.lineTo(bD+o,bC+ax)}bt=ag(by.face_class[bG]);bz=(function(){var bM,bO,bN;bO=[];for(bN=0,bM=bB.length;bN<bM;bN++){bE=bB[bN];bO.push(by.xyz[bE])}return bO})();bu=D(ak(bz),bl([1,-1,0]));bt=d((bu/2+0.5)*0.7+0.3,bt);if(h==="fill"||h==="fillstroke"){ae.fillStyle="rgba("+(Y(bt[0]*255))+", "+(Y(bt[1]*255))+", "+(Y(bt[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba("+(Y(bt[0]*255))+", "+(Y(bt[1]*255))+", "+(Y(bt[2]*255))+", "+1+")";ae.stroke()}if(h==="fillstroke"){ae.fillStyle="rgba("+(Y(bt[0]*255))+", "+(Y(bt[1]*255))+", "+(Y(bt[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba(0,0,0, .3)";ae.stroke()}if(h==="stroke"){ae.strokeStyle="rgba(0,0,0, .8)";ae.stroke()}}return by.xyz=bv};aC=function(){var bw,bu,bt,bx,bv;aN();bv=[];for(bw=bu=0,bt=P.length;bu<bt;bw=++bu){bx=P[bw];bv.push(R(bx,[0+3*bw,0,3]))}return bv};aw=function(){var bw,bu,bt,bx,bv;bv=[];for(bw=bu=0,bt=P.length;bu<bt;bw=++bu){bx=P[bw];bv.push($("#stats").text(bx.data()))}return bv};bh=function(){var bv,bw,bu,bt,bx;aN();bv=(2*Math.PI)/180*w.getSeconds()*0.1;for(bw=bu=0,bt=P.length;bu<bt;bw=++bu){bx=P[bw];R(bx,[0+3*bw,0,3])}return setTimeout(bh,100)};$(function(){var bu,bt;aL();bt=bo();if("recipe" in bt){bu=[bt.recipe];$("#spec").val(bu)}else{bu=[bc(a5)];$("#spec").val(bu);ar()}if("palette" in bt){a1=bt.palette.split(/\s+/g);ar()}$("#palette").val(a1.reduce(function(bv,bw){return bv+" "+bw}));P=_.map(bu,function(bv){return bq(bv)});aw();aC();$("#spec").change(function(bv){bu=$("#spec").val().split(/\s+/g).slice(0,2);P=_.map(bu,function(bw){return bq(bw)});aw();ar();return aC()});$("#palette").change(function(bv){a1=$(this).val().split(/\s+/g);ar();return aC()});$("#poly").mousewheel(function(bx,by,bw,bv){bx.preventDefault();U*=(10+by)/10;return aC()});$("#poly").mousedown(function(bv){var bw;bv.preventDefault();ao=true;X=bv.clientX-$(this).offset().left;W=bv.clientY-($(this).offset().top-$(window).scrollTop());bw=aM(X,W,o,ax,A,bn,M,U);if(bw[0]*bw[1]*bw[2]*0===0){aH=bw}return al=L(j)});$("#poly").mouseup(function(bv){bv.preventDefault();return ao=false});$("#poly").mouseleave(function(bv){bv.preventDefault();return ao=false});$("#poly").mousemove(function(by){var bw,bv,bx;by.preventDefault();if(ao){bw=by.clientX-$(this).offset().left;bv=by.clientY-($(this).offset().top-$(window).scrollTop());bx=aM(bw,bv,o,ax,A,bn,M,U);if(bx[0]*bx[1]*bx[2]*0===0&&aH[0]*aH[1]*aH[2]*0===0){j=aG(aE(aH,bx),al)}return aC()}});$("#strokeonly").click(function(bv){h="stroke";return aC()});$("#fillonly").click(function(bv){h="fill";return aC()});$("#fillandstroke").click(function(bv){h="fillstroke";return aC()});$("#siderot").click(function(bv){j=aV(aK/2,0,1,0);return aC()});$("#toprot").click(function(bv){j=aV(aK/2,1,0,0);return aC()});$("#frontrot").click(function(bv){j=i(0,0,0);return aC()});$("#pngsavebutton").click(function(by){var bx,bw,bv;bx=$("#poly")[0];bv=$("#spec").val().split(/\s+/g)[0];bw="polyhedronisme-"+bv.replace(/\([^\)]+\)/g,"")+".png";return bx.toBlob(function(bz){return saveAs(bz,bw)})});$("#objsavebutton").click(function(by){var bw,bx,bv;bx=P[0].toOBJ();bv=$("#spec").val().split(/\s+/g)[0];bw="polyhedronisme-"+bv.replace(/\([^\)]+\)/g,"")+".obj";return aF(bx,bw)});return $("#x3dsavebutton").click(function(by){var bw,bv,bx,bz;bx=ab(P[0],true);bz=bx.toVRML();bv=$("#spec").val().split(/\s+/g)[0];bw="polyhedronisme-"+bv.replace(/\([^\)]+\)/g,"")+".wrl";return aF(bz,bw)})})}).call(this);