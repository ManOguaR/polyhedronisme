(function(){var q,aV,aB,bp,an,a6,S,X,W,aI,ao,a2,aU,aL,h,o,ay,p,af,a4,z,y,aJ,bi,aZ,N,aA,bj,bn,g,n,bl,aO,L,bk,a7,I,az,ae,be,aj,u,bv,aq,D,aD,R,aK,aw,ac,v,aC,ba,am,J,a3,aF,P,j,al,w,a5,bu,a9,aM,E,F,aN,ad,av,e,m,K,a8,aX,aH,d,r,bt,ak,ap,au,bh,G,aY,Q,ag,br,x,M,A,bq,U,bf,ai,aR,bb,T,Z,s,bs,aP,bd,bc,aE,O,H,t,B,i,Y,aS,aG,ar,at,a1,aT,aQ,V,a0,bg,b,k,aa,C,f,ah,a,ab,l,bo,ax,aW,c,bm;aP=Math.random;Y=Math.round;am=Math.floor;V=Math.sqrt;a1=Math.sin;I=Math.cos;b=Math.tan;N=Math.asin;a4=Math.acos;aA=Math.atan;bb=Math.pow;af=Math.abs;aL=Math.PI;S=Math.LN10;e=Math.log;bb=Math.pow;m=function(bw){return e(bw)/S};at=function(by,bx){var bw;bw=bb(10,m(by)-am(m(by)));return""+(Y(bw*(bx-1)))};L=function(by){var bx,bw;if((by==null)||typeof by!=="object"){return by}bw=new by.constructor();for(bx in by){bw[bx]=L(by[bx])}return bw};bd=function(bx){var bw;bw=am(aP()*bx.length);return bx[bw]};d=function(bx,bw){return[bx*bw[0],bx*bw[1],bx*bw[2]]};p=function(bx,bw){return[bx[0]*bw[0],bx[1]*bw[1],bx[2]*bw[2]]};z=function(bx,bw){return[bx[0]+bw[0],bx[1]+bw[1],bx[2]+bw[2]]};bg=function(bx,bw){return[bx[0]-bw[0],bx[1]-bw[1],bx[2]-bw[2]]};D=function(bx,bw){return bx[0]*bw[0]+bx[1]*bw[1]+bx[2]*bw[2]};az=function(bx,bw){return[bx[1]*bw[2]-bx[2]*bw[1],bx[2]*bw[0]-bx[0]*bw[2],bx[0]*bw[1]-bx[1]*bw[0]]};K=function(bw){return V(D(bw,bw))};a8=function(bw){return D(bw,bw)};bo=function(bw){return d(1/V(a8(bw)),bw)};aX=function(bx,bw){return d(1/2,z(bx,bw))};l=function(by,bx,bw){return[(1-bw)*by[0]+bw*bx[0],(1-bw)*by[1]+bw*bx[1],(1-bw)*by[2]+bw*bx[2]]};au=function(bx,bw){return l(bx,bw,1/3)};aE=function(bw){return d(1/a8(bw),bw)};k=function(by,bx){var bw;bw=bg(bx,by);return bg(by,d(D(bw,by)/a8(bw),bw))};aw=function(bx,bw){return V(a8(k(bx,bw)))};av=function(bD,bC,bA){var bB,by,bx,bw,bz;by=bg(bC,bD);bB=bg(bD,bA);bx=a8(by);bz=-D(bB,by)/bx;if(bz<=0){return a8(bB)}else{if(bz>=1){bw=a8(bg(bC,bA))}}bw=a8(az(by,bB))/bx;return bw};aY=function(bA,bz,by){var bx,bw;bx=bg(bz,bA);bw=bg(by,bz);return az(bx,bw)};F=function(bC,bB,bz){var bx,bD,bA,by,bw,bG,bF,bE,bH;for(bx=0,bD=bC.length;bx<bD;bx++){bG=bC[bx];for(bw=0,bA=bB.length;bw<bA;bw++){bF=bB[bw];if(bG===bF){for(bH=0,by=bz.length;bH<by;bH++){bE=bz[bH];if(bG===bE){return bG}}}}}return null};bn=function(bA){var bz,bx,bw,by;bz=[0,0,0];for(bx=0,bw=bA.length;bx<bw;bx++){by=bA[bx];bz=z(bz,by)}return d(1/bA.length,bz)};ak=function(bz){var by,bA,bw,bx,bB,bE,bD,bC;bw=[0,0,0];bx=bz.slice(-2),bE=bx[0],bD=bx[1];for(by=0,bA=bz.length;by<bA;by++){bC=bz[by];bw=z(bw,aY(bE,bD,bC));bB=[bD,bC],bE=bB[0],bD=bB[1]}return bo(bw)};bk=function(bz){var bw,by,bA,bx,bB,bE,bD,bC;bw=0;bx=bz.slice(0,2),bE=bx[0],bD=bx[1];bB=bz.slice(2);for(by=0,bA=bB.length;by<bA;by++){bC=bB[by];bw+=K(az(bg(bD,bE),bg(bC,bE)));bD=bC}return bw};aC=function(bD){var bB,by,bE,bA,bz,bw,bx,bF,bC,bL,bK,bJ,bI,bG,bH;bB=[];bx=bD.slice(0,2),bJ=bx[0],bI=bx[1];bF=bD.slice(2);for(by=0,bE=bF.length;by<bE;by++){bG=bF[by];bB.push(K(az(bg(bI,bJ),bg(bG,bJ))));bI=bG}bB.sort(function(bN,bM){return bN-bM});bL="";for(bw=0,bA=bB.length;bw<bA;bw++){bH=bB[bw];bL+=at(bH,2)}bC=bB.reverse();for(bK=0,bz=bC.length;bK<bz;bK++){bH=bC[bK];bL+=at(bH,2)}return bL};Z=function(bD){var bC,by,bB,bx,bw,bA,bz,bF,bE;bz=L(bD);bE=bD[0];bz=_.map(bz,function(bG){return bG-bE});bx=ak(bD);bC=bo(bn(bD));bw=az(bx,bC);bA=[];for(by=0,bB=bz.length;by<bB;by++){bF=bz[by];bA.push([D(bx,bF),D(bw,bF)])}return bA};a7=function(bz){var by,bx,bw,bA;bw=new Array(bz.length);for(by=bx=0,bA=bz.length;0<=bA?bx<bA:bx>bA;by=0<=bA?++bx:--bx){bw[by]=bz[by].slice(0)}return bw};r=function(bx,bw){return[bx[0][0]*bw[0]+bx[0][1]*bw[1]+bx[0][2]*bw[2],bx[1][0]*bw[0]+bx[1][1]*bw[1]+bx[1][2]*bw[2],bx[2][0]*bw[0]+bx[2][1]*bw[1]+bx[2][2]*bw[2]]};aH=function(bw,bx){return[[bw[0][0]*bx[0][0]+bw[0][1]*bx[1][0]+bw[0][2]*bx[2][0],bw[0][0]*bx[0][1]+bw[0][1]*bx[1][1]+bw[0][2]*bx[2][1],bw[0][0]*bx[0][2]+bw[0][1]*bx[1][2]+bw[0][2]*bx[2][2]],[bw[1][0]*bx[0][0]+bw[1][1]*bx[1][0]+bw[1][2]*bx[2][0],bw[1][0]*bx[0][1]+bw[1][1]*bx[1][1]+bw[1][2]*bx[2][1],bw[1][0]*bx[0][2]+bw[1][1]*bx[1][2]+bw[1][2]*bx[2][2]],[bw[2][0]*bx[0][0]+bw[2][1]*bx[1][0]+bw[2][2]*bx[2][0],bw[2][0]*bx[0][1]+bw[2][1]*bx[1][1]+bw[2][2]*bx[2][1],bw[2][0]*bx[0][2]+bw[2][1]*bx[1][2]+bw[2][2]*bx[2][2]]]};v=[[1,0,0],[0,1,0],[0,0,1]];i=function(bA,by,bz){var bB,bx,bw;bB=[[I(bA),-1*a1(bA),0],[a1(bA),I(bA),0],[0,0,1]];bw=[[I(by),0,-1*a1(by)],[0,1,0],[a1(by),0,I(by)]];bx=[[1,0,0],[0,I(bz),-1*a1(bz)],[0,a1(bz),I(bz)]];return aH(bx,aH(bw,bB))};aW=function(bA,bJ,bI,bE){var bC,bx,bz,by,bD,bH,bG,bw,bF,bB;bA/=2;bH=a1(bA);bC=I(bA);bG=bH*bH;bx=K([bJ,bI,bE]);if(bx===0){by=[0,0,1],bJ=by[0],bI=by[1],bE=by[2]}if(bx!==1){bD=bo([bJ,bI,bE]),bJ=bD[0],bI=bD[1],bE=bD[2]}if(bJ===1&&bI===0&&bE===0){bz=[[1,0,0],[0,1-2*bG,2*bH*bC],[0,-2*bH*bC,1-2*bG]]}else{if(bJ===0&&bI===1&&bE===0){bz=[[1-2*bG,0,-2*bH*bC],[0,1,0],[2*bH*bC,0,1-2*bG]]}else{if(bJ===0&&bI===0&&bE===1){bz=[[1-2*bG,2*bH*bC,0],[-2*bH*bC,1-2*bG,0],[0,0,1]]}else{bw=bJ*bJ;bF=bI*bI;bB=bE*bE;bz=[[1-2*(bF+bB)*bG,2*(bJ*bI*bG+bE*bH*bC),2*(bJ*bE*bG-bI*bH*bC)],[2*(bI*bJ*bG-bE*bH*bC),1-2*(bB+bw)*bG,2*(bI*bE*bG+bJ*bH*bC)],[2*(bE*bJ*bG+bI*bH*bC),2*(bE*bI*bG-bJ*bH*bC),1-2*(bw+bF)*bG]]}}}return bz};x=function(by,bx,bz,bC,bw){var bA,bB;bB=(bx*bC-bz)/(1-bC);bA=bw*bC/(1-bC);return[bA*by[0]/(by[2]+bB),bA*by[1]/(by[2]+bB)]};aN=function(bD,bA,bG,bE,bK,bz,by,bx){var bJ,bw,bF,bB,bH,bM,bO,bC,bI,bL,bN;bI=(bK*by-bz)/(1-by);bJ=bx*by/(1-by);bF=bD-bG;bM=bA-bE;bw=bJ*bJ;bL=bI*bI;bB=bF*bF;bO=bM*bM;bH=(2*bJ*bF*bI+V(4*bw*bB*bL+4*bB*(bw+bB+bO)*(1-bL)))/(2*(bw+bB+bO));bC=(bJ*bM*bI)/(bw+bB+bO)+(bM*V(4*bw*bL+4*(bw+bB+bO)*(1-bL)))/(2*(bw+bB+bO));bN=V(1-bH*bH-bC*bC);return[bH,bC,bN]};aF=function(by,bx){var bz,bw;bw=az(by,bx);bz=a4(D(by,bx));return aW(-1*bz,bw[0],bw[1],bw[2])};ba=function(bz){var by,bx,bw,bB,bA;by=[];bB=bz.slice(-1)[0];for(bx=0,bw=bz.length;bx<bw;bx++){bA=bz[bx];by.push([bB,bA]);bB=bA}return by};c=function(bw){var bC,bB,bz,bD,bA,bx,by,bF,bE;bE=[];by=bw.face;for(bB=bz=0,bD=by.length;bz<bD;bB=++bz){bC=by[bB];for(bx=0,bA=bC.length;bx<bA;bx++){bF=bC[bx];bE[bF]=bw.face_class[bB]}}return bE};aS=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];bu=function(bx){var bw;if(bx[0]==="#"){bx=bx.slice(1)}if(bx.length===3){bw=bx.split("").map(function(by){return parseInt(by+by,16)/255})}else{bw=bx.match(/.{2}/g).map(function(by){return parseInt(by,16)/255})}return bw};a2=aS;ag=function(bw){if(bw<a2.length){return bu(a2[bw])}else{return bu(a2[a2.length-1])}};Q=function(bw){var bF,by,bC,bA,bE,bz,bB,bx,bD;bw.face_class=[];bC={};by=function(bG,bJ){var bH,bI;bI=Y(100*bG);if(bI in bJ){return bJ[bI]}else{bH=_.toArray(bJ).length;bJ[bI]=bH;return bH}};bx=bw.face;for(bz=0,bB=bx.length;bz<bB;bz++){bA=bx[bz];if(an==="area"){bE=(function(){var bG,bI,bH;bH=[];for(bI=0,bG=bA.length;bI<bG;bI++){bD=bA[bI];bH.push(bw.xyz[bD])}return bH})();bF=by(bk(bE),bC)}else{if(an==="signature"){bE=(function(){var bG,bI,bH;bH=[];for(bI=0,bG=bA.length;bI<bG;bI++){bD=bA[bI];bH.push(bw.xyz[bD])}return bH})();bF=by(aC(bE),bC)}else{bF=bA.length-3}}bw.face_class.push(bF)}console.log(_.toArray(bC).length+" face classes");return bw};aT=function(bw){var bx,bF,bA,bE,bG,bB,bz,bC,by,bD;bx=bw.centers();bE=bw.normals();bB=[0,0,(A*M-bq)/(1-M)];bG=function(bI,bH){return -D(bg(bB,bI[0]),bI[1])*D(bg(bH[0],bI[0]),bI[1])};by=function(bI,bH){return bI[0][2]-bH[0][2]};bD=_.zip(bx,bE,(function(){bC=[];for(var bH=0,bI=bw.face.length;0<=bI?bH<bI:bH>bI;0<=bI?bH++:bH--){bC.push(bH)}return bC}).apply(this)).sort(by).map(function(bH){return bH[2]});bw.face=(function(){var bH,bJ,bI;bI=[];for(bJ=0,bH=bD.length;bJ<bH;bJ++){bF=bD[bJ];bI.push(bw.face[bF])}return bI})();return bw.face_class=(function(){var bH,bJ,bI;bI=[];for(bJ=0,bH=bD.length;bJ<bH;bJ++){bF=bD[bJ];bI.push(bw.face_class[bF])}return bI})()};aR=(function(){function bw(bz,bx,by){this.face=bx||new Array();this.xyz=bz||new Array();this.name=by||"null polyhedron"}bw.prototype.data=function(){var bx;bx=this.face.length+this.xyz.length-2;return this.face.length+" faces, "+bx+" edges, "+this.xyz.length+" vertices"};bw.prototype.moreData=function(){return"min. edge length "+(this.minEdgeLength().toPrecision(2))+"; min. face radius "+(this.minFaceRadius().toPrecision(2))};bw.prototype.edges=function(){var bH,bE,bG,bF,bx,bD,bB,bz,bC,bA,by,bI;bD={};bI=[];bE=_.map(this.face,ba);for(bz=0,bC=bE.length;bz<bC;bz++){bx=bE[bz];for(by=0,bA=bx.length;by<bA;by++){bF=bx[by];if(bF[0]<bF[1]){bH=bF[0],bG=bF[1]}else{bG=bF[0],bH=bF[1]}bD[bH+"~"+bG]=bF}}for(bB in bD){bF=bD[bB];bI.push(bF)}return bI};bw.prototype.minEdgeLength=function(){var bB,bC,by,bx,bz,bA;bz=Number.MAX_VALUE;bA=this.edges();for(by=0,bx=bA.length;by<bx;by++){bC=bA[by];bB=a8(bg(this.xyz[bC[0]],this.xyz[bC[1]]));if(bB<bz){bz=bB}}return V(bz)};bw.prototype.minFaceRadius=function(){var bG,bz,bB,bF,bC,bA,bD,bI,bH,bx,by,bE;bI=Number.MAX_VALUE;bH=this.face.length;bz=this.centers();for(bC=bA=0,by=bH;0<=by?bA<by:bA>by;bC=0<=by?++bA:--bA){bG=bz[bC];bE=ba(this.face[bC]);for(bx=0,bD=bE.length;bx<bD;bx++){bF=bE[bx];bB=av(this.xyz[bF[0]],this.xyz[bF[1]],bG);if(bB<bI){bI=bB}}}return V(bI)};bw.prototype.centers=function(){var bC,bD,bA,bz,bE,bB,bx,by,bF;bC=[];by=this.face;for(bz=0,bE=by.length;bz<bE;bz++){bD=by[bz];bA=[0,0,0];for(bx=0,bB=bD.length;bx<bB;bx++){bF=bD[bx];bA=z(bA,this.xyz[bF])}bC.push(d(1/bD.length,bA))}return bC};bw.prototype.normals=function(){var bB,by,bx,bC,bA,bz;bC=[];bA=this.face;for(by=0,bx=bA.length;by<bx;by++){bB=bA[by];bC.push(ak((function(){var bD,bF,bE;bE=[];for(bF=0,bD=bB.length;bF<bD;bF++){bz=bB[bF];bE.push(this.xyz[bz])}return bE}).call(this)))}return bC};bw.prototype.toOBJ=function(){var bH,bE,bA,bI,bD,bC,bB,bx,by,bG,bz,bJ,bF,bM,bL,bK;bG="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bG+="group "+this.name+"\n";bG+="#vertices\n";bz=this.xyz;for(bA=0,bI=bz.length;bA<bI;bA++){bL=bz[bA];bG+="v "+bL[0]+" "+bL[1]+" "+bL[2]+"\n"}bG+="#normal vector defs \n";bJ=this.face;for(by=0,bD=bJ.length;by<bD;by++){bH=bJ[by];bx=ak((function(){var bN,bP,bO;bP=[];for(bO=0,bN=bH.length;bO<bN;bO++){bL=bH[bO];bP.push(this.xyz[bL])}return bP}).call(this));bG+="vn "+bx[0]+" "+bx[1]+" "+bx[2]+"\n"}bG+="#face defs \n";bF=this.face;for(bE=bM=0,bC=bF.length;bM<bC;bE=++bM){bH=bF[bE];bG+="f ";for(bK=0,bB=bH.length;bK<bB;bK++){bL=bH[bK];bG+=(bL+1)+"//"+(bE+1)+" "}bG+="\n"}return bG};bw.prototype.toX3D=function(){var bz,bK,bN,bF,bB,bG,bD,bC,bA,bx,by,bH,bE,bL,bJ,bI,bM;bz=0.01;bM='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';by=this.face;for(bB=0,bG=by.length;bB<bG;bB++){bF=by[bB];for(bx=0,bD=bF.length;bx<bD;bx++){bJ=bF[bx];bM+=bJ+" "}bM+="-1\n"}bM+='">\n';bM+='<Color color="';bH=c(this);for(bL=0,bC=bH.length;bL<bC;bL++){bK=bH[bL];bN=ag(bK);bM+=bN[0]+" "+bN[1]+" "+bN[2]+" "}bM+='"/>';bM+='<Coordinate point="';bE=this.xyz;for(bI=0,bA=bE.length;bI<bA;bI++){bJ=bE[bI];bM+=(bJ[0]*bz)+" "+(bJ[1]*bz)+" "+(bJ[2]*bz)+" "}bM+='"/>\n';bM+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bM};bw.prototype.toVRML=function(){var bz,bK,bN,bF,bB,bG,bD,bC,bA,bx,by,bH,bE,bL,bJ,bI,bM;bz=0.01;bM='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';by=this.xyz;for(bB=0,bG=by.length;bB<bG;bB++){bJ=by[bB];bM+=(bJ[0]*bz)+" "+(bJ[1]*bz)+" "+(bJ[2]*bz)+","}bM=bM.slice(0,-1);bM+="    ]\n}\ncolor Color\n{\n  color\n  [";bH=this.face_class;for(bx=0,bD=bH.length;bx<bD;bx++){bK=bH[bx];bN=ag(bK);bM+=bN[0]+" "+bN[1]+" "+bN[2]+" ,"}bM=bM.slice(0,-1);bM+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bE=this.face;for(bL=0,bC=bE.length;bL<bC;bL++){bF=bE[bL];for(bI=0,bA=bF.length;bI<bA;bI++){bJ=bF[bI];bM+=bJ+", "}bM+="-1,"}bM=bM.slice(0,-1);bM+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bM};return bw})();f=function(){var bw;bw=new aR();bw.name="T";bw.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bw.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bw};ap=function(){var bw;bw=new aR();bw.name="O";bw.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bw.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bw};aj=function(){var bw;bw=new aR();bw.name="C";bw.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bw.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bw};a9=function(){var bw;bw=new aR();bw.name="I";bw.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bw.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bw};aq=function(){var bw;bw=new aR();bw.name="D";bw.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bw.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bw};T=function(bA){var bw,bH,bF,bD,bz,bx,bB,bK,bJ,bI,bG,bE,bC,by,bM,bL;by=2*aL/bA;bH=Math.sin(by/2);bx=new aR();bx.name="P"+bA;for(bF=bD=0,bB=bA;0<=bB?bD<bB:bD>bB;bF=0<=bB?++bD:--bD){bx.xyz.push([-I(bF*by),-a1(bF*by),-bH])}for(bF=bz=0,bK=bA;0<=bK?bz<bK:bz>bK;bF=0<=bK?++bz:--bz){bx.xyz.push([-I(bF*by),-a1(bF*by),bH])}bx.face.push((function(){bE=[];for(var bN=bJ=bA-1;bJ<=0?bN<=0:bN>=0;bJ<=0?bN++:bN--){bE.push(bN)}return bE}).apply(this));bx.face.push((function(){bC=[];for(var bO=bA,bN=2*bA;bA<=bN?bO<bN:bO>bN;bA<=bN?bO++:bO--){bC.push(bO)}return bC}).apply(this));for(bF=bw=0,bG=bA;0<=bG?bw<bG:bw>bG;bF=0<=bG?++bw:--bw){bx.face.push([bF,(bF+1)%bA,(bF+1)%bA+bA,bF+bA])}bx=y(bx,1);return bx};aZ=function(bJ){var bO,bN,bM,bL,bK,bH,by,bG,bx,bF,bE,bC,bB,bI,bw,bz,bD,bA;bz=2*aL/bJ;bM=V(1-4/(4+2*I(bz/2)-2*I(bz)));bG=V(1-bM*bM);bN=V(bM*bM+bb(bG*I(bz/2),2));bG=-bG/bN;bM=-bM/bN;by=new aR();by.name="A"+bJ;for(bL=bK=0,bx=bJ;0<=bx?bK<bx:bK>bx;bL=0<=bx?++bK:--bK){by.xyz.push([bG*I(bL*bz),bG*a1(bL*bz),bM])}for(bL=bH=0,bF=bJ;0<=bF?bH<bF:bH>bF;bL=0<=bF?++bH:--bH){by.xyz.push([bG*I((bL+0.5)*bz),bG*a1((bL+0.5)*bz),-bM])}by.face.push((function(){bI=[];for(var bP=bE=bJ-1;bE<=0?bP<=0:bP>=0;bE<=0?bP++:bP--){bI.push(bP)}return bI}).apply(this));by.face.push((function(){bw=[];for(var bQ=bJ,bP=2*bJ-1;bJ<=bP?bQ<=bP:bQ>=bP;bJ<=bP?bQ++:bQ--){bw.push(bQ)}return bw}).apply(this));for(bL=bO=0,bB=bJ-1;0<=bB?bO<=bB:bO>=bB;bL=0<=bB?++bO:--bO){by.face.push([bL,(bL+1)%bJ,bL+bJ]);by.face.push([bL,bL+bJ,(bJ+bL-1)%bJ+bJ])}by=y(by,1);return by};bs=function(bz){var bH,bD,bB,by,bw,bA,bF,bE,bC,bx,bG;bx=2*aL/bz;bH=1;bw=new aR();bw.name="Y"+bz;for(bD=bB=0,bA=bz;0<=bA?bB<bA:bB>bA;bD=0<=bA?++bB:--bB){bw.xyz.push([-I(bD*bx),-a1(bD*bx),-0.2])}bw.xyz.push([0,0,bH]);bw.face.push((function(){bC=[];for(var bI=bF=bz-1;bF<=0?bI<=0:bI>=0;bF<=0?bI++:bI--){bC.push(bI)}return bC}).apply(this));for(bD=bG=0,bE=bz;0<=bE?bG<bE:bG>bE;bD=0<=bE?++bG:--bG){bw.face.push([bD,(bD+1)%bz,bz])}bw=g(bw,3);return bw};ai=(function(){function bw(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bw.prototype.newV=function(by,bx){if(this.verts[by]===void 0){this.verts[by]=0;return this.xyzs[by]=bx}};bw.prototype.newFlag=function(bx,bz,by){if(this.flags[bx]===void 0){this.flags[bx]={}}return this.flags[bx][bz]=by};bw.prototype.topoly=function(){var by,bC,bG,bB,bA,bx,bz,bD,bF,bE;bx=new aR();by=0;bz=this.verts;for(bB in bz){bF=bz[bB];bx.xyz[by]=this.xyzs[bB];this.verts[bB]=by;by++}by=0;bD=this.flags;for(bB in bD){bC=bD[bB];bx.face[by]=[];for(bA in bC){bF=bC[bA];bE=bF;break}bF=bE;bx.face[by].push(this.verts[bF]);bF=this.flags[bB][bF];bG=0;while(bF!==bE){bx.face[by].push(this.verts[bF]);bF=this.flags[bB][bF];bG++;if(bG>1000){console.log("Bad flag spec, have a neverending face:",bB,this.flags[bB]);break}}by++}bx.name="unknown polyhedron";return bx};return bw})();ad=function(bC,bM,bA){var bz,bS,bR,bO,bT,by,bP,bN,bQ,bE,bD,bF,bJ,bL,bK,bB,bI,bH,bG,bx,bw;bM||(bM=0);bA||(bA=0.1);console.log("Taking kis of "+(bM===0?"":bM)+"-sided faces of "+bC.name+"...");bO=new ai();bB=bC.xyz;for(bP=bN=0,bQ=bB.length;bN<bQ;bP=++bN){bK=bB[bP];bO.newV("v"+bP,bK)}bJ=bC.normals();bS=bC.centers();by=false;bI=bC.face;for(bP=bL=0,bE=bI.length;bL<bE;bP=++bL){bR=bI[bP];bx="v"+bR[bR.length-1];for(bH=0,bD=bR.length;bH<bD;bH++){bG=bR[bH];bw="v"+bG;if(bR.length===bM||bM===0){by=true;bz="apex"+bP;bT=""+bP+bx;bO.newV(bz,z(bS[bP],d(bA,bJ[bP])));bO.newFlag(bT,bx,bw);bO.newFlag(bT,bw,bz);bO.newFlag(bT,bz,bx)}else{bO.newFlag(""+bP,bx,bw)}bx=bw}}if(!by){console.log("No "+bM+"-fold components were found.")}bF=bO.topoly();bF.name="k"+(bM===0?"":bM)+bC.name;return bF};aJ=function(bw){var bF,bI,bD,bB,bG,bC,bx,bA,by,bz,bH,bE,bL,bK,bJ;console.log("Taking ambo of "+bw.name+"...");bx=function(bN,bM){if(bN<bM){return bN+"_"+bM}else{return bM+"_"+bN}};bI=new ai();bz=bw.face;for(bD=bB=0,bG=bz.length;bB<bG;bD=++bB){bF=bz[bD];bH=bF.slice(-2),bL=bH[0],bK=bH[1];for(by=0,bC=bF.length;by<bC;by++){bJ=bF[by];if(bL<bK){bI.newV(bx(bL,bK),aX(bw.xyz[bL],bw.xyz[bK]))}bI.newFlag("orig"+bD,bx(bL,bK),bx(bK,bJ));bI.newFlag("dual"+bK,bx(bK,bJ),bx(bL,bK));bE=[bK,bJ],bL=bE[0],bK=bE[1]}}bA=bI.topoly();bA.name="a"+bw.name;return bA};a5=function(bA){var bT,bS,bP,bU,bQ,bO,bN,bR,bD,bC,bB,bG,bM,bz,bL,bK,bI,bF,bJ,bH,by,bx,bw,bE;console.log("Taking gyro of "+bA.name+"...");bP=new ai();bz=bA.xyz;for(bQ=bN=0,bR=bz.length;bN<bR;bQ=++bN){bH=bz[bQ];bP.newV("v"+bQ,bo(bH))}bT=bA.centers();bL=bA.face;for(bQ=bM=0,bD=bL.length;bM<bD;bQ=++bM){bS=bL[bQ];bP.newV("center"+bQ,bo(bT[bQ]))}bK=bA.face;for(bQ=bJ=0,bC=bK.length;bJ<bC;bQ=++bJ){bS=bK[bQ];bI=bS.slice(-2),by=bI[0],bx=bI[1];for(bO=bE=0,bB=bS.length;bE<bB;bO=++bE){bH=bS[bO];bw=bH;bP.newV(by+"~"+bx,au(bA.xyz[by],bA.xyz[bx]));bU=bQ+"f"+by;bP.newFlag(bU,"center"+bQ,by+"~"+bx);bP.newFlag(bU,by+"~"+bx,bx+"~"+by);bP.newFlag(bU,bx+"~"+by,"v"+bx);bP.newFlag(bU,"v"+bx,bx+"~"+bw);bP.newFlag(bU,bx+"~"+bw,"center"+bQ);bF=[bx,bw],by=bF[0],bx=bF[1]}}bG=bP.topoly();bG.name="g"+bA.name;return bG};s=function(bA){var bO,bL,bP,bM,bK,bN,bC,bB,bD,bJ,bz,bI,bH,bF,bG,bE,by,bx,bw;console.log("Taking propellor of "+bA.name+"...");bL=new ai();bz=bA.xyz;for(bM=bK=0,bN=bz.length;bK<bN;bM=++bK){bE=bz[bM];bL.newV("v"+bM,bo(bE))}bI=bA.face;for(bM=bJ=0,bC=bI.length;bJ<bC;bM=++bJ){bO=bI[bM];bH=bO.slice(-2),by=bH[0],bx=bH[1];for(bG=0,bB=bO.length;bG<bB;bG++){bE=bO[bG];bw=""+bE;bL.newV(by+"~"+bx,au(bA.xyz[by],bA.xyz[bx]));bP=bM+"f"+bx;bL.newFlag("v"+bM,by+"~"+bx,bx+"~"+bw);bL.newFlag(bP,by+"~"+bx,bx+"~"+by);bL.newFlag(bP,bx+"~"+by,"v"+bx);bL.newFlag(bP,"v"+bx,bx+"~"+bw);bL.newFlag(bP,bx+"~"+bw,by+"~"+bx);bF=[bx,bw],by=bF[0],bx=bF[1]}}bD=bL.topoly();bD.name="p"+bA.name;return bD};t=function(bA){var by,bw,bB,bz,bx;console.log("Taking reflection of "+bA.name+"...");for(by=bw=0,bz=bA.xyz.length-1;0<=bz?bw<=bz:bw>=bz;by=0<=bz?++bw:--bw){bA.xyz[by]=d(-1,bA.xyz[by])}for(by=bB=0,bx=bA.face.length-1;0<=bx?bB<=bx:bB>=bx;by=0<=bx?++bB:--bB){bA.face[by]=bA.face[by].reverse()}bA.name="r"+bA.name;return bA};aK=function(bz){var bW,bV,bU,bT,bX,bS,bE,bP,bQ,bO,bN,bR,bD,bC,bB,bA,bM,by,bK,bJ,bH,bG,bL,bI,bx,bw,bF;console.log("Taking dual of "+bz.name+"...");bP=new ai();bE=[];for(bQ=bN=0,by=bz.xyz.length-1;0<=by?bN<=by:bN>=by;bQ=0<=by?++bN:--bN){bE[bQ]={}}bK=bz.face;for(bQ=bM=0,bR=bK.length;bM<bR;bQ=++bM){bS=bK[bQ];bx=bS[bS.length-1];for(bI=0,bD=bS.length;bI<bD;bI++){bw=bS[bI];bE[bx]["v"+bw]=""+bQ;bx=bw}}bT=bz.centers();for(bQ=bF=0,bJ=bz.face.length-1;0<=bJ?bF<=bJ:bF>=bJ;bQ=0<=bJ?++bF:--bF){bP.newV(""+bQ,bT[bQ])}bH=bz.face;for(bQ=bW=0,bC=bH.length;bW<bC;bQ=++bW){bS=bH[bQ];bx=bS[bS.length-1];for(bV=0,bB=bS.length;bV<bB;bV++){bw=bS[bV];bP.newFlag(bx,bE[bw]["v"+bx],""+bQ);bx=bw}}bX=bP.topoly();bL=[];bG=bX.face;for(bU=0,bA=bG.length;bU<bA;bU++){bS=bG[bU];bO=F(bz.face[bS[0]],bz.face[bS[1]],bz.face[bS[2]]);bL[bO]=bS}bX.face=bL;if(bz.name[0]!=="d"){bX.name="d"+bz.name}else{bX.name=bz.name.slice(1)}return bX};bl=function(bx,bJ){var bG,bw,bI,bE,bC,bH,bD,bB,bL,by,bz,bM,bF,bK,bA;console.log("Taking chamfer of "+bx.name+"...");bJ||(bJ=0.5);bI=new ai();bL=bx.normals();bz=bx.face;for(bE=bC=0,bH=bz.length;bC<bH;bE=++bC){bG=bz[bE];bM=bG[bG.length-1];bF=bE+"_"+bM;for(by=0,bD=bG.length;by<bD;by++){bK=bG[by];bI.newV(bK,bx.xyz[bK]);bA=bE+"_"+bK;bI.newV(bA,z(bx.xyz[bK],d(bJ*1.5,bL[bE])));bI.newFlag("orig"+bE,bF,bA);bw=(bM<bK?"hex"+bM+"_"+bK:"hex"+bK+"_"+bM);bI.newFlag(bw,bK,bA);bI.newFlag(bw,bA,bF);bI.newFlag(bw,bF,bM);bM=bK;bF=bA}}bB=bI.topoly();bB.name="c"+bx.name;return bB};bm=function(bA,bL){var bS,bT,bD,bR,bO,bU,bP,bN,bM,bQ,bC,bB,bE,bK,bz,bJ,bI,bG,bH,bF,by,bV,bx,bw;console.log("Taking whirl of "+bA.name+"...");bL||(bL=0);bO=new ai();bz=bA.xyz;for(bP=bM=0,bQ=bz.length;bM<bQ;bP=++bM){bF=bz[bP];bO.newV("v"+bP,bo(bF))}bS=bA.centers();bJ=bA.face;for(bP=bK=0,bC=bJ.length;bK<bC;bP=++bK){bR=bJ[bP];bI=bR.slice(-2),by=bI[0],bx=bI[1];for(bN=bH=0,bB=bR.length;bH<bB;bN=++bH){bF=bR[bN];bw=bF;bV=au(bA.xyz[by],bA.xyz[bx]);bO.newV(by+"~"+bx,bV);bT="center"+bP+"~"+by;bD="center"+bP+"~"+bx;bO.newV(bT,bo(au(bS[bP],bV)));bU=bP+"f"+by;bO.newFlag(bU,bT,by+"~"+bx);bO.newFlag(bU,by+"~"+bx,bx+"~"+by);bO.newFlag(bU,bx+"~"+by,"v"+bx);bO.newFlag(bU,"v"+bx,bx+"~"+bw);bO.newFlag(bU,bx+"~"+bw,bD);bO.newFlag(bU,bD,bT);bO.newFlag("c"+bP,bT,bD);bG=[bx,bw],by=bG[0],bx=bG[1]}}bE=bO.topoly();bE.name="w"+bA.name;return bE};E=function(bA,bP,bB,bQ){var bY,bW,bV,bS,bX,by,bT,bR,bU,bF,bE,bD,bC,bH,bM,bO,bN,bz,bL,bK,bJ,bI,bx,bw,bG;bP||(bP=0);bB||(bB=0.5);bQ||(bQ=-0.2);console.log("Taking inset of "+(bP===0?"":bP)+"-sided faces of "+bA.name+"...");bS=new ai();bz=bA.xyz;for(bT=bR=0,bU=bz.length;bR<bU;bT=++bR){bN=bz[bT];bS.newV("v"+bT,bN)}bM=bA.normals();bW=bA.centers();bL=bA.face;for(bT=bO=0,bF=bL.length;bO<bF;bT=++bO){bV=bL[bT];if(bV.length===bP||bP===0){for(bJ=0,bE=bV.length;bJ<bE;bJ++){bI=bV[bJ];bS.newV("f"+bT+"v"+bI,z(l(bA.xyz[bI],bW[bT],bB),d(bQ,bM[bT])))}}}by=false;bK=bA.face;for(bT=bG=0,bD=bK.length;bG<bD;bT=++bG){bV=bK[bT];bx="v"+bV[bV.length-1];for(bY=0,bC=bV.length;bY<bC;bY++){bI=bV[bY];bw="v"+bI;if(bV.length===bP||bP===0){by=true;bX=bT+bx;bS.newFlag(bX,bx,bw);bS.newFlag(bX,bw,"f"+bT+bw);bS.newFlag(bX,"f"+bT+bw,"f"+bT+bx);bS.newFlag(bX,"f"+bT+bx,bx);bS.newFlag("ex"+bT,"f"+bT+bx,"f"+bT+bw)}else{bS.newFlag(bT,bx,bw)}bx=bw}}if(!by){console.log("No "+bP+"-fold components were found.")}bH=bS.topoly();bH.name="n"+(bP===0?"":bP)+bA.name;return bH};ac=function(bA,bO){var bV,bU,bT,bQ,by,bR,bP,bS,bE,bD,bC,bB,bG,bL,bN,bM,bz,bK,bJ,bI,bH,bx,bw,bF;bO||(bO=0);console.log("Taking extrusion of "+(bO===0?"":bO)+"-sided faces of "+bA.name+"...");bQ=new ai();bz=bA.xyz;for(bR=bP=0,bS=bz.length;bP<bS;bR=++bP){bM=bz[bR];bQ.newV("v"+bR,bM)}bL=bA.normals();bU=bA.centers();bK=bA.face;for(bR=bN=0,bE=bK.length;bN<bE;bR=++bN){bT=bK[bR];if(bT.length===bO||bO===0){for(bI=0,bD=bT.length;bI<bD;bI++){bH=bT[bI];bQ.newV("f"+bR+"v"+bH,z(bA.xyz[bH],d(0.3,bL[bR])))}}}by=false;bJ=bA.face;for(bR=bF=0,bC=bJ.length;bF<bC;bR=++bF){bT=bJ[bR];bx="v"+bT[bT.length-1];for(bV=0,bB=bT.length;bV<bB;bV++){bH=bT[bV];bw="v"+bH;if(bT.length===bO||bO===0){by=true;bQ.newFlag(bR+bx,bx,bw);bQ.newFlag(bR+bx,bw,"f"+bR+bw);bQ.newFlag(bR+bx,"f"+bR+bw,"f"+bR+bx);bQ.newFlag(bR+bx,"f"+bR+bx,bx);bQ.newFlag("ex"+bR,"f"+bR+bx,"f"+bR+bw)}else{bQ.newFlag(bR,bx,bw)}bx=bw}}if(!by){console.log("No "+bO+"-fold components were found.")}bG=bQ.topoly();bG.name="x"+(bO===0?"":bO)+bA.name;return bG};a0=function(bC){var bV,bU,bR,bS,bQ,bT,bH,bF,bI,bP,bO,bB,bN,bM,bK,bL,bJ,by,bW,bx,bA,bz,bw,bG,bE,bD;console.log("Taking stella of "+bC.name+"...");bV=bC.centers();bR=new ai();bB=bC.xyz;for(bS=bQ=0,bT=bB.length;bQ<bT;bS=++bQ){bO=bB[bS];bR.newV("v"+bS,bO)}bN=bC.face;for(bS=bP=0,bH=bN.length;bP<bH;bS=++bP){bU=bN[bS];by="v"+bU[bU.length-2];bx="v"+bU[bU.length-1];bG=bC.xyz[bU[bU.length-2]];bE=bC.xyz[bU[bU.length-1]];for(bL=0,bF=bU.length;bL<bF;bL++){bJ=bU[bL];bw="v"+bJ;bD=bC.xyz[bJ];bW=by+"~"+bx;bA=bx+"~"+by;bz=bx+"~"+bw;bR.newV(bW,aX(aX(bG,bE),bV[bS]));bR.newFlag("in"+bS,bW,bz);bR.newFlag("f"+bS+bx,bz,bW);bR.newFlag("f"+bS+bx,bW,bx);bR.newFlag("f"+bS+bx,bx,bz);bR.newFlag("f"+bW,by,bA);bR.newFlag("f"+bW,bA,bW);bR.newFlag("f"+bW,bW,by);bM=[bx,bw],by=bM[0],bx=bM[1];bK=[bE,bD],bG=bK[0],bE=bK[1]}}bI=bR.topoly();bI.name="l"+bC.name;return bI};aa=function(bz,by){var bD,bC,bB,bx,bA,bw,bE;bD=0.1;bw=a7(bz);for(bx=0,bA=by.length;bx<bA;bx++){bB=by[bx];bE=k(bw[bB[0]],bw[bB[1]]);bC=d(bD*1/2*(1-V(D(bE,bE))),bE);bw[bB[0]]=z(bw[bB[0]],bC);bw[bB[1]]=z(bw[bB[1]],bC)}return bw};bc=function(bA,bz){var bD,bC,bw,bx,bB,by,bE;bw=(function(){var bG,bF,bI,bH;bH=[];for(bG=0,bF=bz.length;bG<bF;bG++){bI=bz[bG],bD=bI[0],bC=bI[1];bH.push(k(bA[bD],bA[bC]))}return bH})();by=[0,0,0];for(bx=0,bB=bw.length;bx<bB;bx++){bE=bw[bx];by=z(by,bE)}by=d(1/bz.length,by);return _.map(bA,function(bF){return bg(bF,by)})};B=function(bz){var bw,by,bx;by=[0,0,0];bw=_.max(_.map(bz,function(bA){return K(bA)}));bx=1/bw;return _.map(bz,function(bA){return[bx*bA[0],bx*bA[1],bx*bA[2]]})};bf=function(bC,bz){var bH,bF,bG,bD,bA,bE,bB,by,bw,bx,bI;bH=0.1;bw=a7(bC);for(bA=0,bE=bz.length;bA<bE;bA++){bD=bz[bA];bG=(function(){var bJ,bL,bK;bK=[];for(bL=0,bJ=bD.length;bL<bJ;bL++){bI=bD[bL];bK.push(bC[bI])}return bK})();by=ak(bG);bF=bn(bG);if(D(by,bF)<0){by=d(-1,by)}for(bx=0,bB=bD.length;bx<bB;bx++){bI=bD[bx];bw[bI]=z(bw[bI],d(D(d(bH,by),bg(bF,bC[bI])),by))}}return bw};n=function(bx,bF){var bC,bz,bD,bB,bE,bw,bA,bG,by;bF||(bF=1);console.log("Canonicalizing "+bx.name+"...");bz=bx.face;bC=bx.edges();bw=bx.xyz;bE=1;for(bD=bB=0,by=bF;0<=by?bB<=by:bB>=by;bD=0<=by?++bB:--bB){bG=a7(bw);bw=aa(bw,bC);bw=bc(bw,bC);bw=bf(bw,bz);bE=_.max(_.map(_.zip(bw,bG),function(bI){var bH,bJ;bH=bI[0],bJ=bI[1];return K(bg(bH,bJ))}));if(bE<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bE+"]");bA=new aR(bw,bx.face,bx.name);console.log("canonicalize",bA);return bA};O=function(bz){var bA,by,bx,bw;by=bz.centers();for(bx=0,bw=by.length;bx<bw;bx++){bA=by[bx];bA=d(1/D(bA,bA),bA)}return by};H=function(bx){var bM,bE,bz,bG,bB,bH,bC,bw,by,bA,bI,bF,bD,bL,bK,bJ;bM=[];bA=bx.face;for(bB=0,bH=bA.length;bB<bH;bB++){bG=bA[bB];bz=[0,0,0];bw=[0,0,0];bE=0;bI=bG.slice(-2),bL=bI[0],bK=bI[1];for(by=0,bC=bG.length;by<bC;by++){bJ=bG[by];bz=z(bz,bx.xyz[bJ]);bw=z(bw,aY(bx.xyz[bL],bx.xyz[bK],bx.xyz[bJ]));bE+=aw(bx.xyz[bL],bx.xyz[bK]);bF=[bK,bJ],bL=bF[0],bK=bF[1]}bz=d(1/bG.length,bz);bw=bo(bw);bE=bE/bG.length;bD=aE(d(D(bz,bw),bw));bM.push(d((1+bE)/2,bD))}return bM};g=function(bB,by){var bA,bx,bw,bz;by||(by=1);bx=aK(bB);console.log("Pseudo-canonicalizing "+bB.name+"...");for(bA=bw=0,bz=by;0<=bz?bw<bz:bw>bz;bA=0<=bz?++bw:--bw){bx.xyz=H(bB);bB.xyz=H(bx)}return new aR(bB.xyz,bB.face,bB.name)};y=function(bB,by){var bA,bx,bw,bz;by||(by=1);bx=aK(bB);console.log("Planarizing "+bB.name+"...");for(bA=bw=0,bz=by;0<=bz?bw<bz:bw>bz;bA=0<=bz?++bw:--bw){bx.xyz=O(bB);bB.xyz=O(bx)}return new aR(bB.xyz,bB.face,bB.name)};J=function(bY){var bX,bT,bM,bR,bW,bF,bZ,bP,bK,bH,bV,bA,bS,bL,bC,bD,bQ,bG,bO,bU,bE,bN,bB,bz,by,bx,bw,bJ,bI;bG=999;bS=[];bL=[];bC=bY.length;bV=function(b0,b1){return(b0||b1)&&!(b0&&b1)};bX=function(b2,b1,b0){return(b1[0]-b2[0])*(b0[1]-b2[1])-(b0[0]-b2[0])*(b1[1]-b2[1])};bK=function(b2,b1,b0){return bX(b2,b1,b0)>0};bH=function(b2,b1,b0){return bX(b2,b1,b0)>=0};bM=function(b2,b1,b0){return bX(b2,b1,b0)===0};bT=function(b2,b1,b0){if(bM(b2,b1,b0)){return false}if(b2[0]!==b1[0]){return(b2[0]<=b0[0])&&(b0[0]<=b1[0])||(b2[0]>=b0[0])&&(b0[0]>=b1[0])}else{return(b2[1]<=b0[1])&&(b0[1]<=b1[1])||(b2[1]>=b0[1])&&(b0[1]>=b1[1])}};bP=function(b3,b2,b1,b0){if(bM(b3,b2,b1)||bM(b3,b2,b0)||bM(b1,b0,b3)||bM(b1,b0,b2)){return false}return bV(bK(b3,b2,b1),bK(b3,b2,b0))&&bV(bK(b1,b0,b3),bK(b1,b0,b2))};bZ=function(b3,b2,b1,b0){if(bP(b3,b2,b1,b0)){return true}else{if(bT(b3,b2,b1)||bT(b3,b2,b0)||bT(b1,b0,b3)||bT(b1,b0,b2)){return true}else{return false}}};bF=function(b2,b0){var b3,b1;b1=(b2+1+bC)%bC;b3=(b2-1+bC)%bC;if(bH(bY[b2],bY[b1],bY[b3])){return bK(bY[b2],bY[b0],bY[b3])&&bK(bY[b0],bY[b2],bY[b1])}return !(bH(bY[b2],bY[b0],bY[b1])&&bH(bY[b0],bY[b2],bY[b3]))};bW=function(b1,b0){var b3,b2;b3=0;while(true){b2=(b3+1+bC)%bC;if((b3!==b1)&&(b2!==b1)&&(b3!==b0)&&(b2!==b0)&&bP(bY[b1],bY[b0],bY[b3],bY[b2])){return false}b3=(b3+1+bC)%bC;if(b3===0){break}}return true};bR=function(b1,b0){return bF(b1,b0)&&bF(b0,b1)&&bW(b1,b0)};bz=0;while(true){by=(bz+1+bC)%bC;bB=(bz-1+bC)%bC;bL[bz]=bR(bB,by);bz=(bz+1+bC)%bC;if(bz===0){break}}bU=(function(){bN=[];for(var b0=0,b1=bC-1;0<=b1?b0<=b1:b0>=b1;0<=b1?b0++:b0--){bN.push(b0)}return bN}).apply(this);bO=bC;bI=bG;bD=0;while(bI>0&&bO>3){bI-=1;by=bD;bJ=bG;while(true){bJ-=1;bA=false;if(bL[by]){bx=(by+1+bC)%bC;bw=(bx+1+bC)%bC;bz=(by-1+bC)%bC;bB=(bz-1+bC)%bC;bS.push([bU[bz],bU[bx]]);bL[bz]=bR(bB,bx);bL[bx]=bR(bz,bw);bY=bY.slice(0,+by+1||9000000000).concat(bY.slice(bx));bU=bU.slice(0,+by+1||9000000000).concat(bU.slice(bx));if(bB>by){bB-=1}if(bz>by){bz-=1}if(bx>by){bx-=1}if(bw>by){bw-=1}bC--;bD=bx;bO--;bA=true}by=(by+1+bC)%bC;if(!(bJ>0&&!bA&&by!==bD)){break}}}return bS};a=function(bx,bw){if(((bx[0]===bw[0])&&(bx[1]===bw[1])&&(bx[2]===bw[2]))||(bx[0]===bw[1])&&(bx[1]===bw[2])&&(bx[2]===bw[0])||(bx[0]===bw[2])&&(bx[1]===bw[0])&&(bx[2]===bw[1])){return true}else{return false}};u=function(b3,bV){var bQ,bO,bM,bK,bI,bS,b4,bU,bT,bP,bW,b2,b1,bR,bE,bD,bC,bB,bA,bz,by,bx,b0,bw,bZ,bN,bL,bJ,bH,bG,bF,b5,bY,b8,b7,b6,bX;bP=[];bw=[];bZ=(function(){var cb,ca,b9;b9=[];for(b2=cb=0,ca=b3.length-1;0<=ca?cb<=ca:cb>=ca;b2=0<=ca?++cb:--cb){b9.push([b2,(b2+1)%b3.length])}return b9})();for(b1=0,bR=bZ.length;b1<bR;b1++){bN=bZ[b1],b7=bN[0],b6=bN[1];bP[b7]=[b6];bw[b6]=[b7]}for(b0=0,bE=bV.length;b0<bE;b0++){b4=bV[b0];bP[b4[0]].push(b4[1]);bP[b4[1]].push(b4[0]);bw[b4[0]].push(b4[1]);bw[b4[1]].push(b4[0])}b5=[];for(bY=0,bD=bV.length;bY<bD;bY++){b4=bV[bY];bL=bP[b4[1]];for(bX=0,bC=bL.length;bX<bC;bX++){bU=bL[bX];bJ=bw[b4[0]];for(bQ=0,bB=bJ.length;bQ<bB;bQ++){bT=bJ[bQ];if(bU===bT){b5.push([b4[0],b4[1],bU])}}}bH=bP[b4[0]];for(bO=0,bA=bH.length;bO<bA;bO++){bU=bH[bO];bG=bw[b4[1]];for(bM=0,bz=bG.length;bM<bz;bM++){bT=bG[bM];if(bU===bT){b5.push([b4[1],b4[0],bU])}}}}b8=[b5.pop()];for(bK=0,by=b5.length;bK<by;bK++){bF=b5[bK];bS=false;for(bI=0,bx=b8.length;bI<bx;bI++){bW=b8[bI];if(a(bF,bW)){bS=true;break}}if(!bS){b8.push(bF)}}return b8};ab=function(bx,bw){var bA,bz,bI,bG,bF,bD,bH,bE,bC,by,bB,bL,bK,bJ;bw=bw||false;console.log("Triangulating faces of "+bx.name+"...");bC=new aR();bC.xyz=L(bx.xyz);bC.face_class=[];bB=bx.face;for(bG=bD=0,bH=bB.length;bD<bH;bG=++bD){bI=bB[bG];if(bI.length>3){bA=Z((function(){var bM,bO,bN;bN=[];for(bO=0,bM=bI.length;bO<bM;bO++){bJ=bI[bO];bN.push(bx.xyz[bJ])}return bN})());bz=J(bA);bK=u(bI,bz);for(bF=by=0,bE=bK.length;by<bE;bF=++by){bL=bK[bF];bC.face.push([bI[bL[0]],bI[bL[1]],bI[bL[2]]]);if(bw){bC.face_class.push(bx.face_class[bG])}}}else{bC.face.push([bI[0],bI[1],bI[2]]);if(bw){bC.face_class.push(bx.face_class[bG])}}}bC.name=bx.name;return bC};ah=function(bw){var bB,bz,bC,bA,bx,by,bD,bE;bD="";by=bw.face;for(bz=0,bC=by.length;bz<bC;bz++){bB=by[bz];for(bx=0,bA=bB.length;bx<bA;bx++){bE=bB[bx];bD+=bE+"->"}bD+="\n"}return console.log(bD)};C=function(){var bz,bw,bA,bC,bD,bB,by,bx;bx=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bB=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bz=0,bw=bB.length;bz<bw;bz++){bD=bB[bz];console.log("Operator "+bD);for(bC=0,bA=bx.length;bC<bA;bC++){by=bx[bC];console.log(bD+by+":",generatePoly(bD+by))}}return console.log("===== Done Testing Basic Ops =====")};aU='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';bh=PEG.buildParser(aU);bv=function(bx,bw){return bx.apply(this,bw||[])};bj={T:f,O:ap,C:aj,I:a9,D:aq,P:T,A:aZ,Y:bs};G={d:aK,k:ad,a:aJ,g:a5,p:s,r:t,c:bl,w:bm,n:E,x:ac,l:a0,z:ab,K:g,C:n,A:y};aQ=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a3=function(bB){var bx,bz,by,bw,bC,bA;bz=bB;for(by=0,bw=aQ.length;by<bw;by++){bA=aQ[by],bC=bA[0],bx=bA[1];bz=bz.replace(bC,bx)}console.log(bB+" executed as "+bz);return bz};bt=function(bD){var bx,bE,by,bB,bz,bG,bA,bF,bC,bw;bC=a3(bD);bF=bh.parse(bC).reverse();bz=bF.shift();bE=bj[bz.op];bx=bz.args;bw=bv(bE,bx);for(by=0,bB=bF.length;by<bB;by++){bz=bF[by];bA=G[bz.op];bG=[bw].concat(bz.args);bw=bv(bA,bG)}bw.xyz=bc(bw.xyz,bw.edges());bw.xyz=B(bw.xyz);bw=Q(bw);return bw};ae={};bp=500;aB=400;P={};j=L(v);al=L(v);U=800;A=5;bq=0;M=0.8;o=bp/2;ay=aB/2;w=new Date();q=true;aV="rgba(255,255,255,1.0)";an="signature";h="fillstroke";be=0.5;ao=false;X=0;W=0;aI=[1,0,0];a6=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aG=function(by,bw){var bz,bx;bz=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bx=new bz();bx.append(by);return saveAs(bx.getBlob("text/plain;charset="+document.characterSet),bw)};br=function(){var bw,bB,bA,bz,by,bx;bx={};bw=/\+/g;by=/([^&=]+)=?([^&]*)/g;bB=function(bC){return decodeURIComponent(bC.replace(bw," "))};bz=window.location.search.substring(1);while(bA=by.exec(bz)){bx[bB(bA[1])]=bB(bA[2])}return bx};ar=function(){var bw,bx;bx=$("#spec").val().split(/\s+/g).slice(0,2);bw=location.protocol+"//"+location.host+location.pathname;bw+="?recipe="+encodeURIComponent(bx[0]);if(a2!==aS){bw+="&palette="+encodeURIComponent(a2.reduce(function(by,bz){return by+" "+bz}))}return $("#link").attr("href",bw)};aM=function(){var bw,bx;bw=$("#poly");bw.width(bp);bw.height(aB);ae=bw[0].getContext("2d");ae.lineWidth=be;if(q){ae.clearRect(0,0,bp,aB)}else{ae.clearRect(0,0,bp,aB);ae.fillStyle=aV;ae.fillRect(0,0,bp,aB)}bx=$("#expandcollapse");return bx.click(function(){if(/minus/.test(bx.attr("src"))){$("#morestats").hide();return bx.attr("src","media/plus.png")}else{$("#morestats").show();return bx.attr("src","media/minus.png")}})};aO=function(){if(q){return ae.clearRect(0,0,bp,aB)}else{ae.clearRect(0,0,bp,aB);ae.fillStyle=aV;return ae.fillRect(0,0,bp,aB)}};R=function(bB,bO){var bw,bE,bC,bJ,bx,bM,bN,bD,bL,by,bA,bK,bI,bH,bz,bG,bF;bO||(bO=[3,3,3]);by=_.map(bB.xyz,function(bP){return bP});bB.xyz=_.map(bB.xyz,function(bP){return r(j,bP)});aT(bB);bA=bB.face;for(bJ=bM=0,bN=bA.length;bM<bN;bJ=++bM){bE=bA[bJ];ae.beginPath();bz=bE[bE.length-1];bK=x(z(bO,bB.xyz[bz]),A,bq,M,U),bG=bK[0],bF=bK[1];ae.moveTo(bG+o,bF+ay);for(bL=0,bD=bE.length;bL<bD;bL++){bH=bE[bL];bI=x(z(bO,bB.xyz[bH]),A,bq,M,U),bG=bI[0],bF=bI[1];ae.lineTo(bG+o,bF+ay)}bw=ag(bB.face_class[bJ]);bC=(function(){var bP,bR,bQ;bR=[];for(bQ=0,bP=bE.length;bQ<bP;bQ++){bH=bE[bQ];bR.push(bB.xyz[bH])}return bR})();bx=D(ak(bC),bo([1,-1,0]));bw=d((bx/2+0.5)*0.7+0.3,bw);if(h==="fill"||h==="fillstroke"){ae.fillStyle="rgba("+(Y(bw[0]*255))+", "+(Y(bw[1]*255))+", "+(Y(bw[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba("+(Y(bw[0]*255))+", "+(Y(bw[1]*255))+", "+(Y(bw[2]*255))+", "+1+")";ae.stroke()}if(h==="fillstroke"){ae.fillStyle="rgba("+(Y(bw[0]*255))+", "+(Y(bw[1]*255))+", "+(Y(bw[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba(0,0,0, .3)";ae.stroke()}if(h==="stroke"){ae.strokeStyle="rgba(0,0,0, .8)";ae.stroke()}}return bB.xyz=by};aD=function(){var bz,bx,bw,bA,by;aO();by=[];for(bz=bx=0,bw=P.length;bx<bw;bz=++bx){bA=P[bz];by.push(R(bA,[0+3*bz,0,3]))}return by};ax=function(){var bz,bx,bw,bA,by;by=[];for(bz=bx=0,bw=P.length;bx<bw;bz=++bx){bA=P[bz];$("#basicstats").text(bA.data());by.push($("#morestats").text(bA.moreData()))}return by};bi=function(){var by,bz,bx,bw,bA;aO();by=(2*Math.PI)/180*w.getSeconds()*0.1;for(bz=bx=0,bw=P.length;bx<bw;bz=++bx){bA=P[bz];R(bA,[0+3*bz,0,3])}return setTimeout(bi,100)};$(function(){var bx,bw;aM();bw=br();if("recipe" in bw){bx=[bw.recipe];$("#spec").val(bx)}else{bx=[bd(a6)];$("#spec").val(bx);ar()}if("palette" in bw){a2=bw.palette.split(/\s+/g);ar()}$("#palette").val(a2.reduce(function(by,bz){return by+" "+bz}));P=_.map(bx,function(by){return bt(by)});ax();aD();$("#spec").change(function(by){bx=$("#spec").val().split(/\s+/g).slice(0,2);P=_.map(bx,function(bz){return bt(bz)});ax();ar();return aD()});$("#palette").change(function(by){a2=$(this).val().split(/\s+/g);ar();return aD()});$("#poly").mousewheel(function(bA,bB,bz,by){bA.preventDefault();U*=(10+bB)/10;return aD()});$("#poly").mousedown(function(by){var bz;by.preventDefault();ao=true;X=by.clientX-$(this).offset().left;W=by.clientY-($(this).offset().top-$(window).scrollTop());bz=aN(X,W,o,ay,A,bq,M,U);if(bz[0]*bz[1]*bz[2]*0===0){aI=bz}return al=L(j)});$("#poly").mouseup(function(by){by.preventDefault();return ao=false});$("#poly").mouseleave(function(by){by.preventDefault();return ao=false});$("#poly").mousemove(function(bB){var bz,by,bA;bB.preventDefault();if(ao){bz=bB.clientX-$(this).offset().left;by=bB.clientY-($(this).offset().top-$(window).scrollTop());bA=aN(bz,by,o,ay,A,bq,M,U);if(bA[0]*bA[1]*bA[2]*0===0&&aI[0]*aI[1]*aI[2]*0===0){j=aH(aF(aI,bA),al)}return aD()}});$("#strokeonly").click(function(by){h="stroke";return aD()});$("#fillonly").click(function(by){h="fill";return aD()});$("#fillandstroke").click(function(by){h="fillstroke";return aD()});$("#siderot").click(function(by){j=aW(aL/2,0,1,0);return aD()});$("#toprot").click(function(by){j=aW(aL/2,1,0,0);return aD()});$("#frontrot").click(function(by){j=i(0,0,0);return aD()});$("#pngsavebutton").click(function(bB){var bA,bz,by;bA=$("#poly")[0];by=$("#spec").val().split(/\s+/g)[0];bz="polyhedronisme-"+by.replace(/\([^\)]+\)/g,"")+".png";return bA.toBlob(function(bC){return saveAs(bC,bz)})});$("#objsavebutton").click(function(bB){var bz,bA,by;bA=P[0].toOBJ();by=$("#spec").val().split(/\s+/g)[0];bz="polyhedronisme-"+by.replace(/\([^\)]+\)/g,"")+".obj";return aG(bA,bz)});return $("#x3dsavebutton").click(function(bB){var bz,by,bA,bC;bA=ab(P[0],true);bC=bA.toVRML();by=$("#spec").val().split(/\s+/g)[0];bz="polyhedronisme-"+by.replace(/\([^\)]+\)/g,"")+".wrl";return aG(bC,bz)})})}).call(this);