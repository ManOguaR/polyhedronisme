(function(){var r,aW,aC,bq,ao,a7,T,Y,X,aJ,ap,a3,aV,aM,h,ag,a5,A,z,aK,bj,a0,O,aB,bk,bo,g,o,bm,aP,M,bl,a8,J,aA,af,bf,ak,v,bw,ar,E,aE,S,aL,ax,ad,w,aD,bb,an,K,a4,aG,Q,k,am,x,a6,bv,i,ba,aN,F,G,aO,ae,aw,e,n,L,a9,aY,aI,d,s,bu,al,aq,av,bi,H,aZ,R,ah,bs,y,N,B,br,V,bg,aj,aS,bc,U,aa,t,bt,aQ,be,bd,aF,P,I,u,C,j,Z,aT,aH,at,au,a2,aU,aR,W,a1,bh,b,l,ab,D,f,ai,a,ac,m,bp,az,aX,c,bn,p,ay,q;aQ=Math.random;Z=Math.round;an=Math.floor;W=Math.sqrt;a2=Math.sin;J=Math.cos;b=Math.tan;O=Math.asin;a5=Math.acos;aB=Math.atan;bc=Math.pow;ag=Math.abs;aM=Math.PI;T=Math.LN10;e=Math.log;bc=Math.pow;n=function(bx){return e(bx)/T};au=function(bz,by){var bx;bx=bc(10,n(bz)-an(n(bz)));return""+(Z(bx*(by-1)))};M=function(bz){var by,bx;if((bz==null)||typeof bz!=="object"){return bz}bx=new bz.constructor();for(by in bz){bx[by]=M(bz[by])}return bx};be=function(by){var bx;bx=an(aQ()*by.length);return by[bx]};d=function(by,bx){return[by*bx[0],by*bx[1],by*bx[2]]};q=function(by,bx){return[by[0]*bx[0],by[1]*bx[1],by[2]*bx[2]]};A=function(by,bx){return[by[0]+bx[0],by[1]+bx[1],by[2]+bx[2]]};bh=function(by,bx){return[by[0]-bx[0],by[1]-bx[1],by[2]-bx[2]]};E=function(by,bx){return by[0]*bx[0]+by[1]*bx[1]+by[2]*bx[2]};aA=function(by,bx){return[by[1]*bx[2]-by[2]*bx[1],by[2]*bx[0]-by[0]*bx[2],by[0]*bx[1]-by[1]*bx[0]]};L=function(bx){return W(E(bx,bx))};a9=function(bx){return E(bx,bx)};bp=function(bx){return d(1/W(a9(bx)),bx)};aY=function(by,bx){return d(1/2,A(by,bx))};m=function(bz,by,bx){return[(1-bx)*bz[0]+bx*by[0],(1-bx)*bz[1]+bx*by[1],(1-bx)*bz[2]+bx*by[2]]};av=function(by,bx){return m(by,bx,1/3)};aF=function(bx){return d(1/a9(bx),bx)};l=function(bz,by){var bx;bx=bh(by,bz);return bh(bz,d(E(bx,bz)/a9(bx),bx))};ax=function(by,bx){return W(a9(l(by,bx)))};aw=function(bE,bD,bB){var bC,bz,by,bx,bA;bz=bh(bD,bE);bC=bh(bE,bB);by=a9(bz);bA=-E(bC,bz)/by;if(bA<=0){return a9(bC)}else{if(bA>=1){bx=a9(bh(bD,bB))}}bx=a9(aA(bz,bC))/by;return bx};aZ=function(bB,bA,bz){var by,bx;by=bh(bA,bB);bx=bh(bz,bA);return aA(by,bx)};G=function(bE,bD,bC){var bI,bH,bG,bB,bA,bz,bF,by,bx;for(bB=0,bF=bE.length;bB<bF;bB++){bI=bE[bB];for(bA=0,by=bD.length;bA<by;bA++){bH=bD[bA];if(bI===bH){for(bz=0,bx=bC.length;bz<bx;bz++){bG=bC[bz];if(bI===bG){return bI}}}}}return null};bo=function(bB){var bz,by,bA,bx;bz=[0,0,0];for(bA=0,bx=bB.length;bA<bx;bA++){by=bB[bA];bz=A(bz,by)}return d(1/bB.length,bz)};al=function(bB){var bx,bF,bD,bC,bz,bE,bA,by;bx=[0,0,0];bA=bB.slice(-2),bF=bA[0],bD=bA[1];for(bz=0,bE=bB.length;bz<bE;bz++){bC=bB[bz];bx=A(bx,aZ(bF,bD,bC));by=[bD,bC],bF=by[0],bD=by[1]}return bp(bx)};bl=function(bB){var bx,bF,bD,bC,bz,bE,bA,by;bx=0;bA=bB.slice(0,2),bF=bA[0],bD=bA[1];by=bB.slice(2);for(bz=0,bE=by.length;bz<bE;bz++){bC=by[bz];bx+=L(aA(bh(bD,bF),bh(bC,bF)));bD=bC}return bx};aD=function(bG){var bF,bM,bL,bJ,bH,bK,bD,bC,bA,bI,by,bx,bE,bB,bz;bF=[];bE=bG.slice(0,2),bL=bE[0],bJ=bE[1];bB=bG.slice(2);for(bD=0,bI=bB.length;bD<bI;bD++){bH=bB[bD];bF.push(L(aA(bh(bJ,bL),bh(bH,bL))));bJ=bH}bF.sort(function(bO,bN){return bO-bN});bM="";for(bC=0,by=bF.length;bC<by;bC++){bK=bF[bC];bM+=au(bK,2)}bz=bF.reverse();for(bA=0,bx=bz.length;bA<bx;bA++){bK=bz[bA];bM+=au(bK,2)}return bM};aa=function(bE){var bC,by,bx,bB,bF,bG,bA,bD,bz;bB=M(bE);bG=bE[0];bB=_.map(bB,function(bH){return bH-bG});by=al(bE);bC=bp(bo(bE));bx=aA(by,bC);bz=[];for(bA=0,bD=bB.length;bA<bD;bA++){bF=bB[bA];bz.push([E(by,bF),E(bx,bF)])}return bz};a8=function(bz){var by,bx,bB,bA;bx=new Array(bz.length);for(by=bB=0,bA=bz.length;0<=bA?bB<bA:bB>bA;by=0<=bA?++bB:--bB){bx[by]=bz[by].slice(0)}return bx};s=function(by,bx){return[by[0][0]*bx[0]+by[0][1]*bx[1]+by[0][2]*bx[2],by[1][0]*bx[0]+by[1][1]*bx[1]+by[1][2]*bx[2],by[2][0]*bx[0]+by[2][1]*bx[1]+by[2][2]*bx[2]]};aI=function(bx,by){return[[bx[0][0]*by[0][0]+bx[0][1]*by[1][0]+bx[0][2]*by[2][0],bx[0][0]*by[0][1]+bx[0][1]*by[1][1]+bx[0][2]*by[2][1],bx[0][0]*by[0][2]+bx[0][1]*by[1][2]+bx[0][2]*by[2][2]],[bx[1][0]*by[0][0]+bx[1][1]*by[1][0]+bx[1][2]*by[2][0],bx[1][0]*by[0][1]+bx[1][1]*by[1][1]+bx[1][2]*by[2][1],bx[1][0]*by[0][2]+bx[1][1]*by[1][2]+bx[1][2]*by[2][2]],[bx[2][0]*by[0][0]+bx[2][1]*by[1][0]+bx[2][2]*by[2][0],bx[2][0]*by[0][1]+bx[2][1]*by[1][1]+bx[2][2]*by[2][1],bx[2][0]*by[0][2]+bx[2][1]*by[1][2]+bx[2][2]*by[2][2]]]};w=[[1,0,0],[0,1,0],[0,0,1]];j=function(bB,bz,bA){var bC,by,bx;bC=[[J(bB),-1*a2(bB),0],[a2(bB),J(bB),0],[0,0,1]];bx=[[J(bz),0,-1*a2(bz)],[0,1,0],[a2(bz),0,J(bz)]];by=[[1,0,0],[0,J(bA),-1*a2(bA)],[0,a2(bA),J(bA)]];return aI(by,aI(bx,bC))};aX=function(bA,bK,bI,bF){var bE,by,bz,bJ,bH,bx,bG,bC,bD,bB;bA/=2;bJ=a2(bA);bE=J(bA);bH=bJ*bJ;by=L([bK,bI,bF]);if(by===0){bD=[0,0,1],bK=bD[0],bI=bD[1],bF=bD[2]}if(by!==1){bB=bp([bK,bI,bF]),bK=bB[0],bI=bB[1],bF=bB[2]}if(bK===1&&bI===0&&bF===0){bz=[[1,0,0],[0,1-2*bH,2*bJ*bE],[0,-2*bJ*bE,1-2*bH]]}else{if(bK===0&&bI===1&&bF===0){bz=[[1-2*bH,0,-2*bJ*bE],[0,1,0],[2*bJ*bE,0,1-2*bH]]}else{if(bK===0&&bI===0&&bF===1){bz=[[1-2*bH,2*bJ*bE,0],[-2*bJ*bE,1-2*bH,0],[0,0,1]]}else{bx=bK*bK;bG=bI*bI;bC=bF*bF;bz=[[1-2*(bG+bC)*bH,2*(bK*bI*bH+bF*bJ*bE),2*(bK*bF*bH-bI*bJ*bE)],[2*(bI*bK*bH-bF*bJ*bE),1-2*(bC+bx)*bH,2*(bI*bF*bH+bK*bJ*bE)],[2*(bF*bK*bH+bI*bJ*bE),2*(bF*bI*bH-bK*bJ*bE),1-2*(bx+bG)*bH]]}}}return bz};y=function(bz,by,bA,bD,bx){var bB,bC;bC=(by*bD-bA)/(1-bD);bB=bx*bD/(1-bD);return[bB*bz[0]/(bz[2]+bC),bB*bz[1]/(bz[2]+bC)]};aO=function(bE,bB,bH,bF,bL,bA,bz,by){var bK,bx,bG,bC,bI,bN,bP,bD,bJ,bM,bO;bJ=(bL*bz-bA)/(1-bz);bK=by*bz/(1-bz);bG=bE-bH;bN=bB-bF;bx=bK*bK;bM=bJ*bJ;bC=bG*bG;bP=bN*bN;bI=(2*bK*bG*bJ+W(4*bx*bC*bM+4*bC*(bx+bC+bP)*(1-bM)))/(2*(bx+bC+bP));bD=(bK*bN*bJ)/(bx+bC+bP)+(bN*W(4*bx*bM+4*(bx+bC+bP)*(1-bM)))/(2*(bx+bC+bP));bO=W(1-bI*bI-bD*bD);return[bI,bD,bO]};aG=function(bz,by){var bA,bx;bx=aA(bz,by);bA=a5(E(bz,by));return aX(-1*bA,bx[0],bx[1],bx[2])};bb=function(bA){var by,bC,bB,bz,bx;by=[];bC=bA.slice(-1)[0];for(bz=0,bx=bA.length;bz<bx;bz++){bB=bA[bz];by.push([bC,bB]);bC=bB}return by};c=function(bx){var bD,bC,bG,bE,bA,bz,bF,by,bB;bE=[];bB=bx.face;for(bC=bA=0,bF=bB.length;bA<bF;bC=++bA){bD=bB[bC];for(bz=0,by=bD.length;bz<by;bz++){bG=bD[bz];bE[bG]=bx.face_class[bC]}}return bE};aT=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];bv=function(by){var bx;if(by[0]==="#"){by=by.slice(1)}if(by.length===3){bx=by.split("").map(function(bz){return parseInt(bz+bz,16)/255})}else{bx=by.match(/.{2}/g).map(function(bz){return parseInt(bz,16)/255})}return bx};a3=aT;ah=function(bx){if(bx<a3.length){return bv(a3[bx])}else{return bv(a3[a3.length-1])}};R=function(bx){var bG,by,bC,bB,bE,bF,bz,bD,bA;bx.face_class=[];bC={};by=function(bH,bK){var bI,bJ;bJ=Z(100*bH);if(bJ in bK){return bK[bJ]}else{bI=_.toArray(bK).length;bK[bJ]=bI;return bI}};bA=bx.face;for(bz=0,bD=bA.length;bz<bD;bz++){bB=bA[bz];if(ao==="area"){bE=(function(){var bJ,bI,bH;bH=[];for(bJ=0,bI=bB.length;bJ<bI;bJ++){bF=bB[bJ];bH.push(bx.xyz[bF])}return bH})();bG=by(bl(bE),bC)}else{if(ao==="signature"){bE=(function(){var bJ,bI,bH;bH=[];for(bJ=0,bI=bB.length;bJ<bI;bJ++){bF=bB[bJ];bH.push(bx.xyz[bF])}return bH})();bG=by(aD(bE),bC)}else{bG=bB.length-3}}bx.face_class.push(bG)}console.log(_.toArray(bC).length+" face classes");return bx};aU=function(bx){var by,bG,bF,bH,bB,bz,bE,bC,bD,bA;by=bx.centers();bF=bx.normals();bB=[0,0,(B*N-br)/(1-N)];bH=function(bJ,bI){return -E(bh(bB,bJ[0]),bJ[1])*E(bh(bI[0],bJ[0]),bJ[1])};bz=function(bJ,bI){return bJ[0][2]-bI[0][2]};bE=_.zip(by,bF,(function(){bA=[];for(var bJ=0,bI=bx.face.length;0<=bI?bJ<bI:bJ>bI;0<=bI?bJ++:bJ--){bA.push(bJ)}return bA}).apply(this)).sort(bz).map(function(bI){return bI[2]});bx.face=(function(){var bK,bI,bJ;bJ=[];for(bK=0,bI=bE.length;bK<bI;bK++){bG=bE[bK];bJ.push(bx.face[bG])}return bJ})();return bx.face_class=(function(){var bK,bI,bJ;bJ=[];for(bK=0,bI=bE.length;bK<bI;bK++){bG=bE[bK];bJ.push(bx.face_class[bG])}return bJ})()};aS=(function(){function bx(bA,by,bz){this.face=by||new Array();this.xyz=bA||new Array();this.name=bz||"null polyhedron"}bx.prototype.data=function(){var by;by=this.face.length+this.xyz.length-2;return""+this.face.length+" faces, "+by+" edges, "+this.xyz.length+" vertices"};bx.prototype.moreData=function(){return"min. edge length "+(this.minEdgeLength().toPrecision(2))+"; min. face radius "+(this.minFaceRadius().toPrecision(2))};bx.prototype.edges=function(){var bI,bE,bG,bF,by,bD,bC,bJ,bB,bA,bH,bz;bD={};bJ=[];bE=_.map(this.face,bb);for(bB=0,bH=bE.length;bB<bH;bB++){by=bE[bB];for(bA=0,bz=by.length;bA<bz;bA++){bF=by[bA];if(bF[0]<bF[1]){bI=bF[0],bG=bF[1]}else{bG=bF[0],bI=bF[1]}bD[bI+"~"+bG]=bF}}for(bC in bD){bF=bD[bC];bJ.push(bF)}return bJ};bx.prototype.minEdgeLength=function(){var bA,bD,bz,bC,by,bB;bz=Number.MAX_VALUE;bB=this.edges();for(bC=0,by=bB.length;bC<by;bC++){bD=bB[bC];bA=a9(bh(this.xyz[bD[0]],this.xyz[bD[1]]));if(bA<bz){bz=bA}}return W(bz)};bx.prototype.minFaceRadius=function(){var bF,by,bC,bE,bD,bI,bG,bA,bz,bH,bB;bI=Number.MAX_VALUE;bG=this.face.length;by=this.centers();for(bD=bA=0;0<=bG?bA<bG:bA>bG;bD=0<=bG?++bA:--bA){bF=by[bD];bB=bb(this.face[bD]);for(bz=0,bH=bB.length;bz<bH;bz++){bE=bB[bz];bC=aw(this.xyz[bE[0]],this.xyz[bE[1]],bF);if(bC<bI){bI=bC}}}return W(bI)};bx.prototype.centers=function(){var bD,bE,bA,bG,bB,bz,bF,by,bC;bD=[];bC=this.face;for(bB=0,bF=bC.length;bB<bF;bB++){bE=bC[bB];bA=[0,0,0];for(bz=0,by=bE.length;bz<by;bz++){bG=bE[bz];bA=A(bA,this.xyz[bG])}bD.push(d(1/bE.length,bA))}return bD};bx.prototype.normals=function(){var bC,bD,bz,bB,by,bA;bD=[];bA=this.face;for(bB=0,by=bA.length;bB<by;bB++){bC=bA[bB];bD.push(al((function(){var bG,bF,bE;bE=[];for(bG=0,bF=bC.length;bG<bF;bG++){bz=bC[bG];bE.push(this.xyz[bz])}return bE}).call(this)))}return bD};bx.prototype.toOBJ=function(){var bK,bJ,bz,bL,bN,bH,bG,bE,bC,bM,bB,bA,by,bI,bF,bD;bL="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bL+="group "+this.name+"\n";bL+="#vertices\n";bI=this.xyz;for(bH=0,bM=bI.length;bH<bM;bH++){bN=bI[bH];bL+="v "+bN[0]+" "+bN[1]+" "+bN[2]+"\n"}bL+="#normal vector defs \n";bF=this.face;for(bG=0,bB=bF.length;bG<bB;bG++){bK=bF[bG];bz=al((function(){var bQ,bO,bP;bP=[];for(bQ=0,bO=bK.length;bQ<bO;bQ++){bN=bK[bQ];bP.push(this.xyz[bN])}return bP}).call(this));bL+="vn "+bz[0]+" "+bz[1]+" "+bz[2]+"\n"}bL+="#face defs \n";bD=this.face;for(bJ=bE=0,bA=bD.length;bE<bA;bJ=++bE){bK=bD[bJ];bL+="f ";for(bC=0,by=bK.length;bC<by;bC++){bN=bK[bC];bL+=""+(bN+1)+"//"+(bJ+1)+" "}bL+="\n"}return bL};bx.prototype.toX3D=function(){var bC,bM,bO,bJ,bL,bN,bH,bG,bE,bB,bK,bA,bz,by,bI,bF,bD;bC=0.01;bN='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bI=this.face;for(bH=0,bK=bI.length;bH<bK;bH++){bJ=bI[bH];for(bG=0,bA=bJ.length;bG<bA;bG++){bL=bJ[bG];bN+=""+bL+" "}bN+="-1\n"}bN+='">\n';bN+='<Color color="';bF=c(this);for(bE=0,bz=bF.length;bE<bz;bE++){bM=bF[bE];bO=ah(bM);bN+=""+bO[0]+" "+bO[1]+" "+bO[2]+" "}bN+='"/>';bN+='<Coordinate point="';bD=this.xyz;for(bB=0,by=bD.length;bB<by;bB++){bL=bD[bB];bN+=""+(bL[0]*bC)+" "+(bL[1]*bC)+" "+(bL[2]*bC)+" "}bN+='"/>\n';bN+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bN};bx.prototype.toVRML=function(){var bC,bM,bO,bJ,bL,bN,bH,bG,bE,bB,bK,bA,bz,by,bI,bF,bD;bC=0.01;bN='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bI=this.xyz;for(bH=0,bK=bI.length;bH<bK;bH++){bL=bI[bH];bN+=""+(bL[0]*bC)+" "+(bL[1]*bC)+" "+(bL[2]*bC)+","}bN=bN.slice(0,-1);bN+="    ]\n}\ncolor Color\n{\n  color\n  [";bF=this.face_class;for(bG=0,bA=bF.length;bG<bA;bG++){bM=bF[bG];bO=ah(bM);bN+=""+bO[0]+" "+bO[1]+" "+bO[2]+" ,"}bN=bN.slice(0,-1);bN+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bD=this.face;for(bE=0,bz=bD.length;bE<bz;bE++){bJ=bD[bE];for(bB=0,by=bJ.length;bB<by;bB++){bL=bJ[bB];bN+=""+bL+", "}bN+="-1,"}bN=bN.slice(0,-1);bN+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bN};return bx})();f=function(){var bx;bx=new aS();bx.name="T";bx.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bx.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bx};aq=function(){var bx;bx=new aS();bx.name="O";bx.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bx.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bx};ak=function(){var bx;bx=new aS();bx.name="C";bx.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bx.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bx};ba=function(){var bx;bx=new aS();bx.name="I";bx.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bx.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bx};ar=function(){var bx;bx=new aS();bx.name="D";bx.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bx.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bx};U=function(bA){var bK,bJ,bx,by,bH,bG,bC,bB,bz,bI,bF,bE,bD;by=2*aM/bA;bK=Math.sin(by/2);bx=new aS();bx.name="P"+bA;for(bJ=bH=0;0<=bA?bH<bA:bH>bA;bJ=0<=bA?++bH:--bH){bx.xyz.push([-J(bJ*by),-a2(bJ*by),-bK])}for(bJ=bG=0;0<=bA?bG<bA:bG>bA;bJ=0<=bA?++bG:--bG){bx.xyz.push([-J(bJ*by),-a2(bJ*by),bK])}bx.face.push((function(){bE=[];for(var bL=bI=bA-1;bI<=0?bL<=0:bL>=0;bI<=0?bL++:bL--){bE.push(bL)}return bE}).apply(this));bx.face.push((function(){bD=[];for(var bM=bA,bL=2*bA;bA<=bL?bM<bL:bM>bL;bA<=bL?bM++:bM--){bD.push(bM)}return bD}).apply(this));for(bJ=bz=0;0<=bA?bz<bA:bz>bA;bJ=0<=bA?++bz:--bz){bx.face.push([bJ,(bJ+1)%bA,(bJ+1)%bA+bA,bJ+bA])}bx=z(bx,1);return bx};a0=function(bB){var bN,bM,bL,by,bx,bz,bJ,bI,bE,bC,bA,bK,bH,bD,bG,bF;bz=2*aM/bB;bM=W(1-4/(4+2*J(bz/2)-2*J(bz)));bx=W(1-bM*bM);bN=W(bM*bM+bc(bx*J(bz/2),2));bx=-bx/bN;bM=-bM/bN;by=new aS();by.name="A"+bB;for(bL=bJ=0;0<=bB?bJ<bB:bJ>bB;bL=0<=bB?++bJ:--bJ){by.xyz.push([bx*J(bL*bz),bx*a2(bL*bz),bM])}for(bL=bI=0;0<=bB?bI<bB:bI>bB;bL=0<=bB?++bI:--bI){by.xyz.push([bx*J((bL+0.5)*bz),bx*a2((bL+0.5)*bz),-bM])}by.face.push((function(){bG=[];for(var bO=bK=bB-1;bK<=0?bO<=0:bO>=0;bK<=0?bO++:bO--){bG.push(bO)}return bG}).apply(this));by.face.push((function(){bF=[];for(var bP=bB,bO=2*bB-1;bB<=bO?bP<=bO:bP>=bO;bB<=bO?bP++:bP--){bF.push(bP)}return bF}).apply(this));for(bL=bA=0,bD=bB-1;0<=bD?bA<=bD:bA>=bD;bL=0<=bD?++bA:--bA){by.face.push([bL,(bL+1)%bB,bL+bB]);by.face.push([bL,bL+bB,(bB+bL-1)%bB+bB])}by=z(by,1);return by};bt=function(bz){var bG,bF,bx,by,bD,bC,bA,bE,bB;by=2*aM/bz;bG=1;bx=new aS();bx.name="Y"+bz;for(bF=bD=0;0<=bz?bD<bz:bD>bz;bF=0<=bz?++bD:--bD){bx.xyz.push([-J(bF*by),-a2(bF*by),-0.2])}bx.xyz.push([0,0,bG]);bx.face.push((function(){bB=[];for(var bH=bE=bz-1;bE<=0?bH<=0:bH>=0;bE<=0?bH++:bH--){bB.push(bH)}return bB}).apply(this));for(bF=bA=0;0<=bz?bA<bz:bA>bz;bF=0<=bz?++bA:--bA){bx.face.push([bF,(bF+1)%bz,bz])}bx=g(bx,3);return bx};aj=(function(){function bx(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bx.prototype.newV=function(bz,by){if(this.verts[bz]===void 0){this.verts[bz]=0;return this.xyzs[bz]=by}};bx.prototype.newFlag=function(by,bA,bz){if(this.flags[by]===void 0){this.flags[by]={}}return this.flags[by][bA]=bz};bx.prototype.topoly=function(){var bz,bE,bH,bD,bB,by,bF,bG,bC,bA;by=new aS();bz=0;bC=this.verts;for(bD in bC){bF=bC[bD];by.xyz[bz]=this.xyzs[bD];this.verts[bD]=bz;bz++}bz=0;bA=this.flags;for(bD in bA){bE=bA[bD];by.face[bz]=[];for(bB in bE){bF=bE[bB];bG=bF;break}bF=bG;by.face[bz].push(this.verts[bF]);bF=this.flags[bD][bF];bH=0;while(bF!==bG){by.face[bz].push(this.verts[bF]);bF=this.flags[bD][bF];bH++;if(bH>1000){console.log("Bad flag spec, have a neverending face:",bD,this.flags[bD]);break}}bz++}by.name="unknown polyhedron";return by};return bx})();ae=function(bG,bM,bF){var bE,bQ,bP,bN,bS,bD,bO,bI,bK,bL,bJ,bB,bz,bA,by,bx,bR,bU,bT,bH,bC;bM||(bM=0);bF||(bF=0.1);console.log("Taking kis of "+(bM===0?"":bM)+"-sided faces of "+bG.name+"...");bN=new aj();bH=bG.xyz;for(bO=bA=0,bR=bH.length;bA<bR;bO=++bA){bL=bH[bO];bN.newV("v"+bO,bL)}bK=bG.normals();bQ=bG.centers();bD=false;bC=bG.face;for(bO=by=0,bU=bC.length;by<bU;bO=++by){bP=bC[bO];bB="v"+bP[bP.length-1];for(bx=0,bT=bP.length;bx<bT;bx++){bJ=bP[bx];bz="v"+bJ;if(bP.length===bM||bM===0){bD=true;bE="apex"+bO;bS=""+bO+bB;bN.newV(bE,A(bQ[bO],d(bF,bK[bO])));bN.newFlag(bS,bB,bz);bN.newFlag(bS,bz,bE);bN.newFlag(bS,bE,bB)}else{bN.newFlag(""+bO,bB,bz)}bB=bz}}if(!bD){console.log("No "+bM+"-fold components were found.")}bI=bN.topoly();bI.name="k"+(bM===0?"":bM)+bG.name;return bI};aK=function(bx){var bH,bI,bG,by,bB,bM,bL,bJ,bE,bD,bK,bz,bF,bC,bA;console.log("Taking ambo of "+bx.name+"...");by=function(bO,bN){if(bO<bN){return bO+"_"+bN}else{return bN+"_"+bO}};bI=new aj();bF=bx.face;for(bG=bE=0,bK=bF.length;bE<bK;bG=++bE){bH=bF[bG];bC=bH.slice(-2),bM=bC[0],bL=bC[1];for(bD=0,bz=bH.length;bD<bz;bD++){bJ=bH[bD];if(bM<bL){bI.newV(by(bM,bL),aY(bx.xyz[bM],bx.xyz[bL]))}bI.newFlag("orig"+bG,by(bM,bL),by(bL,bJ));bI.newFlag("dual"+bL,by(bL,bJ),by(bM,bL));bA=[bL,bJ],bM=bA[0],bL=bA[1]}}bB=bI.topoly();bB.name="a"+bx.name;return bB};a6=function(bI){var bQ,bP,bN,bT,bO,bM,bK,bL,bG,bD,bA,bE,bB,by,bx,bS,bV,bU,bR,bJ,bH,bF,bC,bz;console.log("Taking gyro of "+bI.name+"...");bN=new aj();bJ=bI.xyz;for(bO=bE=0,bS=bJ.length;bE<bS;bO=++bE){bL=bJ[bO];bN.newV("v"+bO,bp(bL))}bQ=bI.centers();bH=bI.face;for(bO=bB=0,bV=bH.length;bB<bV;bO=++bB){bP=bH[bO];bN.newV("center"+bO,bp(bQ[bO]))}bF=bI.face;for(bO=by=0,bU=bF.length;by<bU;bO=++by){bP=bF[bO];bC=bP.slice(-2),bG=bC[0],bD=bC[1];for(bM=bx=0,bR=bP.length;bx<bR;bM=++bx){bL=bP[bM];bA=bL;bN.newV(bG+"~"+bD,av(bI.xyz[bG],bI.xyz[bD]));bT=bO+"f"+bG;bN.newFlag(bT,"center"+bO,bG+"~"+bD);bN.newFlag(bT,bG+"~"+bD,bD+"~"+bG);bN.newFlag(bT,bD+"~"+bG,"v"+bD);bN.newFlag(bT,"v"+bD,bD+"~"+bA);bN.newFlag(bT,bD+"~"+bA,"center"+bO);bz=[bD,bA],bG=bz[0],bD=bz[1]}}bK=bN.topoly();bK.name="g"+bI.name;return bK};t=function(bG){var bM,bK,bO,bL,bI,bJ,bE,bB,by,bC,bz,bx,bN,bQ,bP,bH,bF,bD,bA;console.log("Taking propellor of "+bG.name+"...");bK=new aj();bH=bG.xyz;for(bL=bC=0,bN=bH.length;bC<bN;bL=++bC){bJ=bH[bL];bK.newV("v"+bL,bp(bJ))}bF=bG.face;for(bL=bz=0,bQ=bF.length;bz<bQ;bL=++bz){bM=bF[bL];bD=bM.slice(-2),bE=bD[0],bB=bD[1];for(bx=0,bP=bM.length;bx<bP;bx++){bJ=bM[bx];by=""+bJ;bK.newV(bE+"~"+bB,av(bG.xyz[bE],bG.xyz[bB]));bO=""+bL+"f"+bB;bK.newFlag("v"+bL,bE+"~"+bB,bB+"~"+by);bK.newFlag(bO,bE+"~"+bB,bB+"~"+bE);bK.newFlag(bO,bB+"~"+bE,"v"+bB);bK.newFlag(bO,"v"+bB,bB+"~"+by);bK.newFlag(bO,bB+"~"+by,bE+"~"+bB);bA=[bB,by],bE=bA[0],bB=bA[1]}}bI=bK.topoly();bI.name="p"+bG.name;return bI};u=function(bC){var by,bB,bz,bA,bx;console.log("Taking reflection of "+bC.name+"...");for(by=bB=0,bA=bC.xyz.length-1;0<=bA?bB<=bA:bB>=bA;by=0<=bA?++bB:--bB){bC.xyz[by]=d(-1,bC.xyz[by])}for(by=bz=0,bx=bC.face.length-1;0<=bx?bz<=bx:bz>=bx;by=0<=bx?++bz:--bz){bC.face[by]=bC.face[by].reverse()}bC.name="r"+bC.name;return bC};aL=function(bI){var bQ,bW,bP,bJ,bN,bO,bM,bL,bG,bD,bE,bB,bz,by,bT,bX,bU,bS,bR,bx,bY,bV,bK,bH,bF,bC,bA;console.log("Taking dual of "+bI.name+"...");bN=new aj();bJ=[];for(bO=bE=0,bK=bI.xyz.length-1;0<=bK?bE<=bK:bE>=bK;bO=0<=bK?++bE:--bE){bJ[bO]={}}bH=bI.face;for(bO=bB=0,bT=bH.length;bB<bT;bO=++bB){bP=bH[bO];bG=bP[bP.length-1];for(bz=0,bX=bP.length;bz<bX;bz++){bD=bP[bz];bJ[bG]["v"+bD]=""+bO;bG=bD}}bQ=bI.centers();for(bO=by=0,bF=bI.face.length-1;0<=bF?by<=bF:by>=bF;bO=0<=bF?++by:--by){bN.newV(""+bO,bQ[bO])}bC=bI.face;for(bO=bx=0,bU=bC.length;bx<bU;bO=++bx){bP=bC[bO];bG=bP[bP.length-1];for(bY=0,bS=bP.length;bY<bS;bY++){bD=bP[bY];bN.newFlag(bG,bJ[bD]["v"+bG],""+bO);bG=bD}}bW=bN.topoly();bL=[];bA=bW.face;for(bV=0,bR=bA.length;bV<bR;bV++){bP=bA[bV];bM=G(bI.face[bP[0]],bI.face[bP[1]],bI.face[bP[2]]);bL[bM]=bP}bW.face=bL;if(bI.name[0]!=="d"){bW.name="d"+bI.name}else{bW.name=bI.name.slice(1)}return bW};bm=function(bB,bH){var bL,bF,bI,bC,bJ,bE,bG,bA,bK,by,bN,bz,bx,bM,bO,bD;bH||(bH=0.5);bI=new aj();bG=bB.normals();bC=function(bQ,bP){if(bQ<bP){return"hex"+bQ+"_"+bP}else{return"hex"+bP+"_"+bQ}};bD=bB.face;for(bJ=bz=0,bM=bD.length;bz<bM;bJ=++bz){bL=bD[bJ];bA=bL[bL.length-1];bK=bJ+"_"+bA;for(bx=0,bO=bL.length;bx<bO;bx++){by=bL[bx];bI.newV(by,d(1+bH,bB.xyz[by]));bN=bJ+"_"+by;bI.newV(bN,A(bB.xyz[by],d(bH*1.5,bG[bJ])));bI.newFlag("orig"+bJ,bK,bN);bF=(bA<by?"hex"+bA+"_"+by:"hex"+by+"_"+bA);bI.newFlag(bF,by,bN);bI.newFlag(bF,bN,bK);bI.newFlag(bF,bK,bA);bA=by;bK=bN}}bE=bI.topoly();bE.name="c"+bB.name;return bE};bn=function(bx){return bx};F=function(bH,bO,bI,bP){var bT,bS,bQ,bX,bG,bR,bK,bM,bN,bL,bE,bB,bC,bA,bz,by,bW,bZ,bY,bV,bU,bx,bJ,bF,bD;bO||(bO=0);bI||(bI=0.5);bP||(bP=-0.2);console.log("Taking inset of "+(bO===0?"":bO)+"-sided faces of "+bH.name+"...");bQ=new aj();bJ=bH.xyz;for(bR=bC=0,bW=bJ.length;bC<bW;bR=++bC){bN=bJ[bR];bQ.newV("v"+bR,bN)}bM=bH.normals();bT=bH.centers();bF=bH.face;for(bR=bA=0,bZ=bF.length;bA<bZ;bR=++bA){bS=bF[bR];if(bS.length===bO||bO===0){for(bz=0,bY=bS.length;bz<bY;bz++){bL=bS[bz];bQ.newV("f"+bR+"v"+bL,A(m(bH.xyz[bL],bT[bR],bI),d(bP,bM[bR])))}}}bG=false;bD=bH.face;for(bR=by=0,bV=bD.length;by<bV;bR=++by){bS=bD[bR];bE="v"+bS[bS.length-1];for(bx=0,bU=bS.length;bx<bU;bx++){bL=bS[bx];bB="v"+bL;if(bS.length===bO||bO===0){bG=true;bX=bR+bE;bQ.newFlag(bX,bE,bB);bQ.newFlag(bX,bB,"f"+bR+bB);bQ.newFlag(bX,"f"+bR+bB,"f"+bR+bE);bQ.newFlag(bX,"f"+bR+bE,bE);bQ.newFlag("ex"+bR,"f"+bR+bE,"f"+bR+bB)}else{bQ.newFlag(bR,bE,bB)}bE=bB}}if(!bG){console.log("No "+bO+"-fold components were found.")}bK=bQ.topoly();bK.name="n"+(bO===0?"":bO)+bH.name;return bK};ad=function(bH,bN){var bR,bQ,bO,bG,bP,bJ,bL,bM,bK,bE,bB,bC,bA,bz,by,bU,bW,bV,bT,bS,bx,bI,bF,bD;bN||(bN=0);console.log("Taking extrusion of "+(bN===0?"":bN)+"-sided faces of "+bH.name+"...");bO=new aj();bI=bH.xyz;for(bP=bC=0,bU=bI.length;bC<bU;bP=++bC){bM=bI[bP];bO.newV("v"+bP,bM)}bL=bH.normals();bR=bH.centers();bF=bH.face;for(bP=bA=0,bW=bF.length;bA<bW;bP=++bA){bQ=bF[bP];if(bQ.length===bN||bN===0){for(bz=0,bV=bQ.length;bz<bV;bz++){bK=bQ[bz];bO.newV("f"+bP+"v"+bK,A(bH.xyz[bK],d(0.3,bL[bP])))}}}bG=false;bD=bH.face;for(bP=by=0,bT=bD.length;by<bT;bP=++by){bQ=bD[bP];bE="v"+bQ[bQ.length-1];for(bx=0,bS=bQ.length;bx<bS;bx++){bK=bQ[bx];bB="v"+bK;if(bQ.length===bN||bN===0){bG=true;bO.newFlag(bP+bE,bE,bB);bO.newFlag(bP+bE,bB,"f"+bP+bB);bO.newFlag(bP+bE,"f"+bP+bB,"f"+bP+bE);bO.newFlag(bP+bE,"f"+bP+bE,bE);bO.newFlag("ex"+bP,"f"+bP+bE,"f"+bP+bB)}else{bO.newFlag(bP,bE,bB)}bE=bB}}if(!bG){console.log("No "+bN+"-fold components were found.")}bJ=bO.topoly();bJ.name="x"+(bN===0?"":bN)+bH.name;return bJ};i=function(bI,bP,bJ,by){var bU,bS,bT,bQ,bY,bH,bR,bL,bN,bO,bM,bF,bD,bC,bB,bA,bz,bX,b0,bZ,bW,bV,bx,bK,bG,bE;bP||(bP=0);bJ||(bJ=0.5);by||(by=0.2);console.log("Skeletonizing "+(bP===0?"":bP)+"-sided faces of "+bI.name+"...");bS=aL(bI).normals();bN=bI.normals();bU=bI.centers();bQ=new aj();bK=bI.xyz;for(bR=bC=0,bX=bK.length;bC<bX;bR=++bC){bO=bK[bR];bQ.newV("v"+bR,bO);bQ.newV("downv"+bR,A(bO,d(-1*by,bS[bR])))}bG=bI.face;for(bR=bB=0,b0=bG.length;bB<b0;bR=++bB){bT=bG[bR];for(bA=0,bZ=bT.length;bA<bZ;bA++){bM=bT[bA];bQ.newV("fin"+bR+"v"+bM,m(bI.xyz[bM],bU[bR],bJ));bQ.newV("findown"+bR+"v"+bM,A(m(bI.xyz[bM],bU[bR],bJ),d(-1*by,bN[bR])))}}bE=bI.face;for(bR=bz=0,bW=bE.length;bz<bW;bR=++bz){bT=bE[bR];bF="v"+bT[bT.length-1];for(bx=0,bV=bT.length;bx<bV;bx++){bM=bT[bx];bD="v"+bM;bH=true;bY=bR+bF;bQ.newFlag(bY,bF,bD);bQ.newFlag(bY,bD,"fin"+bR+bD);bQ.newFlag(bY,"fin"+bR+bD,"fin"+bR+bF);bQ.newFlag(bY,"fin"+bR+bF,bF);bY="sides"+bR+bF;bQ.newFlag(bY,"fin"+bR+bF,"fin"+bR+bD);bQ.newFlag(bY,"fin"+bR+bD,"findown"+bR+bD);bQ.newFlag(bY,"findown"+bR+bD,"findown"+bR+bF);bQ.newFlag(bY,"findown"+bR+bF,"fin"+bR+bF);bY="bottom"+bR+bF;bQ.newFlag(bY,"down"+bD,"down"+bF);bQ.newFlag(bY,"down"+bF,"findown"+bR+bF);bQ.newFlag(bY,"findown"+bR+bF,"findown"+bR+bD);bQ.newFlag(bY,"findown"+bR+bD,"down"+bD);bF=bD}}bL=bQ.topoly();bL.name="h"+bI.name;return bL};a1=function(bI){var bT,bS,bQ,bR,bN,bP,bO,bE,bU,bC,bH,bG,bz,bL,bK,bJ,bB,by,bx,bV,bX,bW,bM,bF,bD,bA;console.log("Taking stella of "+bI.name+"...");bT=bI.centers();bQ=new aj();bM=bI.xyz;for(bR=bB=0,bV=bM.length;bB<bV;bR=++bB){bP=bM[bR];bQ.newV("v"+bR,bP)}bF=bI.face;for(bR=by=0,bX=bF.length;by<bX;bR=++by){bS=bF[bR];bE="v"+bS[bS.length-2];bC="v"+bS[bS.length-1];bL=bI.xyz[bS[bS.length-2]];bK=bI.xyz[bS[bS.length-1]];for(bx=0,bW=bS.length;bx<bW;bx++){bO=bS[bx];bz="v"+bO;bJ=bI.xyz[bO];bU=bE+"~"+bC;bH=bC+"~"+bE;bG=bC+"~"+bz;bQ.newV(bU,aY(aY(bL,bK),bT[bR]));bQ.newFlag("in"+bR,bU,bG);bQ.newFlag("f"+bR+bC,bG,bU);bQ.newFlag("f"+bR+bC,bU,bC);bQ.newFlag("f"+bR+bC,bC,bG);bQ.newFlag("f"+bU,bE,bH);bQ.newFlag("f"+bU,bH,bU);bQ.newFlag("f"+bU,bU,bE);bD=[bC,bz],bE=bD[0],bC=bD[1];bA=[bK,bJ],bL=bA[0],bK=bA[1]}}bN=bQ.topoly();bN.name="l"+bI.name;return bN};ab=function(bA,bz){var bE,bC,bB,bx,bF,by,bD;bE=0.1;bx=a8(bA);for(by=0,bD=bz.length;by<bD;by++){bB=bz[by];bF=l(bx[bB[0]],bx[bB[1]]);bC=d(bE*1/2*(1-W(E(bF,bF))),bF);bx[bB[0]]=A(bx[bB[0]],bC);bx[bB[1]]=A(bx[bB[1]],bC)}return bx};bd=function(bB,bA){var bE,bC,bx,by,bF,bz,bD;bx=(function(){var bJ,bH,bI,bG;bG=[];for(bJ=0,bH=bA.length;bJ<bH;bJ++){bI=bA[bJ],bE=bI[0],bC=bI[1];bG.push(l(bB[bE],bB[bC]))}return bG})();by=[0,0,0];for(bz=0,bD=bx.length;bz<bD;bz++){bF=bx[bz];by=A(by,bF)}by=d(1/bA.length,by);return _.map(bB,function(bG){return bh(bG,by)})};C=function(bA){var bx,bz,by;bz=[0,0,0];bx=_.max(_.map(bA,function(bB){return L(bB)}));by=1/bx;return _.map(bA,function(bB){return[by*bB[0],by*bB[1],by*bB[2]]})};bg=function(bD,bA){var bI,bF,bH,bE,bz,bx,bJ,bC,bB,bG,by;bI=0.1;bx=a8(bD);for(bC=0,bG=bA.length;bC<bG;bC++){bE=bA[bC];bH=(function(){var bM,bL,bK;bK=[];for(bM=0,bL=bE.length;bM<bL;bM++){bJ=bE[bM];bK.push(bD[bJ])}return bK})();bz=al(bH);bF=bo(bH);if(E(bz,bF)<0){bz=d(-1,bz)}for(bB=0,by=bE.length;bB<by;bB++){bJ=bE[bB];bx[bJ]=A(bx[bJ],d(E(d(bI,bz),bh(bF,bD[bJ])),bz))}}return bx};o=function(by,bF){var bC,bz,bD,bE,bx,bA,bG,bB;bF||(bF=1);console.log("Canonicalizing "+by.name+"...");bz=by.face;bC=by.edges();bx=by.xyz;bE=1;for(bD=bB=0;0<=bF?bB<=bF:bB>=bF;bD=0<=bF?++bB:--bB){bG=a8(bx);bx=ab(bx,bC);bx=bd(bx,bC);bx=bg(bx,bz);bE=_.max(_.map(_.zip(bx,bG),function(bI){var bH,bJ;bH=bI[0],bJ=bI[1];return L(bh(bH,bJ))}));if(bE<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bE+"]");bA=new aS(bx,by.face,by.name);console.log("canonicalize",bA);return bA};P=function(bA){var bB,by,bz,bx;by=bA.centers();for(bz=0,bx=by.length;bz<bx;bz++){bB=by[bz];bB=d(1/E(bB,bB),bB)}return by};I=function(by){var bN,bH,bA,bI,bx,bG,bM,bL,bJ,bE,bD,bK,bz,bF,bC,bB;bN=[];bF=by.face;for(bE=0,bK=bF.length;bE<bK;bE++){bI=bF[bE];bA=[0,0,0];bx=[0,0,0];bH=0;bC=bI.slice(-2),bM=bC[0],bL=bC[1];for(bD=0,bz=bI.length;bD<bz;bD++){bJ=bI[bD];bA=A(bA,by.xyz[bJ]);bx=A(bx,aZ(by.xyz[bM],by.xyz[bL],by.xyz[bJ]));bH+=ax(by.xyz[bM],by.xyz[bL]);bB=[bL,bJ],bM=bB[0],bL=bB[1]}bA=d(1/bI.length,bA);bx=bp(bx);bH=bH/bI.length;bG=aF(d(E(bA,bx),bx));bN.push(d((1+bH)/2,bG))}return bN};g=function(bB,by){var bz,bx,bA;by||(by=1);bx=aL(bB);console.log("Pseudo-canonicalizing "+bB.name+"...");for(bz=bA=0;0<=by?bA<by:bA>by;bz=0<=by?++bA:--bA){bx.xyz=I(bB);bB.xyz=I(bx)}return new aS(bB.xyz,bB.face,bB.name)};z=function(bB,by){var bz,bx,bA;by||(by=1);bx=aL(bB);console.log("Planarizing "+bB.name+"...");for(bz=bA=0;0<=by?bA<by:bA>by;bz=0<=by?++bA:--bA){bx.xyz=P(bB);bB.xyz=P(bx)}return new aS(bB.xyz,bB.face,bB.name)};K=function(bZ){var bY,bU,bP,bS,bX,bH,b0,bR,bN,bJ,bW,bD,bT,bO,bF,bG,bI,bQ,bV,bE,bC,bB,by,bx,bM,bK,bA,bL,bz;bI=999;bT=[];bO=[];bF=bZ.length;bW=function(b1,b2){return(b1||b2)&&!(b1&&b2)};bY=function(b3,b2,b1){return(b2[0]-b3[0])*(b1[1]-b3[1])-(b1[0]-b3[0])*(b2[1]-b3[1])};bN=function(b3,b2,b1){return bY(b3,b2,b1)>0};bJ=function(b3,b2,b1){return bY(b3,b2,b1)>=0};bP=function(b3,b2,b1){return bY(b3,b2,b1)===0};bU=function(b3,b2,b1){if(bP(b3,b2,b1)){return false}if(b3[0]!==b2[0]){return(b3[0]<=b1[0])&&(b1[0]<=b2[0])||(b3[0]>=b1[0])&&(b1[0]>=b2[0])}else{return(b3[1]<=b1[1])&&(b1[1]<=b2[1])||(b3[1]>=b1[1])&&(b1[1]>=b2[1])}};bR=function(b4,b3,b2,b1){if(bP(b4,b3,b2)||bP(b4,b3,b1)||bP(b2,b1,b4)||bP(b2,b1,b3)){return false}return bW(bN(b4,b3,b2),bN(b4,b3,b1))&&bW(bN(b2,b1,b4),bN(b2,b1,b3))};b0=function(b4,b3,b2,b1){if(bR(b4,b3,b2,b1)){return true}else{if(bU(b4,b3,b2)||bU(b4,b3,b1)||bU(b2,b1,b4)||bU(b2,b1,b3)){return true}else{return false}}};bH=function(b3,b1){var b4,b2;b2=(b3+1+bF)%bF;b4=(b3-1+bF)%bF;if(bJ(bZ[b3],bZ[b2],bZ[b4])){return bN(bZ[b3],bZ[b1],bZ[b4])&&bN(bZ[b1],bZ[b3],bZ[b2])}return !(bJ(bZ[b3],bZ[b1],bZ[b2])&&bJ(bZ[b1],bZ[b3],bZ[b4]))};bX=function(b2,b1){var b4,b3;b4=0;while(true){b3=(b4+1+bF)%bF;if((b4!==b2)&&(b3!==b2)&&(b4!==b1)&&(b3!==b1)&&bR(bZ[b2],bZ[b1],bZ[b4],bZ[b3])){return false}b4=(b4+1+bF)%bF;if(b4===0){break}}return true};bS=function(b2,b1){return bH(b2,b1)&&bH(b1,b2)&&bX(b2,b1)};bC=0;while(true){bB=(bC+1+bF)%bF;bE=(bC-1+bF)%bF;bO[bC]=bS(bE,bB);bC=(bC+1+bF)%bF;if(bC===0){break}}bV=(function(){bz=[];for(var b2=0,b1=bF-1;0<=b1?b2<=b1:b2>=b1;0<=b1?b2++:b2--){bz.push(b2)}return bz}).apply(this);bQ=bF;bK=bI;bG=0;while(bK>0&&bQ>3){bK-=1;bB=bG;bM=bI;while(true){bM-=1;bD=false;if(bO[bB]){by=(bB+1+bF)%bF;bx=(by+1+bF)%bF;bC=(bB-1+bF)%bF;bE=(bC-1+bF)%bF;bT.push([bV[bC],bV[by]]);bO[bC]=bS(bE,by);bO[by]=bS(bC,bx);bZ=bZ.slice(0,+bB+1||9000000000).concat(bZ.slice(by));bV=bV.slice(0,+bB+1||9000000000).concat(bV.slice(by));if(bE>bB){bE-=1}if(bC>bB){bC-=1}if(by>bB){by-=1}if(bx>bB){bx-=1}bF--;bG=by;bQ--;bD=true}bB=(bB+1+bF)%bF;if(!(bM>0&&!bD&&bB!==bG)){break}}}return bT};a=function(by,bx){if(((by[0]===bx[0])&&(by[1]===bx[1])&&(by[2]===bx[2]))||(by[0]===bx[1])&&(by[1]===bx[2])&&(by[2]===bx[0])||(by[0]===bx[2])&&(by[1]===bx[0])&&(by[2]===bx[1])){return true}else{return false}};v=function(b4,bR){var bO,b5,bQ,bP,bM,bS,b2,bx,bH,b6,b9,b8,b7,b3,b1,b0,bZ,bN,bF,bE,bD,bC,bB,bA,bz,by,bY,bX,bW,bV,bU,bT,bL,bK,bJ,bI,bG;bM=[];bx=[];bT=(function(){var cb,cc,ca;ca=[];for(b2=cb=0,cc=b4.length-1;0<=cc?cb<=cc:cb>=cc;b2=0<=cc?++cb:--cb){ca.push([b2,(b2+1)%b4.length])}return ca})();for(b3=0,bN=bT.length;b3<bN;b3++){bL=bT[b3],b8=bL[0],b7=bL[1];bM[b8]=[b7];bx[b7]=[b8]}for(b1=0,bF=bR.length;b1<bF;b1++){b5=bR[b1];bM[b5[0]].push(b5[1]);bM[b5[1]].push(b5[0]);bx[b5[0]].push(b5[1]);bx[b5[1]].push(b5[0])}b6=[];for(b0=0,bE=bR.length;b0<bE;b0++){b5=bR[b0];bK=bM[b5[1]];for(bZ=0,bD=bK.length;bZ<bD;bZ++){bQ=bK[bZ];bJ=bx[b5[0]];for(bY=0,bC=bJ.length;bY<bC;bY++){bP=bJ[bY];if(bQ===bP){b6.push([b5[0],b5[1],bQ])}}}bI=bM[b5[0]];for(bX=0,bB=bI.length;bX<bB;bX++){bQ=bI[bX];bG=bx[b5[1]];for(bW=0,bA=bG.length;bW<bA;bW++){bP=bG[bW];if(bQ===bP){b6.push([b5[1],b5[0],bQ])}}}}b9=[b6.pop()];for(bV=0,bz=b6.length;bV<bz;bV++){bH=b6[bV];bO=false;for(bU=0,by=b9.length;bU<by;bU++){bS=b9[bU];if(a(bH,bS)){bO=true;break}}if(!bO){b9.push(bH)}}return b9};ac=function(by,bx){var bB,bA,bI,bH,bF,bC,bM,bL,bK,bE,bD,bJ,bz,bG;bx=bx||false;console.log("Triangulating faces of "+by.name+"...");bC=new aS();bC.xyz=M(by.xyz);bC.face_class=[];bG=by.face;for(bH=bE=0,bJ=bG.length;bE<bJ;bH=++bE){bI=bG[bH];if(bI.length>3){bB=aa((function(){var bP,bO,bN;bN=[];for(bP=0,bO=bI.length;bP<bO;bP++){bK=bI[bP];bN.push(by.xyz[bK])}return bN})());bA=K(bB);bL=v(bI,bA);for(bF=bD=0,bz=bL.length;bD<bz;bF=++bD){bM=bL[bF];bC.face.push([bI[bM[0]],bI[bM[1]],bI[bM[2]]]);if(bx){bC.face_class.push(by.face_class[bH])}}}else{bC.face.push([bI[0],bI[1],bI[2]]);if(bx){bC.face_class.push(by.face_class[bH])}}}bC.name=by.name;return bC};ai=function(bx){var bC,bD,bF,bA,bz,bE,by,bB;bD="";bB=bx.face;for(bA=0,bE=bB.length;bA<bE;bA++){bC=bB[bA];for(bz=0,by=bC.length;bz<by;bz++){bF=bC[bz];bD+=""+bF+"->"}bD+="\n"}return console.log(bD)};D=function(){var bE,bB,bA,bz,bD,bC,by,bx;bz=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bB=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bD=0,by=bB.length;bD<by;bD++){bE=bB[bD];console.log("Operator "+bE);for(bC=0,bx=bz.length;bC<bx;bC++){bA=bz[bC];console.log(bE+bA+":",generatePoly(bE+bA))}}return console.log("===== Done Testing Basic Ops =====")};aV='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';bi=PEG.buildParser(aV);bw=function(by,bx){return by.apply(this,bx||[])};bk={T:f,O:aq,C:ak,I:ba,D:ar,P:U,A:a0,Y:bt};H={d:aL,k:ae,a:aK,g:a6,p:t,r:u,h:i,c:bm,w:bn,n:F,x:ad,l:a1,z:ac,K:g,C:o,A:z};aR=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a4=function(bA){var bx,bz,bD,bC,by,bB;bz=bA;for(bC=0,by=aR.length;bC<by;bC++){bB=aR[bC],bD=bB[0],bx=bB[1];bz=bz.replace(bD,bx)}console.log(""+bA+" executed as "+bz);return bz};bu=function(bD){var by,bF,bA,bH,bB,bG,bC,bx,bz,bE;bC=a4(bD);bG=bi.parse(bC).reverse();bA=bG.shift();bF=bk[bA.op];by=bA.args;bx=bw(bF,by);for(bz=0,bE=bG.length;bz<bE;bz++){bA=bG[bz];bB=H[bA.op];bH=[bx].concat(bA.args);bx=bw(bB,bH)}bx.xyz=bd(bx.xyz,bx.edges());bx.xyz=C(bx.xyz);bx=R(bx);return bx};af={};bq=500;aC=400;Q={};k=M(w);am=M(w);V=800;B=5;br=0;N=0.8;p=bq/2;ay=aC/2;x=new Date();r=true;aW="rgba(255,255,255,1.0)";ao="signature";h="fillstroke";bf=0.5;ap=false;Y=0;X=0;aJ=[1,0,0];a7=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aH=function(bz,bx){var bA,by;bA=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;by=new bA();by.append(bz);return saveAs(by.getBlob("text/plain;charset="+document.characterSet),bx)};bs=function(){var bx,bC,bB,bA,bz,by;by={};bx=/\+/g;bz=/([^&=]+)=?([^&]*)/g;bC=function(bD){return decodeURIComponent(bD.replace(bx," "))};bA=window.location.search.substring(1);while(bB=bz.exec(bA)){by[bC(bB[1])]=bC(bB[2])}return by};at=function(){var bx,by;by=$("#spec").val().split(/\s+/g).slice(0,2);bx=location.protocol+"//"+location.host+location.pathname;bx+="?recipe="+encodeURIComponent(by[0]);if(a3!==aT){bx+="&palette="+encodeURIComponent(a3.reduce(function(bz,bA){return bz+" "+bA}))}return $("#link").attr("href",bx)};aN=function(){var bx,by;bx=$("#poly");bx.width(bq);bx.height(aC);af=bx[0].getContext("2d");af.lineWidth=bf;if(r){af.clearRect(0,0,bq,aC)}else{af.clearRect(0,0,bq,aC);af.fillStyle=aW;af.fillRect(0,0,bq,aC)}by=$("#expandcollapse");return by.click(function(){if(/minus/.test(by.attr("src"))){$("#morestats").hide();return by.attr("src","media/plus.png")}else{$("#morestats").show();return by.attr("src","media/minus.png")}})};aP=function(){if(r){return af.clearRect(0,0,bq,aC)}else{af.clearRect(0,0,bq,aC);af.fillStyle=aW;return af.fillRect(0,0,bq,aC)}};S=function(bF,bN){var by,bH,bG,bM,bB,bC,bL,bE,bK,bI,bz,bx,bO,bP,bJ,bD,bA;bN||(bN=[3,3,3]);bC=_.map(bF.xyz,function(bQ){return bQ});bF.xyz=_.map(bF.xyz,function(bQ){return s(k,bQ)});aU(bF);bJ=bF.face;for(bM=bz=0,bO=bJ.length;bz<bO;bM=++bz){bH=bJ[bM];af.beginPath();bE=bH[bH.length-1];bD=y(A(bN,bF.xyz[bE]),B,br,N,V),bK=bD[0],bI=bD[1];af.moveTo(bK+p,bI+ay);for(bx=0,bP=bH.length;bx<bP;bx++){bL=bH[bx];bA=y(A(bN,bF.xyz[bL]),B,br,N,V),bK=bA[0],bI=bA[1];af.lineTo(bK+p,bI+ay)}by=ah(bF.face_class[bM]);bG=(function(){var bS,bQ,bR;bR=[];for(bS=0,bQ=bH.length;bS<bQ;bS++){bL=bH[bS];bR.push(bF.xyz[bL])}return bR})();bB=E(al(bG),bp([1,-1,0]));by=d((bB/2+0.5)*0.7+0.3,by);if(h==="fill"||h==="fillstroke"){af.fillStyle="rgba("+(Z(by[0]*255))+", "+(Z(by[1]*255))+", "+(Z(by[2]*255))+", "+1+")";af.fill();af.strokeStyle="rgba("+(Z(by[0]*255))+", "+(Z(by[1]*255))+", "+(Z(by[2]*255))+", "+1+")";af.stroke()}if(h==="fillstroke"){af.fillStyle="rgba("+(Z(by[0]*255))+", "+(Z(by[1]*255))+", "+(Z(by[2]*255))+", "+1+")";af.fill();af.strokeStyle="rgba(0,0,0, .3)";af.stroke()}if(h==="stroke"){af.strokeStyle="rgba(0,0,0, .8)";af.stroke()}}return bF.xyz=bC};aE=function(){var bz,bB,bA,by,bx;aP();bx=[];for(bz=bA=0,by=Q.length;bA<by;bz=++bA){bB=Q[bz];bx.push(S(bB,[0+3*bz,0,3]))}return bx};az=function(){var bz,bB,bA,by,bx;bx=[];for(bz=bA=0,by=Q.length;bA<by;bz=++bA){bB=Q[bz];$("#basicstats").text(bB.data());bx.push($("#morestats").text(bB.moreData()))}return bx};bj=function(){var by,bz,bB,bA,bx;aP();by=(2*Math.PI)/180*x.getSeconds()*0.1;for(bz=bA=0,bx=Q.length;bA<bx;bz=++bA){bB=Q[bz];S(bB,[0+3*bz,0,3])}return setTimeout(bj,100)};$(function(){var by,bx;aN();bx=bs();if("recipe" in bx){by=[bx.recipe];$("#spec").val(by)}else{by=[be(a7)];$("#spec").val(by);at()}if("palette" in bx){a3=bx.palette.split(/\s+/g);at()}$("#palette").val(a3.reduce(function(bz,bA){return bz+" "+bA}));Q=_.map(by,function(bz){return bu(bz)});az();aE();$("#spec").change(function(bz){by=$("#spec").val().split(/\s+/g).slice(0,2);Q=_.map(by,function(bA){return bu(bA)});az();at();return aE()});$("#palette").change(function(bz){a3=$(this).val().split(/\s+/g);at();return aE()});$("#poly").mousewheel(function(bB,bC,bA,bz){bB.preventDefault();V*=(10+bC)/10;return aE()});$("#poly").mousedown(function(bz){var bA;bz.preventDefault();ap=true;Y=bz.clientX-$(this).offset().left;X=bz.clientY-($(this).offset().top-$(window).scrollTop());bA=aO(Y,X,p,ay,B,br,N,V);if(bA[0]*bA[1]*bA[2]*0===0){aJ=bA}return am=M(k)});$("#poly").mouseup(function(bz){bz.preventDefault();return ap=false});$("#poly").mouseleave(function(bz){bz.preventDefault();return ap=false});$("#poly").mousemove(function(bC){var bA,bz,bB;bC.preventDefault();if(ap){bA=bC.clientX-$(this).offset().left;bz=bC.clientY-($(this).offset().top-$(window).scrollTop());bB=aO(bA,bz,p,ay,B,br,N,V);if(bB[0]*bB[1]*bB[2]*0===0&&aJ[0]*aJ[1]*aJ[2]*0===0){k=aI(aG(aJ,bB),am)}return aE()}});$("#strokeonly").click(function(bz){h="stroke";return aE()});$("#fillonly").click(function(bz){h="fill";return aE()});$("#fillandstroke").click(function(bz){h="fillstroke";return aE()});$("#siderot").click(function(bz){k=aX(aM/2,0,1,0);return aE()});$("#toprot").click(function(bz){k=aX(aM/2,1,0,0);return aE()});$("#frontrot").click(function(bz){k=j(0,0,0);return aE()});$("#pngsavebutton").click(function(bC){var bB,bA,bz;bB=$("#poly")[0];bz=$("#spec").val().split(/\s+/g)[0];bA="polyhedronisme-"+bz.replace(/\([^\)]+\)/g,"")+".png";return bB.toBlob(function(bD){return saveAs(bD,bA)})});$("#objsavebutton").click(function(bC){var bA,bB,bz;bB=Q[0].toOBJ();bz=$("#spec").val().split(/\s+/g)[0];bA="polyhedronisme-"+bz.replace(/\([^\)]+\)/g,"")+".obj";return aH(bB,bA)});return $("#x3dsavebutton").click(function(bC){var bA,bz,bB,bD;bB=ac(Q[0],true);bD=bB.toVRML();bz=$("#spec").val().split(/\s+/g)[0];bA="polyhedronisme-"+bz.replace(/\([^\)]+\)/g,"")+".wrl";return aH(bD,bA)})})}).call(this);