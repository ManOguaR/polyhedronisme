(function(){var q,aV,aB,bn,an,a6,S,X,W,aI,ao,a2,aU,aL,h,o,ay,p,af,a4,z,y,aJ,bi,aZ,N,aA,bj,bl,g,n,aO,L,bk,a7,I,az,ae,be,aj,u,bt,aq,D,aD,R,aK,aw,ac,v,aC,ba,am,J,a3,aF,P,j,al,w,a5,bs,a9,aM,E,F,aN,ad,av,e,m,K,a8,aX,aH,d,r,br,ak,ap,au,bh,G,aY,Q,ag,bp,x,M,A,bo,U,bf,ai,aR,bb,T,Z,s,bq,aP,bd,bc,aE,O,H,t,B,i,Y,aS,aG,ar,at,a1,aT,aQ,V,a0,bg,b,k,aa,C,f,ah,a,ab,l,bm,ax,aW,c;aP=Math.random;Y=Math.round;am=Math.floor;V=Math.sqrt;a1=Math.sin;I=Math.cos;b=Math.tan;N=Math.asin;a4=Math.acos;aA=Math.atan;bb=Math.pow;af=Math.abs;aL=Math.PI;S=Math.LN10;e=Math.log;bb=Math.pow;m=function(bu){return e(bu)/S};at=function(bw,bv){var bu;bu=bb(10,m(bw)-am(m(bw)));return""+(Y(bu*(bv-1)))};L=function(bw){var bv,bu;if((bw==null)||typeof bw!=="object"){return bw}bu=new bw.constructor();for(bv in bw){bu[bv]=L(bw[bv])}return bu};bd=function(bv){var bu;bu=am(aP()*bv.length);return bv[bu]};d=function(bv,bu){return[bv*bu[0],bv*bu[1],bv*bu[2]]};p=function(bv,bu){return[bv[0]*bu[0],bv[1]*bu[1],bv[2]*bu[2]]};z=function(bv,bu){return[bv[0]+bu[0],bv[1]+bu[1],bv[2]+bu[2]]};bg=function(bv,bu){return[bv[0]-bu[0],bv[1]-bu[1],bv[2]-bu[2]]};D=function(bv,bu){return bv[0]*bu[0]+bv[1]*bu[1]+bv[2]*bu[2]};az=function(bv,bu){return[bv[1]*bu[2]-bv[2]*bu[1],bv[2]*bu[0]-bv[0]*bu[2],bv[0]*bu[1]-bv[1]*bu[0]]};K=function(bu){return V(D(bu,bu))};a8=function(bu){return D(bu,bu)};bm=function(bu){return d(1/V(a8(bu)),bu)};aX=function(bv,bu){return d(1/2,z(bv,bu))};l=function(bw,bv,bu){return[(1-bu)*bw[0]+bu*bv[0],(1-bu)*bw[1]+bu*bv[1],(1-bu)*bw[2]+bu*bv[2]]};au=function(bv,bu){return l(bv,bu,1/3)};aE=function(bu){return d(1/a8(bu),bu)};k=function(bw,bv){var bu;bu=bg(bv,bw);return bg(bw,d(D(bu,bw)/a8(bu),bu))};aw=function(bv,bu){return V(a8(k(bv,bu)))};av=function(bB,bA,by){var bz,bw,bv,bu,bx;console.log("lpd1",bB,bA,by);bw=bg(bA,bB);console.log("lpd d21",bw);bz=bg(bB,by);console.log("lpd d13",bz);bv=a8(bw);bx=-D(bz,bw)/bv;console.log("lpd t",bx);if(bx<=0){return a8(bz)}else{if(bx>=1){bu=a8(bg(bA,by));console.log("lpd res1",bu)}}console.log("lpd4");bu=a8(az(bw,bz))/bv;console.log("lpd res2",bu);return bu};aY=function(by,bx,bw){var bv,bu;bv=bg(bx,by);bu=bg(bw,bx);return az(bv,bu)};F=function(bA,bz,bx){var bv,bB,by,bw,bu,bE,bD,bC,bF;for(bv=0,bB=bA.length;bv<bB;bv++){bE=bA[bv];for(bu=0,by=bz.length;bu<by;bu++){bD=bz[bu];if(bE===bD){for(bF=0,bw=bx.length;bF<bw;bF++){bC=bx[bF];if(bE===bC){return bE}}}}}return null};bl=function(by){var bx,bv,bu,bw;bx=[0,0,0];for(bv=0,bu=by.length;bv<bu;bv++){bw=by[bv];bx=z(bx,bw)}return d(1/by.length,bx)};ak=function(bx){var bw,by,bu,bv,bz,bC,bB,bA;bu=[0,0,0];bv=bx.slice(-2),bC=bv[0],bB=bv[1];for(bw=0,by=bx.length;bw<by;bw++){bA=bx[bw];bu=z(bu,aY(bC,bB,bA));bz=[bB,bA],bC=bz[0],bB=bz[1]}return bm(bu)};bk=function(bx){var bu,bw,by,bv,bz,bC,bB,bA;bu=0;bv=bx.slice(0,2),bC=bv[0],bB=bv[1];bz=bx.slice(2);for(bw=0,by=bz.length;bw<by;bw++){bA=bz[bw];bu+=K(az(bg(bB,bC),bg(bA,bC)));bB=bA}return bu};aC=function(bB){var bz,bw,bC,by,bx,bu,bv,bD,bA,bJ,bI,bH,bG,bE,bF;bz=[];bv=bB.slice(0,2),bH=bv[0],bG=bv[1];bD=bB.slice(2);for(bw=0,bC=bD.length;bw<bC;bw++){bE=bD[bw];bz.push(K(az(bg(bG,bH),bg(bE,bH))));bG=bE}bz.sort(function(bL,bK){return bL-bK});bJ="";for(bu=0,by=bz.length;bu<by;bu++){bF=bz[bu];bJ+=at(bF,2)}bA=bz.reverse();for(bI=0,bx=bA.length;bI<bx;bI++){bF=bA[bI];bJ+=at(bF,2)}return bJ};Z=function(bB){var bA,bw,bz,bv,bu,by,bx,bD,bC;bx=L(bB);bC=bB[0];bx=_.map(bx,function(bE){return bE-bC});bv=ak(bB);bA=bm(bl(bB));bu=az(bv,bA);by=[];for(bw=0,bz=bx.length;bw<bz;bw++){bD=bx[bw];by.push([D(bv,bD),D(bu,bD)])}return by};a7=function(bx){var bw,bv,bu,by;bu=new Array(bx.length);for(bw=bv=0,by=bx.length-1;0<=by?bv<=by:bv>=by;bw=0<=by?++bv:--bv){bu[bw]=bx[bw].slice(0)}return bu};r=function(bv,bu){return[bv[0][0]*bu[0]+bv[0][1]*bu[1]+bv[0][2]*bu[2],bv[1][0]*bu[0]+bv[1][1]*bu[1]+bv[1][2]*bu[2],bv[2][0]*bu[0]+bv[2][1]*bu[1]+bv[2][2]*bu[2]]};aH=function(bu,bv){return[[bu[0][0]*bv[0][0]+bu[0][1]*bv[1][0]+bu[0][2]*bv[2][0],bu[0][0]*bv[0][1]+bu[0][1]*bv[1][1]+bu[0][2]*bv[2][1],bu[0][0]*bv[0][2]+bu[0][1]*bv[1][2]+bu[0][2]*bv[2][2]],[bu[1][0]*bv[0][0]+bu[1][1]*bv[1][0]+bu[1][2]*bv[2][0],bu[1][0]*bv[0][1]+bu[1][1]*bv[1][1]+bu[1][2]*bv[2][1],bu[1][0]*bv[0][2]+bu[1][1]*bv[1][2]+bu[1][2]*bv[2][2]],[bu[2][0]*bv[0][0]+bu[2][1]*bv[1][0]+bu[2][2]*bv[2][0],bu[2][0]*bv[0][1]+bu[2][1]*bv[1][1]+bu[2][2]*bv[2][1],bu[2][0]*bv[0][2]+bu[2][1]*bv[1][2]+bu[2][2]*bv[2][2]]]};v=[[1,0,0],[0,1,0],[0,0,1]];i=function(by,bw,bx){var bz,bv,bu;bz=[[I(by),-1*a1(by),0],[a1(by),I(by),0],[0,0,1]];bu=[[I(bw),0,-1*a1(bw)],[0,1,0],[a1(bw),0,I(bw)]];bv=[[1,0,0],[0,I(bx),-1*a1(bx)],[0,a1(bx),I(bx)]];return aH(bv,aH(bu,bz))};aW=function(by,bH,bG,bC){var bA,bv,bx,bw,bB,bF,bE,bu,bD,bz;by/=2;bF=a1(by);bA=I(by);bE=bF*bF;bv=K([bH,bG,bC]);if(bv===0){bw=[0,0,1],bH=bw[0],bG=bw[1],bC=bw[2]}if(bv!==1){bB=bm([bH,bG,bC]),bH=bB[0],bG=bB[1],bC=bB[2]}if(bH===1&&bG===0&&bC===0){bx=[[1,0,0],[0,1-2*bE,2*bF*bA],[0,-2*bF*bA,1-2*bE]]}else{if(bH===0&&bG===1&&bC===0){bx=[[1-2*bE,0,-2*bF*bA],[0,1,0],[2*bF*bA,0,1-2*bE]]}else{if(bH===0&&bG===0&&bC===1){bx=[[1-2*bE,2*bF*bA,0],[-2*bF*bA,1-2*bE,0],[0,0,1]]}else{bu=bH*bH;bD=bG*bG;bz=bC*bC;bx=[[1-2*(bD+bz)*bE,2*(bH*bG*bE+bC*bF*bA),2*(bH*bC*bE-bG*bF*bA)],[2*(bG*bH*bE-bC*bF*bA),1-2*(bz+bu)*bE,2*(bG*bC*bE+bH*bF*bA)],[2*(bC*bH*bE+bG*bF*bA),2*(bC*bG*bE-bH*bF*bA),1-2*(bu+bD)*bE]]}}}return bx};x=function(bw,bv,bx,bA,bu){var by,bz;bz=(bv*bA-bx)/(1-bA);by=bu*bA/(1-bA);return[by*bw[0]/(bw[2]+bz),by*bw[1]/(bw[2]+bz)]};aN=function(bB,by,bE,bC,bI,bx,bw,bv){var bH,bu,bD,bz,bF,bK,bM,bA,bG,bJ,bL;bG=(bI*bw-bx)/(1-bw);bH=bv*bw/(1-bw);bD=bB-bE;bK=by-bC;bu=bH*bH;bJ=bG*bG;bz=bD*bD;bM=bK*bK;bF=(2*bH*bD*bG+V(4*bu*bz*bJ+4*bz*(bu+bz+bM)*(1-bJ)))/(2*(bu+bz+bM));bA=(bH*bK*bG)/(bu+bz+bM)+(bK*V(4*bu*bJ+4*(bu+bz+bM)*(1-bJ)))/(2*(bu+bz+bM));bL=V(1-bF*bF-bA*bA);return[bF,bA,bL]};aF=function(bw,bv){var bx,bu;bu=az(bw,bv);bx=a4(D(bw,bv));return aW(-1*bx,bu[0],bu[1],bu[2])};ba=function(bx){var bw,bv,bu,bz,by;bw=[];bz=bx.slice(-1)[0];for(bv=0,bu=bx.length;bv<bu;bv++){by=bx[bv];bw.push([bz,by]);bz=by}return bw};c=function(bu){var bA,bz,bx,bB,by,bv,bw,bD,bC;bC=[];bw=bu.face;for(bz=bx=0,bB=bw.length;bx<bB;bz=++bx){bA=bw[bz];for(bv=0,by=bA.length;bv<by;bv++){bD=bA[bv];bC[bD]=bu.face_class[bz]}}return bC};aS=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];bs=function(bv){var bu;if(bv[0]==="#"){bv=bv.slice(1)}if(bv.length===3){bu=bv.split("").map(function(bw){return parseInt(bw+bw,16)/255})}else{bu=bv.match(/.{2}/g).map(function(bw){return parseInt(bw,16)/255})}return bu};a2=aS;ag=function(bu){if(bu<a2.length){return bs(a2[bu])}else{return bs(a2[a2.length-1])}};Q=function(bu){var bD,bw,bA,by,bC,bx,bz,bv,bB;bu.face_class=[];bA={};bw=function(bE,bH){var bF,bG;bG=Y(100*bE);if(bG in bH){return bH[bG]}else{bF=_.toArray(bH).length;bH[bG]=bF;return bF}};bv=bu.face;for(bx=0,bz=bv.length;bx<bz;bx++){by=bv[bx];if(an==="area"){bC=(function(){var bE,bG,bF;bF=[];for(bG=0,bE=by.length;bG<bE;bG++){bB=by[bG];bF.push(bu.xyz[bB])}return bF})();bD=bw(bk(bC),bA)}else{if(an==="signature"){bC=(function(){var bE,bG,bF;bF=[];for(bG=0,bE=by.length;bG<bE;bG++){bB=by[bG];bF.push(bu.xyz[bB])}return bF})();bD=bw(aC(bC),bA)}else{bD=by.length-3}}bu.face_class.push(bD)}console.log(_.toArray(bA).length+" face classes");return bu};aT=function(bu){var bv,bD,by,bC,bE,bz,bx,bA,bw,bB;bv=bu.centers();bC=bu.normals();bz=[0,0,(A*M-bo)/(1-M)];bE=function(bG,bF){return -D(bg(bz,bG[0]),bG[1])*D(bg(bF[0],bG[0]),bG[1])};bw=function(bG,bF){return bG[0][2]-bF[0][2]};bB=_.zip(bv,bC,(function(){bA=[];for(var bF=0,bG=bu.face.length-1;0<=bG?bF<=bG:bF>=bG;0<=bG?bF++:bF--){bA.push(bF)}return bA}).apply(this)).sort(bw).map(function(bF){return bF[2]});bu.face=(function(){var bF,bH,bG;bG=[];for(bH=0,bF=bB.length;bH<bF;bH++){bD=bB[bH];bG.push(bu.face[bD])}return bG})();return bu.face_class=(function(){var bF,bH,bG;bG=[];for(bH=0,bF=bB.length;bH<bF;bH++){bD=bB[bH];bG.push(bu.face_class[bD])}return bG})()};aR=(function(){function bu(bx,bv,bw){this.face=bv||new Array();this.xyz=bx||new Array();this.name=bw||"null polyhedron"}bu.prototype.data=function(){var bv;bv=this.face.length+this.xyz.length-2;return this.face.length+" faces, "+bv+" edges, "+this.xyz.length+" vertices"};bu.prototype.moreData=function(){return"min. edge length "+(this.minEdgeLength().toPrecision(2))+"; min. face radius "+(this.minFaceRadius().toPrecision(2))};bu.prototype.edges=function(){var bF,bC,bE,bD,bv,bB,bz,bx,bA,by,bw,bG;bB={};bG=[];bC=_.map(this.face,ba);for(bx=0,bA=bC.length;bx<bA;bx++){bv=bC[bx];for(bw=0,by=bv.length;bw<by;bw++){bD=bv[bw];if(bD[0]<bD[1]){bF=bD[0],bE=bD[1]}else{bE=bD[0],bF=bD[1]}bB[bF+"~"+bE]=bD}}for(bz in bB){bD=bB[bz];bG.push(bD)}return bG};bu.prototype.minEdgeLength=function(){var bz,bA,bw,bv,bx,by;console.log("minEdgeLength");bx=Number.MAX_VALUE;by=this.edges();for(bw=0,bv=by.length;bw<bv;bw++){bA=by[bw];bz=a8(bg(this.xyz[bA[0]],this.xyz[bA[1]]));if(bz<bx){bx=bz}}return V(bx)};bu.prototype.minFaceRadius=function(){var bE,bx,bz,bD,bA,by,bB,bG,bF,bv,bw,bC;console.log("minFaceRadius");bG=Number.MAX_VALUE;bF=this.face.length;bx=this.centers();for(bA=by=0,bw=bF;0<=bw?by<bw:by>bw;bA=0<=bw?++by:--by){bE=bx[bA];bC=ba(this.face[bA]);for(bv=0,bB=bC.length;bv<bB;bv++){bD=bC[bv];bz=av(this.xyz[bD[0]],this.xyz[bD[1]],bE);if(bz<bG){bG=bz}}}return V(bG)};bu.prototype.centers=function(){var bA,bB,by,bx,bC,bz,bv,bw,bD;bA=[];bw=this.face;for(bx=0,bC=bw.length;bx<bC;bx++){bB=bw[bx];by=[0,0,0];for(bv=0,bz=bB.length;bv<bz;bv++){bD=bB[bv];by=z(by,this.xyz[bD])}bA.push(d(1/bB.length,by))}return bA};bu.prototype.normals=function(){var bz,bw,bv,bA,by,bx;bA=[];by=this.face;for(bw=0,bv=by.length;bw<bv;bw++){bz=by[bw];bA.push(ak((function(){var bB,bD,bC;bC=[];for(bD=0,bB=bz.length;bD<bB;bD++){bx=bz[bD];bC.push(this.xyz[bx])}return bC}).call(this)))}return bA};bu.prototype.toOBJ=function(){var bF,bC,by,bG,bB,bA,bz,bv,bw,bE,bx,bH,bD,bK,bJ,bI;bE="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bE+="group "+this.name+"\n";bE+="#vertices\n";bx=this.xyz;for(by=0,bG=bx.length;by<bG;by++){bJ=bx[by];bE+="v "+bJ[0]+" "+bJ[1]+" "+bJ[2]+"\n"}bE+="#normal vector defs \n";bH=this.face;for(bw=0,bB=bH.length;bw<bB;bw++){bF=bH[bw];bv=ak((function(){var bL,bN,bM;bN=[];for(bM=0,bL=bF.length;bM<bL;bM++){bJ=bF[bM];bN.push(this.xyz[bJ])}return bN}).call(this));bE+="vn "+bv[0]+" "+bv[1]+" "+bv[2]+"\n"}bE+="#face defs \n";bD=this.face;for(bC=bK=0,bA=bD.length;bK<bA;bC=++bK){bF=bD[bC];bE+="f ";for(bI=0,bz=bF.length;bI<bz;bI++){bJ=bF[bI];bE+=(bJ+1)+"//"+(bC+1)+" "}bE+="\n"}return bE};bu.prototype.toX3D=function(){var bx,bI,bL,bD,bz,bE,bB,bA,by,bv,bw,bF,bC,bJ,bH,bG,bK;bx=0.01;bK='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bw=this.face;for(bz=0,bE=bw.length;bz<bE;bz++){bD=bw[bz];for(bv=0,bB=bD.length;bv<bB;bv++){bH=bD[bv];bK+=bH+" "}bK+="-1\n"}bK+='">\n';bK+='<Color color="';bF=c(this);for(bJ=0,bA=bF.length;bJ<bA;bJ++){bI=bF[bJ];bL=ag(bI);bK+=bL[0]+" "+bL[1]+" "+bL[2]+" "}bK+='"/>';bK+='<Coordinate point="';bC=this.xyz;for(bG=0,by=bC.length;bG<by;bG++){bH=bC[bG];bK+=(bH[0]*bx)+" "+(bH[1]*bx)+" "+(bH[2]*bx)+" "}bK+='"/>\n';bK+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bK};bu.prototype.toVRML=function(){var bx,bI,bL,bD,bz,bE,bB,bA,by,bv,bw,bF,bC,bJ,bH,bG,bK;bx=0.01;bK='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bw=this.xyz;for(bz=0,bE=bw.length;bz<bE;bz++){bH=bw[bz];bK+=(bH[0]*bx)+" "+(bH[1]*bx)+" "+(bH[2]*bx)+","}bK=bK.slice(0,-1);bK+="    ]\n}\ncolor Color\n{\n  color\n  [";bF=this.face_class;for(bv=0,bB=bF.length;bv<bB;bv++){bI=bF[bv];bL=ag(bI);bK+=bL[0]+" "+bL[1]+" "+bL[2]+" ,"}bK=bK.slice(0,-1);bK+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bC=this.face;for(bJ=0,bA=bC.length;bJ<bA;bJ++){bD=bC[bJ];for(bG=0,by=bD.length;bG<by;bG++){bH=bD[bG];bK+=bH+", "}bK+="-1,"}bK=bK.slice(0,-1);bK+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bK};return bu})();f=function(){var bu;bu=new aR();bu.name="T";bu.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bu.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bu};ap=function(){var bu;bu=new aR();bu.name="O";bu.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bu.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bu};aj=function(){var bu;bu=new aR();bu.name="C";bu.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bu.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bu};a9=function(){var bu;bu=new aR();bu.name="I";bu.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bu.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bu};aq=function(){var bu;bu=new aR();bu.name="D";bu.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bu.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bu};T=function(by){var bu,bF,bD,bB,bx,bv,bz,bI,bH,bG,bE,bC,bA,bw,bK,bJ;bw=2*aL/by;bF=Math.sin(bw/2);bv=new aR();bv.name="P"+by;for(bD=bB=0,bz=by-1;0<=bz?bB<=bz:bB>=bz;bD=0<=bz?++bB:--bB){bv.xyz.push([-I(bD*bw),-a1(bD*bw),-bF])}for(bD=bx=0,bI=by-1;0<=bI?bx<=bI:bx>=bI;bD=0<=bI?++bx:--bx){bv.xyz.push([-I(bD*bw),-a1(bD*bw),bF])}bv.face.push((function(){bC=[];for(var bL=bH=by-1;bH<=0?bL<=0:bL>=0;bH<=0?bL++:bL--){bC.push(bL)}return bC}).apply(this));bv.face.push((function(){bA=[];for(var bM=by,bL=2*by-1;by<=bL?bM<=bL:bM>=bL;by<=bL?bM++:bM--){bA.push(bM)}return bA}).apply(this));for(bD=bu=0,bE=by-1;0<=bE?bu<=bE:bu>=bE;bD=0<=bE?++bu:--bu){bv.face.push([bD,(bD+1)%by,(bD+1)%by+by,bD+by])}bv=y(bv,1);return bv};aZ=function(bH){var bM,bL,bK,bJ,bI,bF,bw,bE,bv,bD,bC,bA,bz,bG,bu,bx,bB,by;bx=2*aL/bH;bK=V(1-4/(4+2*I(bx/2)-2*I(bx)));bE=V(1-bK*bK);bL=V(bK*bK+bb(bE*I(bx/2),2));bE=-bE/bL;bK=-bK/bL;bw=new aR();bw.name="A"+bH;for(bJ=bI=0,bv=bH-1;0<=bv?bI<=bv:bI>=bv;bJ=0<=bv?++bI:--bI){bw.xyz.push([bE*I(bJ*bx),bE*a1(bJ*bx),bK])}for(bJ=bF=0,bD=bH-1;0<=bD?bF<=bD:bF>=bD;bJ=0<=bD?++bF:--bF){bw.xyz.push([bE*I((bJ+0.5)*bx),bE*a1((bJ+0.5)*bx),-bK])}bw.face.push((function(){bG=[];for(var bN=bC=bH-1;bC<=0?bN<=0:bN>=0;bC<=0?bN++:bN--){bG.push(bN)}return bG}).apply(this));bw.face.push((function(){bu=[];for(var bO=bH,bN=2*bH-1;bH<=bN?bO<=bN:bO>=bN;bH<=bN?bO++:bO--){bu.push(bO)}return bu}).apply(this));for(bJ=bM=0,bz=bH-1;0<=bz?bM<=bz:bM>=bz;bJ=0<=bz?++bM:--bM){bw.face.push([bJ,(bJ+1)%bH,bJ+bH]);bw.face.push([bJ,bJ+bH,(bH+bJ-1)%bH+bH])}bw=y(bw,1);return bw};bq=function(bx){var bF,bB,bz,bw,bu,by,bD,bC,bA,bv,bE;bv=2*aL/bx;bF=1;bu=new aR();bu.name="Y"+bx;for(bB=bz=0,by=bx-1;0<=by?bz<=by:bz>=by;bB=0<=by?++bz:--bz){bu.xyz.push([-I(bB*bv),-a1(bB*bv),-0.2])}bu.xyz.push([0,0,bF]);bu.face.push((function(){bA=[];for(var bG=bD=bx-1;bD<=0?bG<=0:bG>=0;bD<=0?bG++:bG--){bA.push(bG)}return bA}).apply(this));for(bB=bE=0,bC=bx-1;0<=bC?bE<=bC:bE>=bC;bB=0<=bC?++bE:--bE){bu.face.push([bB,(bB+1)%bx,bx])}bu=g(bu,3);return bu};ai=(function(){function bu(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bu.prototype.newV=function(bw,bv){if(this.verts[bw]===void 0){this.verts[bw]=0;return this.xyzs[bw]=bv}};bu.prototype.newFlag=function(bv,bx,bw){if(this.flags[bv]===void 0){this.flags[bv]={}}return this.flags[bv][bx]=bw};bu.prototype.topoly=function(){var bw,bA,bE,bz,by,bv,bx,bB,bD,bC;bv=new aR();bw=0;bx=this.verts;for(bz in bx){bD=bx[bz];bv.xyz[bw]=this.xyzs[bz];this.verts[bz]=bw;bw++}bw=0;bB=this.flags;for(bz in bB){bA=bB[bz];bv.face[bw]=[];for(by in bA){bD=bA[by];bC=bD;break}bD=bC;bv.face[bw].push(this.verts[bD]);bD=this.flags[bz][bD];bE=0;while(bD!==bC){bv.face[bw].push(this.verts[bD]);bD=this.flags[bz][bD];bE++;if(bE>1000){console.log("Bad flag spec, have a neverending face:",bz,this.flags[bz]);break}}bw++}bv.name="unknown polyhedron";return bv};return bu})();ad=function(bA,bK,by){var bx,bQ,bP,bM,bR,bw,bN,bL,bO,bC,bB,bD,bH,bJ,bI,bz,bG,bF,bE,bv,bu;bK||(bK=0);by||(by=0.1);console.log("Taking kis of "+(bK===0?"":bK)+"-sided faces of "+bA.name+"...");bM=new ai();bz=bA.xyz;for(bN=bL=0,bO=bz.length;bL<bO;bN=++bL){bI=bz[bN];bM.newV("v"+bN,bI)}bH=bA.normals();bQ=bA.centers();bw=false;bG=bA.face;for(bN=bJ=0,bC=bG.length;bJ<bC;bN=++bJ){bP=bG[bN];bv="v"+bP[bP.length-1];for(bF=0,bB=bP.length;bF<bB;bF++){bE=bP[bF];bu="v"+bE;if(bP.length===bK||bK===0){bw=true;bx="apex"+bN;bR=""+bN+bv;bM.newV(bx,z(bQ[bN],d(by,bH[bN])));bM.newFlag(bR,bv,bu);bM.newFlag(bR,bu,bx);bM.newFlag(bR,bx,bv)}else{bM.newFlag(""+bN,bv,bu)}bv=bu}}if(!bw){console.log("No "+bK+"-fold components were found.")}bD=bM.topoly();bD.name="k"+(bK===0?"":bK)+bA.name;return bD};aJ=function(bu){var bD,bG,bB,bz,bE,bA,bv,by,bw,bx,bF,bC,bJ,bI,bH;console.log("Taking ambo of "+bu.name+"...");bv=function(bL,bK){if(bL<bK){return bL+"_"+bK}else{return bK+"_"+bL}};bG=new ai();bx=bu.face;for(bB=bz=0,bE=bx.length;bz<bE;bB=++bz){bD=bx[bB];bF=bD.slice(-2),bJ=bF[0],bI=bF[1];for(bw=0,bA=bD.length;bw<bA;bw++){bH=bD[bw];if(bJ<bI){bG.newV(bv(bJ,bI),aX(bu.xyz[bJ],bu.xyz[bI]))}bG.newFlag("orig"+bB,bv(bJ,bI),bv(bI,bH));bG.newFlag("dual"+bI,bv(bI,bH),bv(bJ,bI));bC=[bI,bH],bJ=bC[0],bI=bC[1]}}by=bG.topoly();by.name="a"+bu.name;return by};a5=function(by){var bR,bQ,bN,bS,bO,bM,bL,bP,bB,bA,bz,bE,bK,bx,bJ,bI,bG,bD,bH,bF,bw,bv,bu,bC;console.log("Taking gyro of "+by.name+"...");bN=new ai();bx=by.xyz;for(bO=bL=0,bP=bx.length;bL<bP;bO=++bL){bF=bx[bO];bN.newV("v"+bO,bm(bF))}bR=by.centers();bJ=by.face;for(bO=bK=0,bB=bJ.length;bK<bB;bO=++bK){bQ=bJ[bO];bN.newV("center"+bO,bm(bR[bO]))}bI=by.face;for(bO=bH=0,bA=bI.length;bH<bA;bO=++bH){bQ=bI[bO];bG=bQ.slice(-2),bw=bG[0],bv=bG[1];for(bM=bC=0,bz=bQ.length;bC<bz;bM=++bC){bF=bQ[bM];bu=bF;bN.newV(bw+"~"+bv,au(by.xyz[bw],by.xyz[bv]));bS=bO+"f"+bw;bN.newFlag(bS,"center"+bO,bw+"~"+bv);bN.newFlag(bS,bw+"~"+bv,bv+"~"+bw);bN.newFlag(bS,bv+"~"+bw,"v"+bv);bN.newFlag(bS,"v"+bv,bv+"~"+bu);bN.newFlag(bS,bv+"~"+bu,"center"+bO);bD=[bv,bu],bw=bD[0],bv=bD[1]}}bE=bN.topoly();bE.name="g"+by.name;return bE};s=function(by){var bM,bJ,bN,bK,bI,bL,bA,bz,bB,bH,bx,bG,bF,bD,bE,bC,bw,bv,bu;console.log("Taking propellor of "+by.name+"...");bJ=new ai();bx=by.xyz;for(bK=bI=0,bL=bx.length;bI<bL;bK=++bI){bC=bx[bK];bJ.newV("v"+bK,bm(bC))}bG=by.face;for(bK=bH=0,bA=bG.length;bH<bA;bK=++bH){bM=bG[bK];bF=bM.slice(-2),bw=bF[0],bv=bF[1];for(bE=0,bz=bM.length;bE<bz;bE++){bC=bM[bE];bu=""+bC;bJ.newV(bw+"~"+bv,au(by.xyz[bw],by.xyz[bv]));bN=bK+"f"+bv;bJ.newFlag("v"+bK,bw+"~"+bv,bv+"~"+bu);bJ.newFlag(bN,bw+"~"+bv,bv+"~"+bw);bJ.newFlag(bN,bv+"~"+bw,"v"+bv);bJ.newFlag(bN,"v"+bv,bv+"~"+bu);bJ.newFlag(bN,bv+"~"+bu,bw+"~"+bv);bD=[bv,bu],bw=bD[0],bv=bD[1]}}bB=bJ.topoly();bB.name="p"+by.name;return bB};t=function(by){var bw,bu,bz,bx,bv;console.log("Taking reflection of "+by.name+"...");for(bw=bu=0,bx=by.xyz.length-1;0<=bx?bu<=bx:bu>=bx;bw=0<=bx?++bu:--bu){by.xyz[bw]=d(-1,by.xyz[bw])}for(bw=bz=0,bv=by.face.length-1;0<=bv?bz<=bv:bz>=bv;bw=0<=bv?++bz:--bz){by.face[bw]=by.face[bw].reverse()}by.name="r"+by.name;return by};aK=function(bx){var bU,bT,bS,bR,bV,bQ,bC,bN,bO,bM,bL,bP,bB,bA,bz,by,bK,bw,bI,bH,bF,bE,bJ,bG,bv,bu,bD;console.log("Taking dual of "+bx.name+"...");bN=new ai();bC=[];for(bO=bL=0,bw=bx.xyz.length-1;0<=bw?bL<=bw:bL>=bw;bO=0<=bw?++bL:--bL){bC[bO]={}}bI=bx.face;for(bO=bK=0,bP=bI.length;bK<bP;bO=++bK){bQ=bI[bO];bv=bQ[bQ.length-1];for(bG=0,bB=bQ.length;bG<bB;bG++){bu=bQ[bG];bC[bv]["v"+bu]=""+bO;bv=bu}}bR=bx.centers();for(bO=bD=0,bH=bx.face.length-1;0<=bH?bD<=bH:bD>=bH;bO=0<=bH?++bD:--bD){bN.newV(""+bO,bR[bO])}bF=bx.face;for(bO=bU=0,bA=bF.length;bU<bA;bO=++bU){bQ=bF[bO];bv=bQ[bQ.length-1];for(bT=0,bz=bQ.length;bT<bz;bT++){bu=bQ[bT];bN.newFlag(bv,bC[bu]["v"+bv],""+bO);bv=bu}}bV=bN.topoly();bJ=[];bE=bV.face;for(bS=0,by=bE.length;bS<by;bS++){bQ=bE[bS];bM=F(bx.face[bQ[0]],bx.face[bQ[1]],bx.face[bQ[2]]);bJ[bM]=bQ}bV.face=bJ;if(bx.name[0]!=="d"){bV.name="d"+bx.name}else{bV.name=bx.name.slice(1)}return bV};E=function(by,bN,bz,bO){var bW,bU,bT,bQ,bV,bw,bR,bP,bS,bD,bC,bB,bA,bF,bK,bM,bL,bx,bJ,bI,bH,bG,bv,bu,bE;bN||(bN=0);bz||(bz=0.5);bO||(bO=-0.2);console.log("Taking inset of "+(bN===0?"":bN)+"-sided faces of "+by.name+"...");bQ=new ai();bx=by.xyz;for(bR=bP=0,bS=bx.length;bP<bS;bR=++bP){bL=bx[bR];bQ.newV("v"+bR,bL)}bK=by.normals();bU=by.centers();bJ=by.face;for(bR=bM=0,bD=bJ.length;bM<bD;bR=++bM){bT=bJ[bR];if(bT.length===bN||bN===0){for(bH=0,bC=bT.length;bH<bC;bH++){bG=bT[bH];bQ.newV("f"+bR+"v"+bG,z(l(by.xyz[bG],bU[bR],bz),d(bO,bK[bR])))}}}bw=false;bI=by.face;for(bR=bE=0,bB=bI.length;bE<bB;bR=++bE){bT=bI[bR];bv="v"+bT[bT.length-1];for(bW=0,bA=bT.length;bW<bA;bW++){bG=bT[bW];bu="v"+bG;if(bT.length===bN||bN===0){bw=true;bV=bR+bv;bQ.newFlag(bV,bv,bu);bQ.newFlag(bV,bu,"f"+bR+bu);bQ.newFlag(bV,"f"+bR+bu,"f"+bR+bv);bQ.newFlag(bV,"f"+bR+bv,bv);bQ.newFlag("ex"+bR,"f"+bR+bv,"f"+bR+bu)}else{bQ.newFlag(bR,bv,bu)}bv=bu}}if(!bw){console.log("No "+bN+"-fold components were found.")}bF=bQ.topoly();bF.name="n"+(bN===0?"":bN)+by.name;return bF};ac=function(by,bM){var bT,bS,bR,bO,bw,bP,bN,bQ,bC,bB,bA,bz,bE,bJ,bL,bK,bx,bI,bH,bG,bF,bv,bu,bD;bM||(bM=0);console.log("Taking extrusion of "+(bM===0?"":bM)+"-sided faces of "+by.name+"...");bO=new ai();bx=by.xyz;for(bP=bN=0,bQ=bx.length;bN<bQ;bP=++bN){bK=bx[bP];bO.newV("v"+bP,bK)}bJ=by.normals();bS=by.centers();bI=by.face;for(bP=bL=0,bC=bI.length;bL<bC;bP=++bL){bR=bI[bP];if(bR.length===bM||bM===0){for(bG=0,bB=bR.length;bG<bB;bG++){bF=bR[bG];bO.newV("f"+bP+"v"+bF,z(by.xyz[bF],d(0.3,bJ[bP])))}}}bw=false;bH=by.face;for(bP=bD=0,bA=bH.length;bD<bA;bP=++bD){bR=bH[bP];bv="v"+bR[bR.length-1];for(bT=0,bz=bR.length;bT<bz;bT++){bF=bR[bT];bu="v"+bF;if(bR.length===bM||bM===0){bw=true;bO.newFlag(bP+bv,bv,bu);bO.newFlag(bP+bv,bu,"f"+bP+bu);bO.newFlag(bP+bv,"f"+bP+bu,"f"+bP+bv);bO.newFlag(bP+bv,"f"+bP+bv,bv);bO.newFlag("ex"+bP,"f"+bP+bv,"f"+bP+bu)}else{bO.newFlag(bP,bv,bu)}bv=bu}}if(!bw){console.log("No "+bM+"-fold components were found.")}bE=bO.topoly();bE.name="x"+(bM===0?"":bM)+by.name;return bE};a0=function(bA){var bT,bS,bP,bQ,bO,bR,bF,bD,bG,bN,bM,bz,bL,bK,bI,bJ,bH,bw,bU,bv,by,bx,bu,bE,bC,bB;console.log("Taking stella of "+bA.name+"...");bT=bA.centers();bP=new ai();bz=bA.xyz;for(bQ=bO=0,bR=bz.length;bO<bR;bQ=++bO){bM=bz[bQ];bP.newV("v"+bQ,bM)}bL=bA.face;for(bQ=bN=0,bF=bL.length;bN<bF;bQ=++bN){bS=bL[bQ];bw="v"+bS[bS.length-2];bv="v"+bS[bS.length-1];bE=bA.xyz[bS[bS.length-2]];bC=bA.xyz[bS[bS.length-1]];for(bJ=0,bD=bS.length;bJ<bD;bJ++){bH=bS[bJ];bu="v"+bH;bB=bA.xyz[bH];bU=bw+"~"+bv;by=bv+"~"+bw;bx=bv+"~"+bu;bP.newV(bU,aX(aX(bE,bC),bT[bQ]));bP.newFlag("in"+bQ,bU,bx);bP.newFlag("f"+bQ+bv,bx,bU);bP.newFlag("f"+bQ+bv,bU,bv);bP.newFlag("f"+bQ+bv,bv,bx);bP.newFlag("f"+bU,bw,by);bP.newFlag("f"+bU,by,bU);bP.newFlag("f"+bU,bU,bw);bK=[bv,bu],bw=bK[0],bv=bK[1];bI=[bC,bB],bE=bI[0],bC=bI[1]}}bG=bP.topoly();bG.name="l"+bA.name;return bG};aa=function(bx,bw){var bB,bA,bz,bv,by,bu,bC;bB=0.1;bu=a7(bx);for(bv=0,by=bw.length;bv<by;bv++){bz=bw[bv];bC=k(bu[bz[0]],bu[bz[1]]);bA=d(bB*1/2*(1-V(D(bC,bC))),bC);bu[bz[0]]=z(bu[bz[0]],bA);bu[bz[1]]=z(bu[bz[1]],bA)}return bu};bc=function(by,bx){var bB,bA,bu,bv,bz,bw,bC;bu=(function(){var bE,bD,bG,bF;bF=[];for(bE=0,bD=bx.length;bE<bD;bE++){bG=bx[bE],bB=bG[0],bA=bG[1];bF.push(k(by[bB],by[bA]))}return bF})();bw=[0,0,0];for(bv=0,bz=bu.length;bv<bz;bv++){bC=bu[bv];bw=z(bw,bC)}bw=d(1/bx.length,bw);return _.map(by,function(bD){return bg(bD,bw)})};B=function(bx){var bu,bw,bv;bw=[0,0,0];bu=_.max(_.map(bx,function(by){return K(by)}));bv=1/bu;return _.map(bx,function(by){return[bv*by[0],bv*by[1],bv*by[2]]})};bf=function(bA,bx){var bF,bD,bE,bB,by,bC,bz,bw,bu,bv,bG;bF=0.1;bu=a7(bA);for(by=0,bC=bx.length;by<bC;by++){bB=bx[by];bE=(function(){var bH,bJ,bI;bI=[];for(bJ=0,bH=bB.length;bJ<bH;bJ++){bG=bB[bJ];bI.push(bA[bG])}return bI})();bw=ak(bE);bD=bl(bE);if(D(bw,bD)<0){bw=d(-1,bw)}for(bv=0,bz=bB.length;bv<bz;bv++){bG=bB[bv];bu[bG]=z(bu[bG],d(D(d(bF,bw),bg(bD,bA[bG])),bw))}}return bu};n=function(bv,bD){var bA,bx,bB,bz,bC,bu,by,bE,bw;bD||(bD=1);console.log("Canonicalizing "+bv.name+"...");bx=bv.face;bA=bv.edges();bu=bv.xyz;bC=1;for(bB=bz=0,bw=bD;0<=bw?bz<=bw:bz>=bw;bB=0<=bw?++bz:--bz){bE=a7(bu);bu=aa(bu,bA);bu=bc(bu,bA);bu=bf(bu,bx);bC=_.max(_.map(_.zip(bu,bE),function(bG){var bF,bH;bF=bG[0],bH=bG[1];return K(bg(bF,bH))}));if(bC<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bC+"]");by=new aR(bu,bv.face,bv.name);console.log("canonicalize",by);return by};O=function(bx){var by,bw,bv,bu;bw=bx.centers();for(bv=0,bu=bw.length;bv<bu;bv++){by=bw[bv];by=d(1/D(by,by),by)}return bw};H=function(bv){var bK,bC,bx,bE,bz,bF,bA,bu,bw,by,bG,bD,bB,bJ,bI,bH;bK=[];by=bv.face;for(bz=0,bF=by.length;bz<bF;bz++){bE=by[bz];bx=[0,0,0];bu=[0,0,0];bC=0;bG=bE.slice(-2),bJ=bG[0],bI=bG[1];for(bw=0,bA=bE.length;bw<bA;bw++){bH=bE[bw];bx=z(bx,bv.xyz[bH]);bu=z(bu,aY(bv.xyz[bJ],bv.xyz[bI],bv.xyz[bH]));bC+=aw(bv.xyz[bJ],bv.xyz[bI]);bD=[bI,bH],bJ=bD[0],bI=bD[1]}bx=d(1/bE.length,bx);bu=bm(bu);bC=bC/bE.length;bB=aE(d(D(bx,bu),bu));bK.push(d((1+bC)/2,bB))}return bK};g=function(bz,bw){var by,bv,bu,bx;bw||(bw=1);bv=aK(bz);console.log("Pseudo-canonicalizing "+bz.name+"...");for(by=bu=0,bx=bw-1;0<=bx?bu<=bx:bu>=bx;by=0<=bx?++bu:--bu){bv.xyz=H(bz);bz.xyz=H(bv)}return new aR(bz.xyz,bz.face,bz.name)};y=function(bz,bw){var by,bv,bu,bx;bw||(bw=1);bv=aK(bz);console.log("Planarizing "+bz.name+"...");for(by=bu=0,bx=bw-1;0<=bx?bu<=bx:bu>=bx;by=0<=bx?++bu:--bu){bv.xyz=O(bz);bz.xyz=O(bv)}return new aR(bz.xyz,bz.face,bz.name)};J=function(bW){var bV,bR,bK,bP,bU,bD,bX,bN,bI,bF,bT,by,bQ,bJ,bA,bB,bO,bE,bM,bS,bC,bL,bz,bx,bw,bv,bu,bH,bG;bE=999;bQ=[];bJ=[];bA=bW.length;bT=function(bY,bZ){return(bY||bZ)&&!(bY&&bZ)};bV=function(b0,bZ,bY){return(bZ[0]-b0[0])*(bY[1]-b0[1])-(bY[0]-b0[0])*(bZ[1]-b0[1])};bI=function(b0,bZ,bY){return bV(b0,bZ,bY)>0};bF=function(b0,bZ,bY){return bV(b0,bZ,bY)>=0};bK=function(b0,bZ,bY){return bV(b0,bZ,bY)===0};bR=function(b0,bZ,bY){if(bK(b0,bZ,bY)){return false}if(b0[0]!==bZ[0]){return(b0[0]<=bY[0])&&(bY[0]<=bZ[0])||(b0[0]>=bY[0])&&(bY[0]>=bZ[0])}else{return(b0[1]<=bY[1])&&(bY[1]<=bZ[1])||(b0[1]>=bY[1])&&(bY[1]>=bZ[1])}};bN=function(b1,b0,bZ,bY){if(bK(b1,b0,bZ)||bK(b1,b0,bY)||bK(bZ,bY,b1)||bK(bZ,bY,b0)){return false}return bT(bI(b1,b0,bZ),bI(b1,b0,bY))&&bT(bI(bZ,bY,b1),bI(bZ,bY,b0))};bX=function(b1,b0,bZ,bY){if(bN(b1,b0,bZ,bY)){return true}else{if(bR(b1,b0,bZ)||bR(b1,b0,bY)||bR(bZ,bY,b1)||bR(bZ,bY,b0)){return true}else{return false}}};bD=function(b0,bY){var b1,bZ;bZ=(b0+1+bA)%bA;b1=(b0-1+bA)%bA;if(bF(bW[b0],bW[bZ],bW[b1])){return bI(bW[b0],bW[bY],bW[b1])&&bI(bW[bY],bW[b0],bW[bZ])}return !(bF(bW[b0],bW[bY],bW[bZ])&&bF(bW[bY],bW[b0],bW[b1]))};bU=function(bZ,bY){var b1,b0;b1=0;while(true){b0=(b1+1+bA)%bA;if((b1!==bZ)&&(b0!==bZ)&&(b1!==bY)&&(b0!==bY)&&bN(bW[bZ],bW[bY],bW[b1],bW[b0])){return false}b1=(b1+1+bA)%bA;if(b1===0){break}}return true};bP=function(bZ,bY){return bD(bZ,bY)&&bD(bY,bZ)&&bU(bZ,bY)};bx=0;while(true){bw=(bx+1+bA)%bA;bz=(bx-1+bA)%bA;bJ[bx]=bP(bz,bw);bx=(bx+1+bA)%bA;if(bx===0){break}}bS=(function(){bL=[];for(var bY=0,bZ=bA-1;0<=bZ?bY<=bZ:bY>=bZ;0<=bZ?bY++:bY--){bL.push(bY)}return bL}).apply(this);bM=bA;bG=bE;bB=0;while(bG>0&&bM>3){bG-=1;bw=bB;bH=bE;while(true){bH-=1;by=false;if(bJ[bw]){bv=(bw+1+bA)%bA;bu=(bv+1+bA)%bA;bx=(bw-1+bA)%bA;bz=(bx-1+bA)%bA;bQ.push([bS[bx],bS[bv]]);bJ[bx]=bP(bz,bv);bJ[bv]=bP(bx,bu);bW=bW.slice(0,+bw+1||9000000000).concat(bW.slice(bv));bS=bS.slice(0,+bw+1||9000000000).concat(bS.slice(bv));if(bz>bw){bz-=1}if(bx>bw){bx-=1}if(bv>bw){bv-=1}if(bu>bw){bu-=1}bA--;bB=bv;bM--;by=true}bw=(bw+1+bA)%bA;if(!(bH>0&&!by&&bw!==bB)){break}}}return bQ};a=function(bv,bu){if(((bv[0]===bu[0])&&(bv[1]===bu[1])&&(bv[2]===bu[2]))||(bv[0]===bu[1])&&(bv[1]===bu[2])&&(bv[2]===bu[0])||(bv[0]===bu[2])&&(bv[1]===bu[0])&&(bv[2]===bu[1])){return true}else{return false}};u=function(b1,bT){var bO,bM,bK,bI,bG,bQ,b2,bS,bR,bN,bU,b0,bZ,bP,bC,bB,bA,bz,by,bx,bw,bv,bY,bu,bX,bL,bJ,bH,bF,bE,bD,b3,bW,b6,b5,b4,bV;bN=[];bu=[];bX=(function(){var b9,b8,b7;b7=[];for(b0=b9=0,b8=b1.length-1;0<=b8?b9<=b8:b9>=b8;b0=0<=b8?++b9:--b9){b7.push([b0,(b0+1)%b1.length])}return b7})();for(bZ=0,bP=bX.length;bZ<bP;bZ++){bL=bX[bZ],b5=bL[0],b4=bL[1];bN[b5]=[b4];bu[b4]=[b5]}for(bY=0,bC=bT.length;bY<bC;bY++){b2=bT[bY];bN[b2[0]].push(b2[1]);bN[b2[1]].push(b2[0]);bu[b2[0]].push(b2[1]);bu[b2[1]].push(b2[0])}b3=[];for(bW=0,bB=bT.length;bW<bB;bW++){b2=bT[bW];bJ=bN[b2[1]];for(bV=0,bA=bJ.length;bV<bA;bV++){bS=bJ[bV];bH=bu[b2[0]];for(bO=0,bz=bH.length;bO<bz;bO++){bR=bH[bO];if(bS===bR){b3.push([b2[0],b2[1],bS])}}}bF=bN[b2[0]];for(bM=0,by=bF.length;bM<by;bM++){bS=bF[bM];bE=bu[b2[1]];for(bK=0,bx=bE.length;bK<bx;bK++){bR=bE[bK];if(bS===bR){b3.push([b2[1],b2[0],bS])}}}}b6=[b3.pop()];for(bI=0,bw=b3.length;bI<bw;bI++){bD=b3[bI];bQ=false;for(bG=0,bv=b6.length;bG<bv;bG++){bU=b6[bG];if(a(bD,bU)){bQ=true;break}}if(!bQ){b6.push(bD)}}return b6};ab=function(bv,bu){var by,bx,bG,bE,bD,bB,bF,bC,bA,bw,bz,bJ,bI,bH;bu=bu||false;console.log("Triangulating faces of "+bv.name+"...");bA=new aR();bA.xyz=L(bv.xyz);bA.face_class=[];bz=bv.face;for(bE=bB=0,bF=bz.length;bB<bF;bE=++bB){bG=bz[bE];if(bG.length>3){by=Z((function(){var bK,bM,bL;bL=[];for(bM=0,bK=bG.length;bM<bK;bM++){bH=bG[bM];bL.push(bv.xyz[bH])}return bL})());bx=J(by);bI=u(bG,bx);for(bD=bw=0,bC=bI.length;bw<bC;bD=++bw){bJ=bI[bD];bA.face.push([bG[bJ[0]],bG[bJ[1]],bG[bJ[2]]]);if(bu){bA.face_class.push(bv.face_class[bE])}}}else{bA.face.push([bG[0],bG[1],bG[2]]);if(bu){bA.face_class.push(bv.face_class[bE])}}}bA.name=bv.name;return bA};ah=function(bu){var bz,bx,bA,by,bv,bw,bB,bC;bB="";bw=bu.face;for(bx=0,bA=bw.length;bx<bA;bx++){bz=bw[bx];for(bv=0,by=bz.length;bv<by;bv++){bC=bz[bv];bB+=bC+"->"}bB+="\n"}return console.log(bB)};C=function(){var bx,bu,by,bA,bB,bz,bw,bv;bv=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bz=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bx=0,bu=bz.length;bx<bu;bx++){bB=bz[bx];console.log("Operator "+bB);for(bA=0,by=bv.length;bA<by;bA++){bw=bv[bA];console.log(bB+bw+":",generatePoly(bB+bw))}}return console.log("===== Done Testing Basic Ops =====")};aU='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';bh=PEG.buildParser(aU);bt=function(bv,bu){return bv.apply(this,bu||[])};bj={T:f,O:ap,C:aj,I:a9,D:aq,P:T,A:aZ,Y:bq};G={d:aK,k:ad,a:aJ,g:a5,p:s,r:t,n:E,x:ac,l:a0,z:ab,K:g,C:n,A:y};aQ=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a3=function(bz){var bv,bx,bw,bu,bA,by;bx=bz;for(bw=0,bu=aQ.length;bw<bu;bw++){by=aQ[bw],bA=by[0],bv=by[1];bx=bx.replace(bA,bv)}console.log(bz+" executed as "+bx);return bx};br=function(bB){var bv,bC,bw,bz,bx,bE,by,bD,bA,bu;bA=a3(bB);bD=bh.parse(bA).reverse();bx=bD.shift();bC=bj[bx.op];bv=bx.args;bu=bt(bC,bv);for(bw=0,bz=bD.length;bw<bz;bw++){bx=bD[bw];by=G[bx.op];bE=[bu].concat(bx.args);bu=bt(by,bE)}bu.xyz=bc(bu.xyz,bu.edges());bu.xyz=B(bu.xyz);bu=Q(bu);return bu};ae={};bn=500;aB=400;P={};j=L(v);al=L(v);U=800;A=5;bo=0;M=0.8;o=bn/2;ay=aB/2;w=new Date();q=true;aV="rgba(255,255,255,1.0)";an="signature";h="fillstroke";be=0.5;ao=false;X=0;W=0;aI=[1,0,0];a6=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aG=function(bw,bu){var bx,bv;bx=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bv=new bx();bv.append(bw);return saveAs(bv.getBlob("text/plain;charset="+document.characterSet),bu)};bp=function(){var bu,bz,by,bx,bw,bv;bv={};bu=/\+/g;bw=/([^&=]+)=?([^&]*)/g;bz=function(bA){return decodeURIComponent(bA.replace(bu," "))};bx=window.location.search.substring(1);while(by=bw.exec(bx)){bv[bz(by[1])]=bz(by[2])}return bv};ar=function(){var bu,bv;bv=$("#spec").val().split(/\s+/g).slice(0,2);bu=location.protocol+"//"+location.host+location.pathname;bu+="?recipe="+encodeURIComponent(bv[0]);if(a2!==aS){bu+="&palette="+encodeURIComponent(a2.reduce(function(bw,bx){return bw+" "+bx}))}return $("#link").attr("href",bu)};aM=function(){var bu;bu=$("#poly");bu.width(bn);bu.height(aB);ae=bu[0].getContext("2d");ae.lineWidth=be;if(q){return ae.clearRect(0,0,bn,aB)}else{ae.clearRect(0,0,bn,aB);ae.fillStyle=aV;return ae.fillRect(0,0,bn,aB)}};aO=function(){if(q){return ae.clearRect(0,0,bn,aB)}else{ae.clearRect(0,0,bn,aB);ae.fillStyle=aV;return ae.fillRect(0,0,bn,aB)}};R=function(bz,bM){var bu,bC,bA,bH,bv,bK,bL,bB,bJ,bw,by,bI,bG,bF,bx,bE,bD;bM||(bM=[3,3,3]);bw=_.map(bz.xyz,function(bN){return bN});bz.xyz=_.map(bz.xyz,function(bN){return r(j,bN)});aT(bz);by=bz.face;for(bH=bK=0,bL=by.length;bK<bL;bH=++bK){bC=by[bH];ae.beginPath();bx=bC[bC.length-1];bI=x(z(bM,bz.xyz[bx]),A,bo,M,U),bE=bI[0],bD=bI[1];ae.moveTo(bE+o,bD+ay);for(bJ=0,bB=bC.length;bJ<bB;bJ++){bF=bC[bJ];bG=x(z(bM,bz.xyz[bF]),A,bo,M,U),bE=bG[0],bD=bG[1];ae.lineTo(bE+o,bD+ay)}bu=ag(bz.face_class[bH]);bA=(function(){var bN,bP,bO;bP=[];for(bO=0,bN=bC.length;bO<bN;bO++){bF=bC[bO];bP.push(bz.xyz[bF])}return bP})();bv=D(ak(bA),bm([1,-1,0]));bu=d((bv/2+0.5)*0.7+0.3,bu);if(h==="fill"||h==="fillstroke"){ae.fillStyle="rgba("+(Y(bu[0]*255))+", "+(Y(bu[1]*255))+", "+(Y(bu[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba("+(Y(bu[0]*255))+", "+(Y(bu[1]*255))+", "+(Y(bu[2]*255))+", "+1+")";ae.stroke()}if(h==="fillstroke"){ae.fillStyle="rgba("+(Y(bu[0]*255))+", "+(Y(bu[1]*255))+", "+(Y(bu[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba(0,0,0, .3)";ae.stroke()}if(h==="stroke"){ae.strokeStyle="rgba(0,0,0, .8)";ae.stroke()}}return bz.xyz=bw};aD=function(){var bx,bv,bu,by,bw;aO();bw=[];for(bx=bv=0,bu=P.length;bv<bu;bx=++bv){by=P[bx];bw.push(R(by,[0+3*bx,0,3]))}return bw};ax=function(){var bx,bv,bu,by,bw;bw=[];for(bx=bv=0,bu=P.length;bv<bu;bx=++bv){by=P[bx];$("#basicstats").text(by.data());bw.push($("#morestats").text(by.moreData()))}return bw};bi=function(){var bw,bx,bv,bu,by;aO();bw=(2*Math.PI)/180*w.getSeconds()*0.1;for(bx=bv=0,bu=P.length;bv<bu;bx=++bv){by=P[bx];R(by,[0+3*bx,0,3])}return setTimeout(bi,100)};$(function(){var bv,bu;aM();bu=bp();if("recipe" in bu){bv=[bu.recipe];$("#spec").val(bv)}else{bv=[bd(a6)];$("#spec").val(bv);ar()}if("palette" in bu){a2=bu.palette.split(/\s+/g);ar()}$("#palette").val(a2.reduce(function(bw,bx){return bw+" "+bx}));P=_.map(bv,function(bw){return br(bw)});ax();aD();$("#spec").change(function(bw){bv=$("#spec").val().split(/\s+/g).slice(0,2);P=_.map(bv,function(bx){return br(bx)});ax();ar();return aD()});$("#palette").change(function(bw){a2=$(this).val().split(/\s+/g);ar();return aD()});$("#poly").mousewheel(function(by,bz,bx,bw){by.preventDefault();U*=(10+bz)/10;return aD()});$("#poly").mousedown(function(bw){var bx;bw.preventDefault();ao=true;X=bw.clientX-$(this).offset().left;W=bw.clientY-($(this).offset().top-$(window).scrollTop());bx=aN(X,W,o,ay,A,bo,M,U);if(bx[0]*bx[1]*bx[2]*0===0){aI=bx}return al=L(j)});$("#poly").mouseup(function(bw){bw.preventDefault();return ao=false});$("#poly").mouseleave(function(bw){bw.preventDefault();return ao=false});$("#poly").mousemove(function(bz){var bx,bw,by;bz.preventDefault();if(ao){bx=bz.clientX-$(this).offset().left;bw=bz.clientY-($(this).offset().top-$(window).scrollTop());by=aN(bx,bw,o,ay,A,bo,M,U);if(by[0]*by[1]*by[2]*0===0&&aI[0]*aI[1]*aI[2]*0===0){j=aH(aF(aI,by),al)}return aD()}});$("#strokeonly").click(function(bw){h="stroke";return aD()});$("#fillonly").click(function(bw){h="fill";return aD()});$("#fillandstroke").click(function(bw){h="fillstroke";return aD()});$("#siderot").click(function(bw){j=aW(aL/2,0,1,0);return aD()});$("#toprot").click(function(bw){j=aW(aL/2,1,0,0);return aD()});$("#frontrot").click(function(bw){j=i(0,0,0);return aD()});$("#pngsavebutton").click(function(bz){var by,bx,bw;by=$("#poly")[0];bw=$("#spec").val().split(/\s+/g)[0];bx="polyhedronisme-"+bw.replace(/\([^\)]+\)/g,"")+".png";return by.toBlob(function(bA){return saveAs(bA,bx)})});$("#objsavebutton").click(function(bz){var bx,by,bw;by=P[0].toOBJ();bw=$("#spec").val().split(/\s+/g)[0];bx="polyhedronisme-"+bw.replace(/\([^\)]+\)/g,"")+".obj";return aG(by,bx)});return $("#x3dsavebutton").click(function(bz){var bx,bw,by,bA;by=ab(P[0],true);bA=by.toVRML();bw=$("#spec").val().split(/\s+/g)[0];bx="polyhedronisme-"+bw.replace(/\([^\)]+\)/g,"")+".wrl";return aG(bA,bx)})})}).call(this);